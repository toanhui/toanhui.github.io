(()=>{var z,M,O,J={}.hasOwnProperty,D=[].slice;M=10,z="inputmemory_keys",O=1,window.I={get_worker:function(){var e;return e=$.Deferred(),I.get_worker=function(){return e},e.resolve(new Worker("/static/worker.min.js")),e},solve_challenge:function(e){return I.get_worker().then(function(t){var n,r,i;return n=O++,t.postMessage([n,"solve_challenge",e]),r=$.Deferred(),t.addEventListener("message",i=function(o){return function(u){var a,l,s;if(l=u.data,a=l[0],s=l[1],a===n)return t.removeEventListener("message",i),r.resolve(s)}}(this)),r})},libs:{react:$.Deferred(function(e){if(typeof React!="undefined"&&React!==null)return e.resolve(React)}),selectize:$.Deferred(function(e){var t;if(typeof $!="undefined"&&$!==null&&(t=$.fn)!=null&&t.selectize)return e.resolve($.fn.selectize)}),redactor:$.Deferred(function(e){var t;if(typeof $!="undefined"&&$!==null&&(t=$.fn)!=null&&t.redactor)return e.resolve($.fn.redactor)})},setup_page:function(){return I.setup_register_referrers($(document.body)),_.defer(function(e){return function(){return I.setup_affiliate_code()}}(this))},root_url:function(){var e;return e=null,function(t){return e||(e=$("body").data("host")||"",e!==""&&(e=window.location.protocol+"//"+e,window.location.port&&window.location.port!=="80"&&(e+=":"+window.location.port))),e+"/"+t}}(),page_name:function(){return $(document.body).data("page_name")||"unknown"},sort_keys:function(e){var t,n;return n=[],t=function(r){var i,o,u;o=[];for(i in r)J.call(r,i)&&(u=r[i],n.push(i),typeof u=="object"?o.push(t(u)):o.push(void 0));return o},t(e),n.sort()},get_csrf:function(){return I._csrf_token||(I._csrf_token=$("meta[name='csrf_token']").attr("value"))},with_csrf:function(e){var t;return e==null&&(e={}),t={csrf_token:I.get_csrf()},typeof e=="string"?e+"&"+$.param(t):$.extend(e,t)},add_params:function(e,t){var n;return n=$.param(t),e.match(/\?/)?e+"&"+n:e+"?"+n},flash:function(e,t){return t==null&&(t="notice"),I.flasher||(I.flasher=new I.Flasher),e.match(/^error:/)&&(e=e.replace(/^error:/,"Error: "),t="error"),I.flasher.show(t,e)},slugify:function(e,t){return e=e.replace(/\s+/g,"-"),e=t!=null&&t.for_tags?e.replace(/[^\w_.-]/g,"").replace(/^[_.-]+/,"").replace(/[_.-]+$/,""):e.replace(/[^\w_-]/g,""),e.toLowerCase()},truncate:function(e,t,n){return t==null&&(t=30),n==null&&(n="..."),e?e.length>t+n.length?""+e.slice(0,t)+n:e:""},number_format:function(e,t,n,r){var i,o,u;return n==null&&(n="."),r==null&&(r=","),isNaN(e)||e===null?"":(e=e.toFixed(~~t),u=e.split("."),o=u[0],i=u[1]?n+u[1]:"",o.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+i)},format_bytes:function(){var e;return e=[["gb",Math.pow(1024,3)],["mb",Math.pow(1024,2)],["kb",1024]],function(t){var n,r,i,o,u;for(n=0,i=e.length;n<i;n++)if(u=e[n],r=u[0],o=u[1],t>=o)return""+I.number_format(t/o)+r;return I.number_format(t)+" bytes"}}(),ecommerce_event:function(e){return window.gtag?gtag("event","purchase",e):console.log("purchase event:",e)},event:function(e,t,n,r,i){var o;return i==null&&(i=!0),o={hitType:"event",eventCategory:e,eventAction:t,eventLabel:n,eventValue:r},i||(o.nonInteraction=1),I.event_with_opts(o)},event_with_opts:function(e){try{return window.ga!=null?window.ga("send",e):(console.log("ga event:",e),typeof e.hitCallback=="function"?e.hitCallback():void 0)}catch(t){}},parse_money:function(e){var t;return t=e&&parseInt(e.replace(/[^\d]/g,""),10),t||0},currency_symbols:{USD:"$",GBP:"\xA3",EUR:"\u20AC",JPY:"\xA5"},currency_formats:{USD:{prefix:"$"},GBP:{prefix:"\xA3"},JPY:{prefix:"\xA5"},EUR:{suffix:"\u20AC"}},format_money:function(e,t){var n,r;return t==null&&(t="USD"),e<0?"-"+I.format_money(-e,t):(r=I.currency_symbols[t]||"$",t==="JPY"?r+e:(n=I.number_format(e/100,2),t==="EUR"?""+n+r:""+r+n))},money_input:function(e,t){var n,r;return t==null&&(t={}),e=$(e),n=t.currency||e.data("currency"),r=I.currency_formats[n]||{prefix:"$"},e.maskMoney($.extend({affixesStay:!0,precision:n==="JPY"?0:2},r,t))},plural:function(e,t){return t===1?t+" "+e:t+" "+e+"s"},add_recaptcha_if_necessary:function(e,t){if(t[0]==="recaptcha")return e.data("adding_recaptcha")||(e.data("adding_recaptcha",!0),I.with_recaptcha(function(){var n;return n=e.find(".g-recaptcha"),I.event("recaptcha","show",I.page_name()),grecaptcha.render(n[0],{sitekey:n.data("sitekey")})})),e.set_form_errors(["Please fill out the CAPTCHA to continue"]),!0},with_recaptcha:function(e){var t;return window.grecaptcha?e():I.recaptcha_deferred?I.recaptcha_deferred.done(e):(I.recaptcha_deferred=$.Deferred().done(e),window._itch_recaptcha_loaded=function(){return I.recaptcha_deferred.resolve()},t="https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit",$('<script defer type="text/javascript">').attr("src",t).appendTo("head"))},wait_for_object:function(e,t,n){var r,i,o;return i=1,r=10,o=function(){return e[t]?typeof n=="function"?n():void 0:(i+=r,i=Math.min(500,i),setTimeout(o,i))},o()},with_selectize:function(e){return I.libs.selectize.done(e)},get_template:function(e){return _.template($("#"+e+"_tpl").html())},lazy_template:function(e,t){return function(){var n,r;return n=1<=arguments.length?D.call(arguments,0):[],r=I.get_template(t),e.prototype.template=r,r.apply(null,n)}},setup_sticky_bar:function(e){var t,n,r;return r=$(window),t=$(document.body),e=$(e),n=!1,r.on("scroll",function(i){if(r.scrollTop()>e.offset().top+e.outerHeight()){if(!n)return t.addClass("show_sticky_bar"),n=!0}else if(n)return t.removeClass("show_sticky_bar"),n=!1})},setup_selectize:function(e){return e.find(".selectize_input").addBack(".selectize_input").each(function(t,n){var r,i,o,u,a,l,s;if(r=$(n),!r.hasClass("selectized"))return a={plugins:[],persist:!1},r.is("select")&&(i={},r.find("option").each(function(f,d){var c;return c=$(d),i[c.val()]=c.data("extra")}),s=function(f,d){var c,p;return c=d(f.text),(p=i[f.value])&&(c=c+" <span class='sub'>\u2014 "+p+"</span>"),"<div class='option'>"+c+"</div>"},a.render={item:s,option:s}),(l=r.data("placeholder"))&&(a.placeholder=l),r.hasClass("dropdown")&&(a.maxItems=1),(u=r.data("options"))&&(r.hasClass("options_object")?(a.options=u,a.searchField=["text","keywords"]):a.options=u.map(function(f){return{value:f[0],text:f[1]}}),a.plugins.push("remove_button"),a.delimiter=",",a.persist=!1),(o=r.data("optgroups"))&&(a.optgroups=o),r.selectize(a)})},format_filesize:function(e,t){var n,r,i,o,u;for(t==null&&(t=".file_size_value"),o=e.find(t),u=[],r=0,i=o.length;r<i;r++)n=o[r],n=$(n),u.push(n.html(I.format_bytes(parseInt(n.html()))));return u},adjust_font_size_to_fit:function(e,t){var n,r,i;if(t==null&&(t=16),!!e.length){for(r=e.css("font-size"),r=parseInt(r.match(/\d+/),10),n=e[0],i=[];n.offsetWidth<n.scrollWidth&&(r-=2,!(r<t));)i.push(e.css("font-size",r+"px"));return i}},slug_input:function(e,t){var n;if(n=/[a-z_0-9_-]/g,e.on("keypress",function(r){var i;if(r.keyCode>=32&&(i=String.fromCharCode(r.keyCode),!i.match(n)))return!1}),t&&t.length)return e.on("change",function(r){var i;if(i=I.slugify(t.val()),e.val().match(/^\s*$/)&&i!=="")return e.val(i)}),t.on("change",function(r){if(e.val().match(/^\s*$/))return e.val(I.slugify($(r.currentTarget).val()))})},deferred_links:function(e,t,n){return n||(n=I.delegate_tracking),e.on("mouseup",t,function(r){var i;if(r.which===2)return i=$(r.currentTarget),n(i,r)}),e.on("click",t,function(r){var i,o,u,a;if(r.which===1&&(a=$(r.currentTarget),o=r.metaKey||r.ctrlKey||r.shiftKey||a.attr("target")==="_blank",i=null,o||(i=function(){if(i)return i=null,window.location=a.attr("href")},setTimeout(function(){return typeof i=="function"?i():void 0},200)),(u=n(a,r))!=null&&u.done(i),!o))return!1})},delegate_tracking:function(e){var t;return t=[],e.trigger("i:delegate_tracking",[function(n){return t.push(n)}]),$.when.apply($,t)},ga_tracker:function(e,t,n,r){var i;return i=function(o){var u,a,l,s,f;return u={hitType:"event",eventCategory:(a=o.data("category"))!=null?a:e,eventAction:(l=o.data("action"))!=null?l:t,eventLabel:(s=o.data("label"))!=null?s:n,eventValue:(f=o.data("value"))!=null?f:r},$.Deferred(function(d){return u.hitCallback=function(){return d.resolve()},I.event_with_opts(u)})}},tracked_links:function(){var e,t,n,r,i,o,u;return n=arguments[0],i=2<=arguments.length?D.call(arguments,1):[],t=i[0],e=i[1],r=i[2],u=i[3],o=I.ga_tracker(t,e,r,u),I.deferred_links(n,"a[data-label]",o),n.on("i:track_link",function(a,l){var s;return l&&(s=l[0]),I.ga_tracker(t,e,s!=null?s:r,u)($(a.target))})},set_cookie:function(e,t,n){return n==null&&(n={}),I.in_dev&&console.log("set cookie:",[e,t],n),Cookies.set(e,t,$.extend({path:"/",domain:"."+$(document.body).data("host")},n))},set_register_referrer:function(e){var t;if(t=I.page_name(),t!=null&&I.set_cookie("ref:register:page_params",t),e!=null)return I.set_cookie("ref:register:action",e)},setup_register_referrers:function(e){if(!I.current_user)return e.on("mouseup","[data-register_action]",function(t){var n;return n=$(t.currentTarget).data("register_action"),I.set_register_referrer(n)})},setup_affiliate_code:function(e,t){var n,r;if(t==null&&(t=!1),e==null&&(e=(r=window.location.search.match(/\bac=([\w\d]+(?:\-[\.:_\w\d]+)?)/))!=null?r[1]:void 0),!!e&&!(!t&&e===Cookies.get("acode")))return I.set_cookie("acode",e,{expires:1}),document.referrer&&I.set_cookie("acode:ref",document.referrer.substring(0,180),{expires:1}),n=window.location.href.replace(/\?.*$/,"").substring(0,180),I.set_cookie("acode:land",n,{expires:1})},bind_checkbox_to_input:function(e,t,n){var r;return r=function(){var i;return i=e.prop("checked"),t.prop("disabled",i),typeof n=="function"?n(i):void 0},e.on("change",r),r()},add_facebook:function(e){var t,n,r;if(!window.FB&&(I.add_facebook=function(){},$('<div id="fb-root"></div>').appendTo(document.body),n="facebook-jssdk",!document.getElementById(n)))return e!=null&&(window.fbAsyncInit=e),t=document.getElementsByTagName("script")[0],r=document.createElement("script"),r.id=n,r.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0",t.parentNode.insertBefore(r,t)},add_twitter:function(){var e,t,n;if(t="twitter-wjs",!document.getElementById(t))return I.add_twitter=function(){},e=document.getElementsByTagName("script")[0],n=document.createElement("script"),n.id="twitter-wjs",n.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(n,e)},add_react:function(){var e,t;return e=$.Deferred(),window.ReactDOM?(e.resolve(),e):(I.add_react=function(){return e},I.libs.react.done(function(){return e.resolve()}),t=$("#lib_react_src"),t.replaceWith($('<script type="text/javascript">').attr("src",t.data("src"))),e)},has_follow_button:function(e,t){var n,r,i,o,u,a,l;return t==null&&(t={}),e=$(e),i=(u=t.cls)!=null?u:"follow_button_widget",n=(a=t.animate_follow)!=null?a:"animate_bounce",r=(l=t.animate_unfollow)!=null?l:"animate_drop_down",o={},o[i]=function(s){var f,d,c,p;if(!I.current_user)return"continue";if(!s.is(".loading"))return s.removeClass(n+" "+r),c=$.Deferred(function(m){return setTimeout(function(){return m.resolve()},500)}),d=s.is(".is_following"),p=d?(_.defer(function(){return s.addClass(r)}),s.data("unfollow_url")):(_.defer(function(){return s.addClass(n)}),s.data("follow_url")),s.addClass("loading").trigger("i:track_link",["follow_btn"]),f=s.data("follow_data")||{},$.when($.post(p,I.with_csrf(f)),c).done(function(m){var k;if(k=m[0],s.removeClass("loading "+n+" "+r),k.errors){I.flash(k.errors.join(", "));return}return s.toggleClass("is_following",k.following).trigger("i:follow_updated",[{user_id:s.data("user_id"),following:k.following,btn:s}])})},e.dispatch("click",o),$(document.body).on("i:follow_updated",function(s,f){var d,c,p;return p=f.user_id,c=f.following,d=f.btn,e.find("."+i+"[data-user_id="+p+"]").not(d).toggleClass("is_following",c)})},is_mobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},is_firefox:function(){var e;return e=navigator.userAgent,e.match(/Firefox/)&&!e.match(/Seamonkey/)},is_safari:function(){var e;return e=navigator.userAgent,e.match(/Safari/)&&!e.match(/Chrome|Chromium|Android|Edge/)},is_ios:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},strip_css:function(e){return e.replace(/<\s*\/\s*style\s*>/i,"")},request_fullscreen:function(e,t){var n,r,i;return n=e.requestFullscreen?(e.requestFullscreen(),!0):e.msRequestFullscreen?(e.msRequestFullscreen(),!0):e.mozRequestFullScreen?(e.mozRequestFullScreen(),!0):e.webkitRequestFullscreen?(e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),!0):!1,n&&t&&(r=window.screen)!=null&&(i=r.orientation)!=null&&typeof i.lock=="function"&&i.lock(t),n},is_fullscreen:function(){return!(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)},exit_fullscreen:function(){if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()},toggle_fullscreen:function(e,t){return I.is_fullscreen()?(I.exit_fullscreen(),!1):I.request_fullscreen(e,t)?!0:"failed"},setup_dirty_warning:function(e,t){return t||(t=function(){return e.data("dirty")}),e.data("dirty",!1),$(window).on("beforeunload",function(){var n;if(n=t(),!!n)switch(typeof n){case"string":return n;default:return"You've made modifications to this page."}}),e.on("i:after_submit",function(){return e.data("dirty",!1)}),_.defer(function(){return e.on("change","input, select, textarea",function(n){return e.data("dirty",!0)}),e.on("keydown, mousedown",".redactor-editor",function(){return e.data("dirty",!0)})})},remote_submit:function(e,t,n){var r,i;return n==null&&(n={}),e.trigger("i:before_submit"),n.loading_lock&&(i=e.serializeArray(),r=e.addClass("loading").find("button, input[type='submit']").prop("disabled",!0).addClass("disabled")),$.when(t).then(function(o){var u;return i||(i=e.serializeArray()),o&&(i=i.concat(o)),$.ajax({data:i,type:(u=e.attr("method"))!=null?u:"POST",dataType:"json",url:e.attr("action"),xhrFields:{withCredentials:!0},error:function(a){var l;return l=function(){try{return JSON.parse(a.responseText)}catch(s){}}(),l!=null&&l.errors?I.flash(l.errors.join(", ")):I.flash("We seem to be having server problems right now! Please try again later.")},complete:function(){return n.loading_lock&&(r.prop("disabled",!1).removeClass("disabled"),e.removeClass("loading")),e.trigger("i:after_submit")}}).then(null,function(a){try{return JSON.parse(a.responseText)}catch(l){throw a}})})},is_middle_click:function(e){return e.which===2||e.metaKey||e.ctrlKey},escape_regex:function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},move:function(e,t,n){var r,i,o,u;if(i=e.indexOf(t),i===-1)throw"Failed to find object in array";if(u=i+n,u<0||u>=e.length)throw"Movement is outside of array ("+u+") [0, "+(e.length-1)+"]";return r=function(){var a,l,s;for(s=[],a=0,l=e.length;a<l;a++)o=e[a],o!==t&&s.push(o);return s}(),r.splice(u,0,t),r},format_integer:function(e){return e>1e7?Math.floor(e/1e6)+"m":e>=1e6?Math.floor(e/1e5)/10+"m":e>1e4?Math.floor(e/1e3)+"k":e>=1e3?Math.floor(e/100)/10+"k":""+e},store_memory:function(e,t){var n,r,i,o;if(window.localStorage){if(i=function(){try{return JSON.parse(localStorage.getItem(z))}catch(u){}}(),i||(i=[]),i[0]!==e){for(r=function(){var u,a,l;for(l=[],u=0,a=i.length;u<a;u++)n=i[u],e!==n&&l.push(n);return l}(),i=[e].concat(r);i.length>M;)o=i.pop(),typeof localStorage!="undefined"&&localStorage!==null&&localStorage.removeItem(o);localStorage.setItem(z,JSON.stringify(i))}return localStorage.setItem(e,t)}},clear_memory:function(e){var t,n;if(window.localStorage){n=function(){try{return JSON.parse(localStorage.getItem(z))}catch(r){}}(),n&&localStorage.setItem(z,JSON.stringify(function(){var r,i,o;for(o=[],r=0,i=n.length;r<i;r++)t=n[r],e!==t&&o.push(t);return o}()));try{return localStorage.removeItem(e)}catch(r){}}}},$(function(){var e;if((e=window.location.hash.match(/\bflash=([^&]*)/))&&(I.flash(e[1]),window.location.hash=window.location.hash.replace(/\bflash=([^&]*)/,"")),I.ie)return $(document.body).addClass("ie")}),I.Flasher=function(){e.prototype.duration=1e4,e.prototype.animation_duration=250,e.prototype.clipping="-7px";function e(){$(document).on("click",".global_flash",function(t){return function(){return t.dismiss()}}(this))}return e.prototype.dismiss=function(){var t;if(t=this.current_flash)return this.timeout&&(clearTimeout(this.timeout),this.timeout=null),t.css({"margin-top":"-"+(t.outerHeight()+4)+"px"}),setTimeout(function(n){return function(){return t.remove()}}(this),this.animation_duration*2)},e.prototype.show=function(t,n){var r;return this.dismiss(),r=$("<div class='global_flash "+t+"' role='alert' aria-live='polite'>").text(n).appendTo("body"),r.css({"margin-left":"-"+r.width()/2+"px","margin-top":"-"+(r.outerHeight()+4)+"px"}),this.timeout=setTimeout(function(i){return function(){return r.addClass("animated"),r.css({"margin-top":i.clipping}),setTimeout(function(){return i.dismiss()},i.duration)}}(this),100),this.current_flash=r},e}(),_.templateSettings={escape:/\{\{(?![&])(.+?)\}\}/g,interpolate:/\{\{&(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g},$.easing.smoothstep=function(e){return e*e*e*(e*(e*6-15)+10)};var j,F=j=window.dayjs;window._dayjs_setup||(j.extend(window.dayjs_plugin_duration),j.extend(window.dayjs_plugin_calendar),j.extend(window.dayjs_plugin_advancedFormat),j.extend(window.dayjs_plugin_relativeTime),j.extend(window.dayjs_plugin_utc),window._dayjs_setup=!0);var P,K=[].slice;P=function(e){var t;return(t=typeof e=="string"&&e.match(/(^\d{4}\-\d{1,2}\-\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2})$/))?t[1]+"T"+t[2]+"Z":e};var N=function(){var e,t,n,r;switch(r=arguments[0],t=arguments[1],e=3<=arguments.length?K.call(arguments,2):[],t==null&&(t="fromNow"),r=P(r),t){case"fromNow":return F(r).fromNow();case"calendar":return F(r).calendar(null,{sameElse:"MMMM Do YYYY"});case"format":return(n=F(r)).format.apply(n,e);default:throw new Error("unknown method for format_timestamp: "+t)}},R;$.fn.dispatch=function(e,t){return this.on(e,function(n){return function(r){var i,o,u,a;for(u in t)if(o=t[u],i=$(r.target).closest("."+u),!!i.length)return i.is(".disabled")?!1:i.is("a")&&r.ctrlKey||(a=o(i,r),a==="continue")?void 0:!1;return null}}(this)),this},$.fn.exists=function(){return this.length>0?this:!1},$.fn.format_timestamps=function(e){var t,n,r,i,o;for(e==null&&(e="calendar"),o=this.find(".date_format"),n=function(u){var a,l,s;return a=u.data("format"),l=u.html(),s=a?N(l,"format",a):N(l,e),u.html(s).attr("title",l+" UTC")},r=0,i=o.length;r<i;r++)t=o[r],n($(t));return this},$.fn.has_tooltips=function(e){var t,n,r,i,o,u;if(e==null&&(e={}),!I.is_mobile())return o=function(){var a;return a=$('<div class="tooltip_drop"></div>'),$(document.body).append(a),o=function(){return a},a},u=_.template('<div class="tooltip">{{ label }}</div>'),i=function(a,l){var s,f,d,c;return l==null&&(l=!1),s=a.data("tooltip_el"),s||(s=$(u({label:a.attr("aria-label")||a.data("tooltip")})),a.data("tooltip_el",s)),s.removeClass("visible"),o().empty().append(s),d=a.offset(),f=s.outerHeight(),c=s.outerWidth(),s.css({position:"absolute",top:e.below?d.top+a.outerHeight()+10:d.top-f-10,left:Math.floor(d.left+(a.outerWidth()-c)/2)}),s.toggleClass("below",!!e.below),l?s.addClass("visible"):setTimeout(function(p){return function(){return s.addClass("visible")}}(this),10)},n=function(a){return function(l){var s,f;if(f=$(l.currentTarget),s=f.data("tooltip_el"),f.removeData("tooltip_el"),!!s&&s.is(":visible"))return i(f,!0)}}(this),r=function(a){return function(l){var s;if(s=$(l.currentTarget),!s.closest(".redactor-box").length)return i(s)}}(this),t=function(a){return function(l){var s,f;if(f=$(l.currentTarget),s=f.data("tooltip_el"))return s.remove()}}(this),this.is("[data-tooltip]")?(this.on("i:refresh_tooltip",n),this.on("mouseenter focus",r),this.on("mouseleave blur i:hide_tooltip",t)):(this.on("i:refresh_tooltip","[data-tooltip], [aria-label]",n),this.on("i:clear_tooltips",function(){return o().empty()}),this.on("mouseenter focus","[data-tooltip], [aria-label]",r),this.on("mouseleave blur i:hide_tooltip","[data-tooltip], [aria-label]",t)),this},$.fn.inline_edit=function(e){var t,n,r;if(e==null&&(e={}),this.is(".inline_editing")){this.data("finished_editing")();return}return this.addClass("inline_editing"),n=$('<input type="text" class="inline_edit_input" />').attr("placeholder",this.data("placeholder")).val((typeof e.get_val=="function"?e.get_val(this):void 0)||this.text()).insertAfter(this.hide()).select(),t=function(i){return function(){return n.remove(),i.show(),$(document).off("click.inline_editing"),i.removeClass("inline_editing")}}(this),this.data("finished_editing",t),r=function(i){return function(){return n.prop("disabled",!0),e.set_val?e.set_val(i,n.val(),t):(i.text(n.val()),t())}}(this),$(document).on("click.edit_title",function(i){return function(o){if(!$(o.target).closest(".inline_edit_input").length)return r()}}(this)),n.on("keydown",function(i){return function(o){switch(o.keyCode){case 9:return _.defer(function(){return r()});case 13:return r();case 27:return t()}}}(this))},I.support_passive_scroll=function(){var e,t;t=!1;try{e=Object.defineProperty({},"passive",{get:function(n){return function(){return t=!0}}(this)}),window.addEventListener("test",null,e)}catch(n){}return t},I.support_intersection_observer=function(){return"IntersectionObserver"in window},R=function(e,t){var n,r,i,o,u,a,l,s;for(e.removeClass("lazy_images"),r=e.find("[data-background_image]").addBack("[data-background_image]"),o=function(){var f,d,c;for(c=[],f=0,d=r.length;f<d;f++)n=r[f],c.push(function(p){var m;if(p=$(p),m=p.data("background_image"),p.css({backgroundImage:"url("+m+")"}),t)return $.Deferred(function(k){return function(x){return $("<img />").attr("src",m).on("load",function(){return x.resolve()})}}(this))}(n));return c}(),s=e.find("img[data-lazy_src]").addBack("img[data-lazy_src]"),i=function(f){var d,c;if(f=$(f),d=f.data("lazy_src"),f.attr("src",d),(c=f.data("lazy_srcset"))&&f.attr("srcset",c),t)return $.Deferred(function(p){return function(m){return f.on("load",function(){return m.resolve()})}}(this))},a=0,l=s.length;a<l;a++)u=s[a],i(u);if(t)return o.length===1?o[0]:$.when.apply($,o)},$.fn.lazy_images=function(e){var t,n,r,i,o,u,a,l,s,f,d,c,p,m,k,x;if(d=this.data("lazy_images"))return d();if(l=e!=null&&e.elements?function(){var y,g,v,h;for(v=e.elements,h=[],y=0,g=v.length;y<g;y++)r=v[y],h.push($(r));return h}():(c=(e!=null?e.selector:void 0)||".lazy_images",function(){var y,g,v,h;for(v=this.find(c),h=[],y=0,g=v.length;y<g;y++)r=v[y],h.push($(r));return h}.call(this)),t=(f=e!=null?e.show_images:void 0)!=null?f:R,I.support_intersection_observer()){for(i=function(y){var g,v,h,w,b,C;for(C=[],h=0,w=y.length;h<w;h++)v=y[h],v.isIntersecting?(r=v.target,u.unobserve(r),r=$(r),b=e!=null?e.show_item:void 0,g=t(r,!!b),C.push(typeof b=="function"?b(r,g):void 0)):C.push(void 0);return C},u=new IntersectionObserver(i,{}),a=0,s=l.length;a<s;a++)r=l[a],u.observe(r[0]);return function(){return u.disconnect()}}return x=$(window),p=e!=null?e.target:void 0,o=e!=null?e.horizontal:void 0,k=null,n=function(y){return function(){var g,v,h,w,b,C,Y,T,W;for(g=function(){if(p){if(o)return p.outerWidth()+p.position().left;throw new Error("not yet")}else return x.scrollTop()+x.height()}(),h=0,w=C=0,Y=l.length;C<Y;w=++C)if(b=l[w],!!b){if(!document.body.contains(b[0])){l[w]=null,h+=1;continue}W=function(){if(p){if(o)return b.position().left;throw new Error("not yet")}else return b.offset().top}(),b[0].offsetParent&&W<g&&(T=e!=null?e.show_item:void 0,v=t(b,!!T),typeof T=="function"&&T(b,v),h+=1,l[w]=null)}if(h>0)return l=function(){var S,q,A;for(A=[],S=0,q=l.length;S<q;S++)r=l[S],r&&A.push(r);return A}()}}(this),m=_.throttle(n,100),p?(p.on("scroll",m),x.on("resize",m),k=function(){return p.off("scroll",m),x.off("resize","throttled")}):I.support_passive_scroll()?(window.addEventListener("scroll",m,{passive:!0}),x.on("resize i:reshape",m),k=function(){return window.removeEventListener("scroll",m,{passive:!0}),x.off("resize",m)}):(x.on("scroll resize i:reshape",m),k=function(){return x.off("scroll resize i:reshape",m)}),this.data("lazy_images",function(y){return function(){return l=e!=null&&e.elements?function(){var g,v,h,w;for(h=e.elements,w=[],g=0,v=h.length;g<v;g++)r=h[g],w.push($(r));return w}():(c=(e!=null?e.selector:void 0)||".lazy_images",function(){var g,v,h,w;for(h=this.find(c),w=[],g=0,v=h.length;g<v;g++)r=h[g],w.push($(r));return w}.call(y)),n()}}(this)),n(),k},$.fn.max_height=function(e){var t,n,r;return e==null&&(e=0),r=$(window),t=this.outerHeight(!0)-this.height(),n=function(i){return function(){return i.css("min-height",r.height()-t-e+"px")}}(this),r.on("resize",n),n()},$.fn.on_first_view=function(e,t){var n,r,i,o,u,a;if(t==null&&(t={}),window.IntersectionObserver==null){console.warn("IntersectionObserver is not supported by this browser.");return}for(o=new IntersectionObserver(function(l){return function(s){return s.forEach(function(f){if(f.isIntersecting)return o.unobserve(f.target),typeof e=="function"?e(f.target):void 0})}}(this)),u=this,a=[],r=0,i=u.length;r<i;r++)n=u[r],a.push(o.observe(n));return a},$.fn.remote_link=function(e){return this.on("click","[data-remote]",function(t){return function(n){var r,i,o,u,a;if(n.preventDefault(),i=$(n.currentTarget),!i.is(".loading")&&(u=i.data("method")||"POST",a=I.with_csrf($.extend({},i.data("params"))),o=i.data("href")||i.attr("href"),!((r=i.data("confirm"))&&!confirm(r))))return i.addClass("loading").prop("disabled",!0),$.ajax({type:u,url:o,data:a,xhrFields:{withCredentials:!0}}).done(function(l){return i.removeClass("loading").prop("disabled",!1),typeof e=="function"?e(l,i):void 0}),null}}(this))},$.fn.remote_submit=function(e,t,n){var r;return r=null,this.on("click","button[name], input[type='submit'][name]",function(i){return function(o){var u;return u=$(o.currentTarget),r!=null&&r.remove(),r=$("<input type='hidden' />").attr("name",u.attr("name")).val(u.attr("value")).prependTo(i)}}(this)),this.on("submit",function(i){return function(o,u){var a;if(o.preventDefault(),a=$(o.currentTarget),!(t&&!(typeof t=="function"&&t(a))))return I.remote_submit(a,n,{loading_lock:!0}).done(function(l){return a.data("dirty",!1),u!=null?u(l,a):e(l,a)}),null}}(this))},$.fn.remote_table=function(){var e,t,n,r;return n=this.data("max_page"),e=function(i){return function(){return i.data("page")||1}}(this),r={},t=function(i){return function(o){var u,a;if(!i.is(".loading")&&1<=o&&o<=n)return u=i.find("table"),i.addClass("loading").data("page",o).toggleClass("first_page",o===1).toggleClass("last_page",o===n).find(".current_page").text(o),a=r[o]||(r[o]=$.get(i.data("remote_url")+"?"+$.param({page:o}))),a.done(function(l){return i.removeClass("loading"),u.html(l.content)})}}(this),this.dispatch("click",{next_page_btn:function(i){return function(){return t(e()+1)}}(this),prev_page_btn:function(i){return function(){return t(e()-1)}}(this)})},$.fn.set_form_errors=function(e,t,n){var r,i,o,u,a,l,s,f;if(t==null&&(t=!0),n==null&&(n="Errors"),this.find(".form_errors").remove(),a=!!(e!=null&&e.length),this.toggleClass("has_errors",a),a){for(o=$(_.template(`<div class="form_errors">
  <div>{{ msg }}:</div>
  <ul></ul>
</div>`)({msg:n})),u=o.find("ul"),l=0,s=e.length;l<s;l++)i=e[l],u.append($("<li></li>").text(i));this.prepend(o),t&&(f=this.closest(".lightbox"),f.length||this.offset().top>$(window).height()/2?typeof(r=this[0]).scrollIntoView=="function"&&r.scrollIntoView():$("html, body").animate({scrollTop:0},"fast"))}return this},$.fn.swap_with=function(e){var t,n,r,i,o,u,a,l;if(e=$(e),!!(this.length&&e.length))return n=this.offset(),i=e.offset(),l=this.prop("tagName"),u=e.prop("tagName"),a=$("<"+l+"></"+l+">").insertAfter(this),o=$("<"+u+"></"+u+">").insertAfter(e),a.after(e),o.after(this),t=this.offset(),r=e.offset(),o.replaceWith(this.detach().css({position:"relative",top:n.top-t.top+"px",left:n.left-t.left+"px"})),a.replaceWith(e.detach().css({position:"relative",top:i.top-r.top+"px",left:i.left-r.left+"px"})),_.defer(function(s){return function(){return s.css({top:"",left:""}),e.css({top:"",left:""})}}(this))},$.fn.track_input=function(e,t){var n,r;return n=this.find(e),r=function(i){return function(){var o,u,a;return a=function(){var l,s,f;for(f=[],l=0,s=n.length;l<s;l++)u=n[l],f.push(t+"_"+$(u).attr("value"));return f}(),i.removeClass(a.join(" ")),o=n.serializeArray().map(function(l){return t+"_"+l.value}),i.addClass(o.join(" "))}}(this),n.on("change",function(i){return r()}),r()};var U,E=U=window.$,B,L=function(e,t){return function(){return e.apply(t,arguments)}};B=function(){function e(t){this.embed_data=t,this.load=L(this.load,this)}return e.prototype.load=function(){return this._load||(this._load=E.Deferred(function(t){return function(n){var r,i;if(!t.embed_data.url){if(!t.embed_data.load_url){n.reject(["Can't load file"]);return}return i=1e3,r=function(){if(n.state()==="pending")return E.get(t.embed_data.load_url,function(o){if(o.url){n.resolve(o.url);return}if(o.status==="extracting"&&setTimeout(function(){return i=Math.min(5e3,i*1.2),console.log(i),r()},i),o.errors)return n.reject(o.errors)}),!0},r()}}}(this)))},e}(),I.UploadEmbed=function(){function e(t,n){var r;this.opts=n,this.embed_swf=L(this.embed_swf,this),this.el=E(t),r=new B(this.opts.upload).load(),r.done(function(i){return function(o){return i.el.removeClass("loading"),i.iframe=i.el.find("#game_drop"),i.iframe.attr("src",o)}}(this)),r.fail(function(i){return function(o){return i.show_error(o)}}(this)),this.embed_swf(),this.el.dispatch("click",{fullscreen_btn:function(i){return function(o){var u;return u=E("#game_drop"),I.toggle_fullscreen(u[0])}}(this)})}return e.prototype.embed_swf=function(){var t;if(this.opts.upload.type==="flash")return t=this.el.find(".game_frame"),window.swfobject.embedSWF(this.opts.upload.url,"swf_drop",t.width(),t.height(),"11.0.0",!1,{},{wmode:"direct"})},e.prototype.show_error=function(t){var n;return n=this.el.find(".game_loading"),n.text(t.join(", ")),n.addClass("has_errors")},e}()})();
