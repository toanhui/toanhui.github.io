(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[54364,99384,54566],{39694:function(e,t,n){var i="__lodash_hash_undefined__",s="[object Function]",r="[object GeneratorFunction]",l=/^\[object .+?Constructor\]$/,o="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,a="object"==typeof self&&self&&self.Object===Object&&self,c=o||a||Function("return this")();var d=Array.prototype,u=Function.prototype,x=Object.prototype,p=c["__core-js_shared__"],f=function(){var e=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),m=u.toString,h=x.hasOwnProperty,v=x.toString,g=RegExp("^"+m.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),b=d.splice,j=_(c,"Map"),w=_(Object,"create");function y(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function N(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function S(e,t){for(var n,i,s=e.length;s--;)if((n=e[s][0])===(i=t)||n!==n&&i!==i)return s;return-1}function k(e){if(!T(e)||(t=e,f&&f in t))return!1;var t,n=function(e){var t=T(e)?v.call(e):"";return t==s||t==r}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?g:l;return n.test(function(e){if(null!=e){try{return m.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}function O(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function _(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return k(n)?n:void 0}function C(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,s=t?t.apply(this,i):i[0],r=n.cache;if(r.has(s))return r.get(s);var l=e.apply(this,i);return n.cache=r.set(s,l),l};return n.cache=new(C.Cache||P),n}function T(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}y.prototype.clear=function(){this.__data__=w?w(null):{}},y.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},y.prototype.get=function(e){var t=this.__data__;if(w){var n=t[e];return n===i?void 0:n}return h.call(t,e)?t[e]:void 0},y.prototype.has=function(e){var t=this.__data__;return w?void 0!==t[e]:h.call(t,e)},y.prototype.set=function(e,t){return this.__data__[e]=w&&void 0===t?i:t,this},N.prototype.clear=function(){this.__data__=[]},N.prototype.delete=function(e){var t=this.__data__,n=S(t,e);return!(n<0)&&(n==t.length-1?t.pop():b.call(t,n,1),!0)},N.prototype.get=function(e){var t=this.__data__,n=S(t,e);return n<0?void 0:t[n][1]},N.prototype.has=function(e){return S(this.__data__,e)>-1},N.prototype.set=function(e,t){var n=this.__data__,i=S(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},P.prototype.clear=function(){this.__data__={hash:new y,map:new(j||N),string:new y}},P.prototype.delete=function(e){return O(this,e).delete(e)},P.prototype.get=function(e){return O(this,e).get(e)},P.prototype.has=function(e){return O(this,e).has(e)},P.prototype.set=function(e,t){return O(this,e).set(e,t),this},C.Cache=P,e.exports=C},54566:function(e,t,n){"use strict";n.r(t);var i=n(13838),s=n(93981),r=n(72215),l=n(25546),o=n(29541);t.default=function(e){var t=e.tokenInfo,n=e.amount,a=e.maxDecimals,c=e.prefix,d=e.priceType,u=(0,r.y6)(),x=u.tokenPriceMap,p=u.getUSDValue,f=t.address;(0,s.useEffect)((function(){f&&p([f])}),[f,p]);var m=(0,s.useMemo)((function(){var e;if(!f)return null;var t=x[f],n=null===t||void 0===t?void 0:t.extraInfo,i=(null===(e=x[f])||void 0===e?void 0:e.usd)||null;return null!==n&&void 0!==n&&n.usdBuyPrice&&"buy"===d?null===n||void 0===n?void 0:n.usdBuyPrice:null!==n&&void 0!==n&&n.usdSellPrice&&"sell"===d?null===n||void 0===n?void 0:n.usdSellPrice:i}),[f,d,x]),h=m?new i.Z(n||0).mul(m):null;return!h||h.lte(0)?(0,o.jsx)(o.Fragment,{children:""}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:"flex justify-end",children:a&&new i.Z(h).lte(.1)?"".concat(c||"","$").concat(parseFloat(l.uf.format(h,a))):"".concat(c||"","$").concat(l.uf.format(h,2))})})}},80751:function(e,t,n){"use strict";var i=n(25224),s=n(93981),r=n(29541);t.Z=function(e){var t=e.open,n=e.onClose,l=e.children,o=(0,s.useRef)(null);(0,i.O3)(o,(function(){var e;return null===(e=o.current)||void 0===e?void 0:e.close()}));var a=(0,s.useCallback)((function(){var e;null===(e=o.current)||void 0===e||e.close(),n()}),[n,o]);return(0,s.useEffect)((function(){if(o.current&&(t?o.current.open||o.current.show():o.current.close()),t){var e=o.current;return null===e||void 0===e||e.addEventListener("close",a),function(){null===e||void 0===e||e.removeEventListener("close",a)}}}),[a,t]),(0,r.jsx)("dialog",{ref:o,className:"fixed top-0 z-40 flex animate-fade-in items-center justify-center rounded-lg bg-black/30 backdrop-blur-sm",children:l})}},71130:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(93981),s=n(50269),r=n(24201),l=n(29541),o=function(e){var t=e.children,n=e.className,s=void 0===n?"":n,o=e.height,a=e.maxHeight,c=e.expanded,d=(0,i.useState)(o),u=d[0],x=d[1];(0,i.useEffect)((function(){x(c?a:o)}),[o,a,c]);var p=c?"animate-fade-in":"animate-fade-out";return(0,l.jsx)("div",{className:(0,r.cn)("overflow-hidden transition-all duration-200",p,s),style:{height:u,maxHeight:a},children:t})},a=function(e){var t=e.message,n=e.iconSize,i=void 0===n?20:n,a=e.className;return(0,l.jsx)(o,{height:0,maxHeight:"auto",expanded:Boolean(t),children:(0,l.jsxs)("div",{className:(0,r.cn)("mt-1 flex items-center fill-current text-xs font-semibold text-white md:px-6",a),children:[(0,l.jsx)(s.Z,{width:i,style:{minWidth:i},height:i}),(0,l.jsx)("span",{className:"ml-2",children:t})]})})}},32529:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var i=n(70107),s=n(27177),r=n(93981);function l(e,t){return Array(t-e+1).fill(void 0).map((function(t,n){return e+n}))}function o(e){var t=e.pageIndex,n=void 0===t?0:t,o=e.pageCount,a=void 0===o?0:o,c=e.setPageIndex,d=(0,s.XA)(),u=r.useMemo((function(){var e=n+1;return d?a<=5?l(1,a):e<=2?[].concat((0,i.Z)(l(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(l(a-2,a))):[1,"...",e,"...",a]:a<=8?l(1,a):e<=2?[].concat((0,i.Z)(l(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(l(a-2,a))):[1,"..."].concat((0,i.Z)(l(e,e+2)),["...",a])}),[n,d,a]),x=(0,r.useMemo)((function(){return n>0}),[n]),p=(0,r.useMemo)((function(){return n<a-1}),[n,a]),f=(0,r.useCallback)((function(e){return c(e)}),[c]);return{pager:u,canPreviousPage:x,canNextPage:p,gotoPage:f}}},30825:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(4707),s=n(63956),r=n(63989),l=(n(93981),n(29541));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=function(e){var t=(0,r.Z)({},e);return(0,l.jsx)("svg",a(a({width:"53",height:"52",viewBox:"0 0 53 52",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:(0,l.jsx)("path",{d:"M17.3336 23.8334H43.7062V28.1667H17.3336L28.9555 39.7887L25.8919 42.8524L9.03955 26L25.8919 9.14771L28.9555 12.2114L17.3336 23.8334Z",fill:"currentColor"})}))},d=n(24201),u=function(e){var t=e.canPreviousPage,n=e.gotoPage,s=e.pageIndex,r=e.pager,o=e.canNextPage;return(0,l.jsxs)("div",{className:"mb-20 flex flex-row justify-between px-2 py-3 lg:px-6 lg:py-5",children:[(0,l.jsxs)("button",{type:"button",disabled:!t,onClick:function(){return n(s-1)},className:"flex cursor-pointer flex-row items-center text-v2-lily text-opacity-50 hover:text-opacity-100 disabled:cursor-not-allowed",children:[(0,l.jsx)(c,{width:12,height:12}),(0,l.jsx)("span",{className:"ml-1 text-xs lg:ml-2",children:i.ag._({id:"DHhJ7s"})})]}),(0,l.jsx)("div",{className:"flex flex-row space-x-1 lg:space-x-2",children:r.map((function(e,t){var i=e===s+1,r="".concat(e,"-").concat(t);return"string"===typeof e?(0,l.jsx)("div",{className:"flex flex-row items-center justify-center text-xs",children:e},r):(0,l.jsx)("div",{onClick:function(){return n(e-1)},className:(0,d.cn)("flex h-8 w-8 cursor-pointer flex-row items-center justify-center rounded-lg text-xs text-[#E8F9FF]/50 hover:text-v2-primary lg:h-10 lg:w-10",{"border border-v2-primary/50 bg-v2-primary/10 font-semibold !text-v2-primary":i}),children:e},r)}))}),(0,l.jsxs)("button",{type:"button",disabled:!o,onClick:function(){return n(s+1)},className:"flex cursor-pointer flex-row items-center text-v2-lily text-opacity-50 hover:text-opacity-100 disabled:cursor-not-allowed",children:[(0,l.jsx)("span",{className:"mr-2 text-xs",children:i.ag._({id:"hXzOVo"})}),(0,l.jsx)(c,{width:12,height:12,className:"rotate-180"})]})]})}},19424:function(e,t,n){"use strict";n(93981);var i=n(12869),s=n(24201),r=n(29541);t.Z=function(e){var t=e.children;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{product:"perps",className:"z-10 w-full sm:max-w-[90vw] md:w-[460px]",activeClassName:"my-2 lg:my-4"}),(0,r.jsx)("div",{className:(0,s.cn)("bg-v2-perps flex min-h-full w-full max-w-[100vw] flex-1"),children:t})]})}},50944:function(e,t,n){"use strict";n.d(t,{Y8:function(){return g},hb:function(){return N},zu:function(){return b}});var i=n(63956),s=n(8473),r=n(4707),l=n(93981),o=n(40558),a=n(13838),c=n(64508),d=n.n(c),u=n(56100),x=n(50269),p=n(24201),f=n(25546),m=n(29541);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=(0,l.memo)((function(e){var t=e.collateralInput,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between lg:flex-row lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs text-white/50",children:r.ag._({id:"62Xcjh"})}),(0,m.jsx)(o.Z,{variant:"dark",content:(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("p",{className:"text-xs",children:r.ag._({id:"yCJmzk"})}),(0,m.jsx)("p",{className:"text-xs",children:r.ag._({id:"dTqFSi"})})]}),children:(0,m.jsx)("div",{translate:"no",className:"mt-0.5 text-xs text-white/75",children:t&&!n?(0,m.jsxs)("span",{children:[f.uf.format(t,2)," USD"]}):!t||null!==t&&void 0!==t&&t.eq(0)?(0,m.jsx)("span",{className:"h-[14px] text-xs text-white/75",children:"-"}):(0,m.jsx)(u.O,{className:"h-[14px] !w-20"})})})]})})),b=(0,l.memo)((function(e){var t=e.sizeUsd,n=e.collateralInput,i=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between lg:flex-row lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs leading-none text-white/50",children:r.ag._({id:"ng1Bxe"})}),(0,m.jsx)("div",{translate:"no",className:"mt-0.5 text-xs text-white/75",children:t&&!i?(0,m.jsx)("span",{translate:"no",className:"h-[14px] text-xs text-white/75",children:(0,m.jsxs)("span",{children:[f.uf.format(t,2)," USD"]})}):!n||null!==n&&void 0!==n&&n.eq(0)?(0,m.jsx)("span",{className:"h-[14px] text-xs text-white/75",children:"-"}):(0,m.jsx)(u.O,{className:"h-[14px] !w-20"})})]})})),j=(0,l.memo)((function(e){var t=e.orderInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between lg:flex-row lg:items-center",children:[(0,m.jsx)("span",{className:"text-xs text-white/50",children:r.ag._({id:"vunSwa"})}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:t.entryPriceTextWithShifting&&!n?t.entryPriceTextWithShifting:(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),w=(0,l.memo)((function(e){var t=e.orderInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between lg:flex-row lg:items-center",children:[(0,m.jsxs)("span",{className:"flex items-center leading-none",children:[(0,m.jsx)("span",{className:(0,p.cn)("inline-block text-xs lg:hidden",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:r.ag._({id:"drdV8R"})}),(0,m.jsx)("span",{className:(0,p.cn)("hidden text-xs lg:inline-block",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:r.ag._({id:"jK/Hx9"})}),t.isNewLiquidationWorse&&!n?(0,m.jsx)(o.Z,{buttonContentClassName:"ml-1 inline-block",content:r.ag._({id:"wqCLIS"}),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"fill-current text-warning"})}):null]}),(0,m.jsx)("span",{className:(0,p.cn)("mt-1 text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/75"),children:t.liquidationPriceTextWithShifting&&!n?t.liquidationPriceTextWithShifting:(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),y=(0,l.memo)((function(e){var t=e.custodyAccount,n=e.orderInfo,i=e.orderInfoLoading,s=t?new a.Z(t.account.increasePositionBps.toString()).div(100):null;return(0,m.jsxs)("div",{className:"flex flex-col justify-between lg:flex-row lg:items-center",children:[t?(0,m.jsx)("span",{className:"whitespace-nowrap text-xs text-white/50",children:r.ag._({id:"gHyRoQ",values:{openFeePct:s}})}):(0,m.jsx)(u.O,{className:"!h-4 !w-20"}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:n.openFeeUsdText&&!i?"".concat(n.openFeeUsdText):(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),N=(0,l.memo)((function(e){var t=e.impactPct,n=e.impactFeeUsdText,i=e.orderInfoLoading,s=e.breakline;return(0,m.jsxs)("div",{className:(0,p.cn)("flex !w-full justify-between text-xs text-white/50 lg:flex-row lg:items-center",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":"",s?"flex-col":""]),children:[(0,m.jsxs)("span",{className:"inline-block fill-current leading-none lg:flex lg:flex-row lg:items-center",children:[r.ag._({id:"kH6wUX"})," ",t?"(".concat(null===t||void 0===t?void 0:t.toFixed(2),"%)"):"",(0,m.jsx)("div",{className:"ml-1 inline-block fill-current",children:(0,m.jsx)(o.Z,{content:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{children:"Price impact is calculated based on your order size, you can reduce your price impact by splitting your orders."}),(0,m.jsx)(d(),{href:"https://www.jupresear.ch/t/jupiter-perpetuals-price-impact-fee-mechanism/17140",target:"_blank",className:"underline",children:(0,m.jsx)("p",{className:"mt-2",children:r.ag._({id:"NgeSlx"})})})]}),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"mb-0.5 inline-block md:mb-0"})})})]}),(0,m.jsx)("span",{className:(0,p.cn)("text-xs text-white/75",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":""]),children:n&&!i?n:(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),P=(0,l.memo)((function(e){var t=e.positionInfo,n=e.orderInfo,i=e.orderInfoLoading;return(0,m.jsxs)("div",{className:(0,p.cn)("flex flex-col justify-between text-xs lg:flex-row lg:items-center",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/50"),children:[(0,m.jsxs)("span",{className:"inline-block leading-none lg:flex lg:flex-row lg:items-center",children:[r.ag._({id:"vvSf/c"}),(0,m.jsx)("div",{className:"ml-1 inline-block fill-current",children:(0,m.jsx)(o.Z,{content:r.ag._({id:"DJnz3q"}),children:(0,m.jsx)(x.Z,{width:12,height:12,className:"mb-0.5 inline-block md:mb-0"})})})]}),(0,m.jsx)("span",{className:(0,p.cn)("text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/75"),children:n.outstandingFundingFeeUsdText&&!i?"".concat(n.outstandingFundingFeeUsdText):(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),S=(0,l.memo)((function(e){var t=e.positionInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between gap-x-4 lg:flex-row lg:items-center",children:[(0,m.jsxs)("div",{className:"flex !h-4 items-center fill-current text-xs text-white/50",children:[(0,m.jsx)("span",{className:"mr-1 text-xs text-white/50",children:r.ag._({id:"1oyh4g"})}),(0,m.jsx)(o.Z,{variant:"dark",placement:"top",content:(0,m.jsx)("p",{className:"flex items-center text-xs",children:(0,m.jsx)(s.cC,{id:"JrDMLE",values:{0:t.hourlyFundingDbps.div(1e3).toString()}})}),children:(0,m.jsx)(x.Z,{width:12,height:12})})]}),(0,m.jsx)("span",{className:"flex items-center text-xs text-white/75",children:t.borrowFeeText&&!n?t.borrowFeeText:(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),k=(0,l.memo)((function(e){var t=e.positionInfo,n=e.orderInfoLoading;return(0,m.jsxs)("div",{className:"flex flex-col justify-between gap-x-4 lg:flex-row lg:items-center",children:[(0,m.jsx)("span",{className:"block text-xs text-white/50 lg:hidden",children:r.ag._({id:"ic09KK"})}),(0,m.jsx)("span",{className:"hidden text-xs text-white/50 lg:block",children:r.ag._({id:"2O3qp5"})}),(0,m.jsx)("span",{className:"text-xs text-white/75",children:t.availableLiquidityText&&!n?t.availableLiquidityText:(0,m.jsx)(u.O,{className:"!h-4 !w-16"})})]})})),O=(0,l.memo)((function(e){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"hidden w-full rounded-lg p-3 lg:block",children:(0,m.jsx)("div",{className:"w-full rounded-lg border border-white/5 p-3",children:(0,m.jsxs)("div",{className:"space-y-1",children:[(0,m.jsx)(j,v({},e)),(0,m.jsx)(w,v({},e)),(0,m.jsx)(y,v({},e)),(0,m.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading}),e.orderInfo.outstandingFundingFeeUsdText?(0,m.jsx)(P,v({},e)):null,(0,m.jsx)(S,v({},e)),(0,m.jsx)(k,v({},e))]})})}),(0,m.jsx)("div",{className:"block min-h-full w-full !min-w-[110px] max-w-[30vw] bg-[#1E2A36] px-1.5 pt-3 lg:hidden",children:(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsx)(g,v({},e)),(0,m.jsx)(b,v({},e)),(0,m.jsx)(j,v({},e)),(0,m.jsx)(w,v({},e)),(0,m.jsx)(y,v({},e)),(0,m.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading,breakline:!0}),e.orderInfo.outstandingFundingFeeUsdText?(0,m.jsx)(P,v({},e)):null,(0,m.jsx)(S,v({},e)),(0,m.jsx)(k,v({},e))]})})]})}));t.ZP=O},13020:function(e,t,n){"use strict";var i=n(4707),s=n(13838),r=n(9319),l=n.n(r),o=n(93981),a=n(25224),c=n(13486),d=n(80989);t.Z=function(e){var t=e.fromPairTokenInfo,n=e.toPairTokenInfo,r=e.fromPairValue,u=(0,c.tc)().slippage,x=(0,o.useMemo)((function(){return!(!t||!n)&&t.address!==n.address}),[t,n]),p=(0,o.useMemo)((function(){return(0,a.Hd)(r)&&t?l().BigInt(new s.Z(r).mul(Math.pow(10,t.decimals)).round().toFixed()||0):l().BigInt(0)}),[r,t]),f=(0,d.Z)({disabled:!x,amount:p,fromTokenInfo:t,toTokenInfo:n,slippage:u}),m=f.isLoading,h=f.outAmount,v=f.otherAmountThreshold,g=f.quoteResponseMeta,b=f.useJupError,j=f.refresh,w=f.lastRefreshTimestamp,y=(0,o.useMemo)((function(){if(x&&b)return i.ag._({id:"pzwWY5"})}),[b,x]);return{isLoading:!!x&&m,isTokenSwapRequired:x,outAmount:h,otherAmountThreshold:v,quoteResponseMeta:g,hasJupiterError:y,refresh:j,lastRefreshTimestamp:w}}},24802:function(e,t,n){"use strict";n.d(t,{Z:function(){return B}});var i,s=n(70107),r=n(63956),l=n(97620),o=n(27195),a=n(8857),c=n.n(a),d=n(4707),u=n(24309),x=n(18849),p=n(57281),f=n(67768),m=n(32532),h=n(72215),v=n(27177),g=n(38272),b=n(91551),j=n.n(b),w=n(3011),y=n(93981),N=n(2485),P=n(59394),S=n(85948),k=n(24628),O=n(59890),_=n(57917),C=n(11421),T=n(6397),Z=n(13486),D=n(53024),M=n(13838),F=function(e,t){return new M.Z(t).mul(Math.pow(10,9)).mul(Math.pow(10,6)).div(e).toDP(0).toNumber()},A=function(){var e=(0,Z.tc)().maxPriorityFeesInSol,t=(0,w.KO)(D.yz),n=(0,l.Z)(t,1)[0];return function(t){(0,m.Qm)(t,T.s_);var i=F(T.s_,D.uo||0),s=new M.Z(n.perps.vh||0),r=M.Z.max(s,i);(0,m.CF)(t,r.toNumber()),console.log("[] perps CUP",{minimumCUP:i,marketReferenceCUP:s.toNumber(),computedCUP:r.toNumber()});var l,o,a=(l=T.s_,o=r.toNumber(),new M.Z(l).mul(o).div(Math.pow(10,6)).div(Math.pow(10,9)).toDecimalPlaces(9).toNumber());if(console.log("[] perps priority fee in SOL",{computedPriorityFeesInSol:a,userMaxPriorityFeesInSol:e}),a>e){var c=F(T.s_,e);console.log("[] Computed reference fee too high, exceeded user's max fee. Modifying CUP from ".concat(r," to ").concat(c)),(0,m.CF)(t,c)}}},E=n(55540),I=n(34166),R=n(29541),q=n(795).Buffer;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.MAX_ATTEMPTS="MAX_ATTEMPTS",e.FAILED_TO_CLOSE_REQUEST="FAILED_TO_CLOSE_REQUEST",e.COLLATERAL_REFUNDED="COLLATERAL_REFUNDED"}(i||(i={}));function K(e,t,n){return V.apply(this,arguments)}function V(){return V=(0,o.Z)(c().mark((function e(t,n,i){var s,r,l,o,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.length>3&&void 0!==a[3]?a[3]:5,e.prev=1,e.next=4,t.getTransactions(n,{commitment:"confirmed",maxSupportedTransactionVersion:0});case 4:if(l=e.sent,o=null===(r=l[0])||void 0===r?void 0:r.slot,l&&o&&!(o<i)){e.next=15;break}return e.next=9,(0,f.gw)(1e3);case 9:if(console.log("retrying",o,i),!(s>0)){e.next=14;break}return e.abrupt("return",K(t,n,i,s-1));case 14:case 23:return e.abrupt("return",null);case 15:return e.abrupt("return",l);case 18:if(e.prev=18,e.t0=e.catch(1),!e.t0||!e.t0.message.includes(I.VU)){e.next=23;break}return console.log("retrying due to error"),e.abrupt("return",K(t,n,i,s-1));case 24:case"end":return e.stop()}}),e,null,[[1,18]])}))),V.apply(this,arguments)}var B=function(){var e=(0,Z.tc)(),t=e.refreshPositionInfo,n=e.maxRequestExecutionSec,i=(0,_.SR)(),r=i.addNotificationTx,a=i.updateNotificationTxStatus,f=(0,v.lm)(),b=f.toast,D=f.close,M=(0,h.Os)(),F=M.wallet,I=M.signTransaction,L=M.signAllTransactions,V=(0,h.Bn)().connection,B=(0,h.C9)(),z=A(),H=(0,w.KO)(O.J),W=(0,l.Z)(H,2),$=(W[0].lastSubmissionSlot,W[1]),G=(0,y.useMemo)((function(){return new g.Connection(V._rpcEndpoint,"confirmed")}),[V]),Y=(0,y.useMemo)((function(){var e=new u.Y7(G,{},u.Y7.defaultOptions());return[e,new u.$r(E.x,Z.KX,e)]}),[G]),X=(Y[0],Y[1]),J=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,i,s,r,l,u,f){var m,h,v,w,y,S,O,_,C,D,M;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(V,[i],f);case 2:if(m=e.sent,(h=null===m||void 0===m?void 0:m[0])&&h.blockTime){e.next=6;break}throw"Transaction not found";case 6:return v=h.blockTime,w=1e3*(v+(n||45)),y=void 0,S="",O="",_=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,s,r,l,o,a,d,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(V,t,h.slot);case 2:if(i=e.sent){e.next=5;break}throw new Error("Failed to retrieve transaction status for ".concat(t));case 5:if(null!==(n=i[0])&&void 0!==n&&n.slot&&$({lastSubmissionSlot:null===(s=i[0])||void 0===s?void 0:s.slot}),r=i.flatMap((function(e){var t,n,i=null===e||void 0===e?void 0:e.transaction.message.staticAccountKeys.findIndex((function(e){return e.equals(Z.KX)}));return null===e||void 0===e||null===(t=e.meta)||void 0===t||null===(n=t.innerInstructions)||void 0===n?void 0:n.flatMap((function(t){return t.instructions.map((function(t){if(t.programIdIndex===i){var n=j().decode(t.data),s=x.base64.encode(n.subarray(8));return{event:X.coder.events.decode(s),tx:e}}}))}))})),l=r.find((function(e){var t,n;return"IncreasePositionEvent"===(null===e||void 0===e||null===(t=e.event)||void 0===t?void 0:t.name)||"DecreasePositionEvent"===(null===e||void 0===e||null===(n=e.event)||void 0===n?void 0:n.name)})),o=r.find((function(e){var t;return"ClosePositionRequestEvent"===(null===e||void 0===e||null===(t=e.event)||void 0===t?void 0:t.name)})),!l){e.next=13;break}return y=!0,S=l.tx.transaction.signatures[0],e.abrupt("return");case 13:if("undefined"!==typeof l||!o){e.next=25;break}if(y=!1,S=o.tx.transaction.signatures[0],a=o.tx.transaction.message.staticAccountKeys,d=a.findIndex((function(e){return e.equals(new g.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"))}))){e.next=20;break}return e.abrupt("return");case 20:if(u=o.tx.transaction.message.compiledInstructions.find((function(e){return e.programIdIndex===d}))){e.next=23;break}return e.abrupt("return");case 23:return O=q.from(u.data).toString(),e.abrupt("return");case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=(0,o.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof y){e.next=19;break}return e.next=3,(0,p.Dc)(5e3);case 3:if(!(Date.now()>w)){e.next=7;break}return y=!1,O="Failed to retrieve transaction status",e.abrupt("break",19);case 7:return e.next=9,G.getSignaturesForAddress(new g.PublicKey(s),{until:i});case 9:if(t=e.sent,0!==(n=t.filter((function(e){return null===e.err})).map((function(e){return e.signature}))).length){e.next=13;break}return e.abrupt("continue",0);case 13:if("undefined"===typeof y){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,_(n);case 17:e.next=0;break;case 19:console.log("pollForEvent done");case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){D=G.onLogs(new g.PublicKey(s),function(){var t=(0,o.Z)(c().mark((function t(n){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.err){t.next=6;break}if("undefined"===typeof y){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,_([n.signature]);case 5:e();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 2:console.log("listenToEvent done");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=16,Promise.any([C(),M()]).finally((function(){D&&G.removeOnLogsListener(D)}));case 16:return y?(a(t,{status:"success",stepText:"",txid:S}),b({duration:T.ET,id:t,render:function(e){return(0,R.jsx)(N.x,U({customTitle:"open"===r?d.ag._({id:"wDGM8h"}):"partial-close"===r?d.ag._({id:"M1Wg5E"}):"close"===r?d.ag._({id:"8hvfaA"}):"increase-collateral"===r?d.ag._({id:"auF9U1"}):void 0},e))},draggable:!0,shouldShowCloseIcon:!0}),l(!0)):(b({duration:T.sS,id:t,render:function(e){var t=S?"open"===r?d.ag._({id:"Sn546U"}):"partial-close"===r?d.ag._({id:"yk2xFb"}):"close"===r?d.ag._({id:"okV5rM"}):"increase-collateral"===r?d.ag._({id:"30B/NO"}):void 0:d.ag._({id:"KYA4Gh"});return(0,R.jsx)(N.x,U({customTitle:t},e))},draggable:!0,shouldShowCloseIcon:!0}),S?a(t,{txid:void 0,status:"fail",stepText:O||"Failed to execute request"},{shouldShowFeedbackLink:!1,hasAdditionalPendingSteps:!1,additionalSteps:["open"===r||"increase-collateral"===r?(0,R.jsxs)("p",{className:"ml-7 mt-3 flex items-center space-x-1",children:[(0,R.jsx)("span",{children:d.ag._({id:"eZ3g+8"})}),(0,R.jsx)(P.Z,{txid:S}),(0,R.jsx)(k.Z,{})]},"additionalSteps-1"):null].filter(Boolean)}):a(t,{txid:S,status:"unknown",stepText:d.ag._({id:"1W4buJ"})},{hasAdditionalPendingSteps:!1,additionalSteps:[(0,R.jsxs)("p",{className:"ml-7",children:[(0,R.jsx)("p",{className:"mt-2",children:d.ag._({id:"6R5FK4"})}),(0,R.jsxs)("ul",{className:"mt-2 w-full list-outside list-disc space-y-1.5 px-3 text-v2-lily/50",children:[(0,R.jsx)("li",{className:"list-outside",children:d.ag._({id:"SnHWX8"})}),(0,R.jsx)("li",{className:"list-outside",children:d.ag._({id:"/MH8hT"})}),(0,R.jsx)("li",{className:"list-outside",children:d.ag._({id:"YwR4pf"})}),(0,R.jsx)("li",{className:"list-outside",children:(0,R.jsx)("div",{className:"flex items-center gap-x-2",children:(0,R.jsx)("span",{children:d.ag._({id:"Ayb2QF"})})})})]})]},"additionalSteps-1")].filter(Boolean)}),u(!0)),e.abrupt("return",{success:y,txId:S,error:O});case 18:case"end":return e.stop()}}),e)})));return function(t,n,i,s,r,l,o){return e.apply(this,arguments)}}(),[G,V,n,X.coder.events,$,b,a]),Q=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r,l,a,d,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L){e.next=3;break}throw new Error("Wallet not connected, or signAllTransactions not found");case 3:return e.next=5,V.getLatestBlockhashAndContext("finalized");case 5:return n=e.sent,i=n.context,r=n.value,l=r.blockhash,a=r.lastValidBlockHeight,e.next=12,Promise.all(t.map(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n=new g.Transaction({blockhash:l,lastValidBlockHeight:a,feePayer:F.adapter.publicKey})).add.apply(n,(0,s.Z)(t)),z(i),e.abrupt("return",i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return d=e.sent,e.next=15,L(d);case 15:return u=e.sent,e.abrupt("return",u.map((function(e){return{txid:(0,m.o$)(e),signedTransaction:e,blockhash:l,lastValidBlockHeight:a,context:i}})));case 19:throw e.prev=19,e.t0=e.catch(0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),[V,z,L,F]),ee=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i,s){var o,a,u,x,p,f,h,v,g,j,w,y,k,O,_,T,M=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=M.length>4&&void 0!==M[4]?M[4]:{},F&&I){e.next=3;break}return e.abrupt("return");case 3:return f="request",h=String(Math.floor(1e4*Math.random())),e.prev=5,(0,C.Kz)(S.Ll.INCREASE_POSITION_REQUEST,U({},o)),e.next=9,Q([t]);case 9:return v=e.sent,g=(0,l.Z)(v,1),j=g[0],w=j.signedTransaction,y=j.blockhash,k=j.lastValidBlockHeight,u=Date.now(),r(h,{status:"loading",txid:"",stepText:"Opening Position"}),b({duration:12e4,id:h,render:function(e){return(0,R.jsx)(N.x,U({customTitle:d.ag._({id:"jnQL0G"})},e))},draggable:!1,closeOnClick:!1,shouldShowCloseIcon:!1}),e.next=20,(0,m.ie)({signedTransaction:w,blockhash:y,connection:V,lastValidBlockHeight:k,idl:E.x,idlProgramId:Z.KX,skipPreflight:!0});case 20:if(!("error"in(O=e.sent))){e.next=23;break}throw O.error;case 23:return x=Date.now(),p=x-u,(0,C.Kz)(S.Ll.INCREASE_POSITION_REQUEST_SUCCESS,U({txid:a,requestTimeSeconds:p/1e3},o)),r(h,{status:"loading",txid:"",stepText:d.ag._({id:"/Snnuz"})}),f="pickup",a=O.txid,e.next=31,J(h,a,n.toString(),"open",i,(function(){(0,C.Kz)(S.Ll.INCREASE_POSITION_NOT_CONFIRMED,U({txid:a,requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:x?(Date.now()-x)/1e3:void 0},o)),s(!0)}),O.transactionResponse.slot);case 31:(0,C.Kz)(S.Ll.INCREASE_POSITION_SUCCESS,U({requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:(Date.now()-x)/1e3,txid:a},o)),e.next=43;break;case 34:e.prev=34,e.t0=e.catch(5),T=e.t0.message||d.ag._({id:"JF+tQF"}),console.log("handleSendTransaction error",T),s(!0),b({title:"Failed to perform transaction",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:T}),(0,R.jsx)("div",{children:a?(0,R.jsx)(P.Z,{txid:a}):null})]}),variant:"ERROR"}),D(h),u&&"request"===f&&(x=Date.now(),p=x-u),(0,C.Kz)("request"===f?S.Ll.INCREASE_POSITION_REQUEST_FAILED:S.Ll.INCREASE_POSITION_FAILED,U({requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:"pickup"===f&&x?(Date.now()-x)/1e3:void 0,errorCode:null===e.t0||void 0===e.t0||null===(_=e.t0.error)||void 0===_?void 0:_.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message,txid:a},o));case 43:case"end":return e.stop()}}),e,null,[[5,34]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[F,I,Q,r,b,V,J,D]),te=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i,s,l,o,a,u,x){var p,f,h,v,g,j,w,y,k=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=k.length>9&&void 0!==k[9]?k[9]:{},f=Date.now(),g="request",e.prev=3,(0,C.Kz)(S.Ll.DECREASE_POSITION_REQUEST,U({},p)),r(t,{status:"loading",txid:"",stepText:d.ag._({id:"G6a8Xn"})}),b({duration:12e4,id:t,render:function(e){return(0,R.jsx)(N.x,U({customTitle:d.ag._({id:"jx4d9N"})},e))},draggable:!1,closeOnClick:!1,shouldShowCloseIcon:!1}),e.next=9,(0,m.ie)({signedTransaction:n,blockhash:i,connection:V,lastValidBlockHeight:s,idl:E.x,idlProgramId:Z.KX,skipPreflight:!0});case 9:if(!("error"in(j=e.sent))){e.next=12;break}throw j.error;case 12:return h=Date.now(),v=h-f,(0,C.Kz)(S.Ll.DECREASE_POSITION_REQUEST_SUCCESS,U({txid:x,requestTimeSeconds:v/1e3},p)),r(t,{status:"loading",txid:"",stepText:d.ag._({id:"n80Nyg"})}),g="pickup",x=j.txid,e.next=20,J(t,x,o.toString(),"close",a,(function(){(0,C.Kz)(S.Ll.DECREASE_POSITION_NOT_CONFIRMED,U({txid:x,requestTimeSeconds:v?v/1e3:void 0,pickupTimeSeconds:h?(Date.now()-h)/1e3:void 0},p)),u(!0)}),j.transactionResponse.slot);case 20:(0,C.Kz)(S.Ll.DECREASE_POSITION_SUCCESS,U({requestTimeSeconds:v?v/1e3:void 0,pickupTimeSeconds:(Date.now()-h)/1e3,txid:x},p)),e.next=32;break;case 23:e.prev=23,e.t0=e.catch(3),y=e.t0.message||d.ag._({id:"60cOBW"}),console.error(e.t0),u(!0),b({title:"Failed to perform transaction",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:y}),(0,R.jsx)("div",{children:x?(0,R.jsx)(P.Z,{txid:x}):null})]}),variant:"ERROR"}),D(t),"request"===g&&(h=Date.now(),v=h-f),(0,C.Kz)("request"===g?S.Ll.DECREASE_POSITION_REQUEST_FAILED:S.Ll.DECREASE_POSITION_FAILED,U({requestTimeSeconds:v?v/1e3:void 0,pickupTimeSeconds:"pickup"===g&&h?(Date.now()-h)/1e3:void 0,errorCode:null===e.t0||void 0===e.t0||null===(w=e.t0.error)||void 0===w?void 0:w.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message,txid:x},p));case 32:case"end":return e.stop()}}),e,null,[[3,23]])})));return function(t,n,i,s,r,l,o,a,c){return e.apply(this,arguments)}}(),[r,D,V,J,b]),ne=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i,s){var r,o,a,u,x,p,f,m,h,v,g,j,w=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=w.length>4&&void 0!==w[4]?w[4]:{},e.prev=1,o=String(Math.floor(1e4*Math.random())),e.next=5,Q([t]);case 5:if(a=e.sent,u=(0,l.Z)(a,1),x=u[0]){e.next=10;break}throw new Error("Failed to craft transaction");case 10:return p=x.txid,f=x.signedTransaction,m=x.blockhash,h=x.lastValidBlockHeight,v=x.context,e.next=13,te(o,f,m,h,v,n,i,s,p,r);case 13:e.next=22;break;case 15:e.prev=15,e.t0=e.catch(1),j=e.t0.message||d.ag._({id:"60cOBW"}),console.error(e.t0),(0,C.Kz)(S.Ll.DECREASE_POSITION_REQUEST_FAILED,U({errorCode:null===e.t0||void 0===e.t0||null===(g=e.t0.error)||void 0===g?void 0:g.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message},r)),s(!0),b({title:"Failed to perform transaction",description:(0,R.jsx)("div",{children:(0,R.jsx)("p",{children:j})}),variant:"ERROR"});case 22:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[Q,te,b]),ie=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.instructions})),e.next=3,Q(n);case 3:if(i=e.sent,t.length===i.length){e.next=6;break}throw new Error("Failed to craft transaction");case 6:return e.next=8,Promise.allSettled(i.map((function(e,n){return new Promise(function(){var i=(0,o.Z)(c().mark((function i(s,r){var l,o,a,d,u,x,p;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return l=String(Math.floor(1e4*Math.random())),o=e.txid,a=e.signedTransaction,d=e.blockhash,u=e.lastValidBlockHeight,x=e.context,p=t[n].positionRequestKey,i.abrupt("return",te(l,a,d,u,x,p,s,r,o));case 4:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())})));case 8:return s=e.sent,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Q,te]),se=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i,s){var o,u,x,p,f,h,v,g,j,w,y,k,O,_,T,M,A=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=A.length>4&&void 0!==A[4]?A[4]:{},F&&I){e.next=3;break}return e.abrupt("return");case 3:return u="",h="request",v=String(Math.floor(1e4*Math.random())),e.prev=6,(0,C.Kz)(S.Ll.DECREASE_POSITION_REQUEST,U({},o)),e.next=10,Q([t]);case 10:return g=e.sent,j=(0,l.Z)(g,1),w=j[0],y=w.signedTransaction,k=w.blockhash,O=w.lastValidBlockHeight,x=Date.now(),r(v,{status:"loading",txid:"",stepText:"Reducing Position"},{customTitle:d.ag._({id:"LlHrXq"})}),b({duration:12e4,id:v,render:function(e){return(0,R.jsx)(N.x,U({customTitle:d.ag._({id:"CGv2Cw"})},e))},draggable:!1,closeOnClick:!1,shouldShowCloseIcon:!1}),e.next=21,(0,m.ie)({signedTransaction:y,blockhash:k,connection:V,lastValidBlockHeight:O,idl:E.x,idlProgramId:Z.KX,skipPreflight:!0});case 21:if(!("error"in(_=e.sent))){e.next=24;break}throw _.error;case 24:return p=Date.now(),f=p-x,(0,C.Kz)(S.Ll.DECREASE_POSITION_REQUEST_SUCCESS,U({txid:u,requestTimeSeconds:f/1e3},o)),a(v,{status:"loading",stepText:d.ag._({id:"/Snnuz"})}),h="pickup",e.next=31,J(v,_.txid,n.toString(),"partial-close",i,(function(){(0,C.Kz)(S.Ll.DECREASE_POSITION_NOT_CONFIRMED,U({txid:u,requestTimeSeconds:f?f/1e3:void 0,pickupTimeSeconds:p?(Date.now()-p)/1e3:void 0},o)),s(!0)}),_.transactionResponse.slot);case 31:(0,C.Kz)(S.Ll.DECREASE_POSITION_SUCCESS,U({requestTimeSeconds:f?f/1e3:void 0,pickupTimeSeconds:(Date.now()-p)/1e3,txid:u},o)),e.next=43;break;case 34:e.prev=34,e.t0=e.catch(6),M=e.t0.message||d.ag._({id:"60cOBW"}),console.error(e.t0),s(!0),b({title:"Failed to perform transaction",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:M}),(0,R.jsx)("div",{children:u?(0,R.jsx)(P.Z,{txid:u}):null})]}),variant:"ERROR"}),D(v),x&&"request"===h&&(p=Date.now(),f=p-x),(0,C.Kz)("request"===h?S.Ll.DECREASE_POSITION_REQUEST_FAILED:S.Ll.DECREASE_POSITION_FAILED,U({requestTimeSeconds:f?f/1e3:void 0,pickupTimeSeconds:"pickup"===h&&p?(Date.now()-p)/1e3:void 0,errorCode:null===e.t0||void 0===e.t0||null===(T=e.t0.error)||void 0===T?void 0:T.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message,txid:u},o));case 43:case"end":return e.stop()}}),e,null,[[6,34]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[F,I,Q,r,b,V,a,J,D]),re=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i,s){var o,a,u,x,p,f,h,v,g,j,w,y,k,O,_,T,M=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=M.length>4&&void 0!==M[4]?M[4]:{},F&&I){e.next=3;break}return e.abrupt("return");case 3:return a="",f="request",h=String(Math.floor(1e4*Math.random())),e.prev=6,(0,C.Kz)(S.Ll.INCREASE_POSITION_REQUEST,U({},o)),e.next=10,Q([t]);case 10:return v=e.sent,g=(0,l.Z)(v,1),j=g[0],w=j.signedTransaction,y=j.blockhash,k=j.lastValidBlockHeight,u=Date.now(),r(h,{status:"loading",txid:"",stepText:"Increasing Collateral"},{customTitle:d.ag._({id:"pKNWL0"})}),b({duration:12e4,id:h,render:function(e){return(0,R.jsx)(N.x,U({customTitle:d.ag._({id:"Dj6s0d"}),className:"w-[95vw] lg:w-[420px]"},e))},draggable:!1,closeOnClick:!1,shouldShowCloseIcon:!1}),e.next=21,(0,m.ie)({signedTransaction:w,blockhash:y,connection:V,lastValidBlockHeight:k,idl:E.x,idlProgramId:Z.KX,skipPreflight:!0});case 21:if(!("error"in(O=e.sent))){e.next=24;break}throw O.error;case 24:return x=Date.now(),p=x-u,(0,C.Kz)(S.Ll.INCREASE_POSITION_REQUEST_SUCCESS,U({txid:a,requestTimeSeconds:p/1e3},o)),f="pickup",e.next=30,J(h,O.txid,n.toString(),"increase-collateral",i,(function(){(0,C.Kz)(S.Ll.INCREASE_POSITION_NOT_CONFIRMED,U({txid:a,requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:x?(Date.now()-x)/1e3:void 0},o)),s(!0)}),O.transactionResponse.slot);case 30:(0,C.Kz)(S.Ll.INCREASE_POSITION_SUCCESS,U({requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:(Date.now()-x)/1e3,txid:a},o)),e.next=41;break;case 33:e.prev=33,e.t0=e.catch(6),T=e.t0.message||d.ag._({id:"c63n65"}),s(!0),b({title:"Failed to perform transaction",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:T}),(0,R.jsx)("div",{children:a?(0,R.jsx)(P.Z,{txid:a}):null})]}),variant:"ERROR"}),D(h),u&&"request"===f&&(x=Date.now(),p=x-u),(0,C.Kz)("request"===f?S.Ll.INCREASE_POSITION_REQUEST_FAILED:S.Ll.INCREASE_POSITION_FAILED,U({requestTimeSeconds:p?p/1e3:void 0,pickupTimeSeconds:"pickup"===f&&x?(Date.now()-x)/1e3:void 0,errorCode:null===e.t0||void 0===e.t0||null===(_=e.t0.error)||void 0===_?void 0:_.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message,txid:a},o));case 41:case"end":return e.stop()}}),e,null,[[6,33]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[F,I,Q,r,b,V,J,D]),le=(0,y.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(n,i,s,o){var u,x,p,f,h,v,g,j,w,y,k,O,_=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=_.length>4&&void 0!==_[4]?_[4]:{},F&&I){e.next=3;break}return e.abrupt("return");case 3:return x="",f=String(Math.floor(1e4*Math.random())),h=[n.doveInstructions].filter((function(e){return e.length>0})),v={duration:12e4,id:f,render:function(e){return(0,R.jsx)(N.x,U({customTitle:d.ag._({id:"pviPWI"})},e))},closeOnClick:!1},e.prev=7,(0,C.Kz)(S.Ll.UPDATE_TPSL_REQUEST,U({},u)),e.next=11,Q(h);case 11:return g=e.sent,j=(0,l.Z)(g,1),w=j[0],p=Date.now(),r(f,{status:"loading",txid:"",stepText:"Adjusting TPSL"},{customTitle:o}),b(U(U({},v),{},{draggable:!1,shouldShowCloseIcon:!1})),e.next=19,(0,m.ie)({signedTransaction:w.signedTransaction,blockhash:w.blockhash,connection:V,lastValidBlockHeight:w.lastValidBlockHeight,idl:E.x,idlProgramId:Z.KX,skipPreflight:!0});case 19:if(!("error"in(y=e.sent))){e.next=22;break}throw y.error;case 22:a(f,{status:"success"}),b(U(U({},v),{},{duration:T.ET,shouldShowCloseIcon:!0})),i(!0),(0,C.Kz)(S.Ll.UPDATE_TPSL_SUCCESS,U({ping:(Date.now()-p)/1e3,txid:x},u)),e.next=37;break;case 28:e.prev=28,e.t0=e.catch(7),O=e.t0.message||d.ag._({id:"FhafBc"}),console.error(e.t0),a(f,{status:"fail"}),b(U(U({},v),{},{duration:T.sS,draggable:!0,shouldShowCloseIcon:!0})),s(!0),b({title:"Failed to perform transaction",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:O}),(0,R.jsx)("div",{children:x?(0,R.jsx)(P.Z,{txid:x}):null})]}),variant:"ERROR"}),(0,C.Kz)(S.Ll.UPDATE_TPSL_FAILED,U({ping:p?(Date.now()-p)/1e3:void 0,errorCode:null===e.t0||void 0===e.t0||null===(k=e.t0.error)||void 0===k?void 0:k.code,errorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message,txid:x},u));case 37:return e.prev=37,t(),B(),e.finish(37);case 41:case"end":return e.stop()}}),e,null,[[7,28,37,41]])})));return function(t,n,i,s){return e.apply(this,arguments)}}(),[r,V,Q,B,t,I,b,a,F]);return{promptKeeperOpenPositionNotification:ee,promptKeeperClosePositionNotification:ne,promptKeeperCloseAllPositionNotification:ie,promptKeeperPartialClosePositionNotification:se,promptKeeperIncreaseCollateralNotification:re,promptKeeperCreateTPSLNotification:le}}},80989:function(e,t,n){"use strict";var i=n(95439),s=n(38272),r=n(93981);t.Z=function(e){var t=e.disabled,n=e.amount,l=e.fromTokenInfo,o=e.toTokenInfo,a=e.slippage,c=(0,r.useMemo)((function(){return Math.ceil(100*Number(a))}),[a]),d=(0,r.useMemo)((function(){return{amount:n,inputMint:t||null===l||void 0===l||!l.address?void 0:new s.PublicKey(l.address),outputMint:t||null===o||void 0===o||!o.address?void 0:new s.PublicKey(o.address),slippageBps:c,maxAccounts:45,disabledProgramIds:["jupoNjAxXgZ4rjzxzPMP4oxduvQsQtZzyknqvzYNrNu"]}}),[n,t,l,o,c]),u=(0,i.OO)(d),x=u.quoteResponseMeta,p=u.loading,f=u.refresh,m=u.error,h=u.lastRefreshTimestamp,v=(0,r.useMemo)((function(){return{outAmount:null===x||void 0===x?void 0:x.quoteResponse.outAmount,otherAmountThreshold:null===x||void 0===x?void 0:x.quoteResponse.otherAmountThreshold,isLoading:!t&&p}}),[t,p,x]),g=v.outAmount,b=v.otherAmountThreshold;return{isLoading:v.isLoading,outAmount:g,otherAmountThreshold:b,quoteResponseMeta:x,useJupError:m,refresh:f,lastRefreshTimestamp:h}}},21039:function(e,t,n){"use strict";n.d(t,{Ne:function(){return d},QY:function(){return c}});var i=n(97620),s=n(70107),r=n(3082),l=n(93981),o=n(72215),a=n(6397),c=function(){var e=(0,o.Bn)().topTokenByVolume;return(0,l.useMemo)((function(){var t=a.fA.map((function(e){return e.address})),n=a.se.map((function(e){return e.address})),i=e.map((function(e){return e.address})).concat([].concat((0,s.Z)(t),(0,s.Z)(n))),r=new Set;return i.forEach((function(e){return r.add(e)})),Array.from(r)}),[e])},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SOL-SOL",t="perps",n=(0,r.useRouter)(),s=n.isReady,a=n.query,c=n.replace,d=(0,o.Bn)(),u=d.getTokenSlug;return l.useCallback((function(n,r,l){if(s)if(n&&r){var o=u(n),d=u(r);if("string"===typeof a.inOut){var x=a.inOut.split("-"),p=(0,i.Z)(x,2),f=p[0],m=p[1],h=a.direction;f===o&&m===d&&h===l||c({pathname:"/".concat(t,"/").concat(l,"/").concat(o,"-").concat(d)},void 0,{scroll:!1,shallow:!0})}}else c({pathname:"/".concat(t,"/").concat(l,"/").concat(e)},void 0,{scroll:!1,shallow:!0})}),[s,u,a.inOut,a.direction,c,e])}},38756:function(e,t,n){"use strict";n.d(t,{w:function(){return g}});var i=n(97620),s=n(63956),r=n(27195),l=n(8857),o=n.n(l),a=n(24309),c=n(32532),d=n(75206),u=n(38272),x=n(13170),p=n(13486),f=n(8770),m=n(795).Buffer;function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",j(v(v({},t),{},{requestType:"market",triggerAboveThreshold:null,triggerPrice:null})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return w.apply(this,arguments)}function w(){return(w=(0,r.Z)(o().mark((function e(t){var n,s,r,l,h,v,g,b,j,w,y,N,P,S,k,O,_,C,T,Z,D,M,F,A;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,s=t.connection,r=t.side,l=t.collateralCustody,h=t.positionCustody,v=t.inputMint,g=t.requestType,b=t.sizeUsdDelta,j=t.collateralTokenDelta,w=t.priceSlippage,y=t.jupiterMinimumOut,N=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return P=(0,f.h)(n,s),e.next=7,(0,c.c1)(v,N,s);case 7:if(S=e.sent,k=(0,i.Z)(S,2),O=k[0],_=k[1],C=u.PublicKey.findProgramAddressSync([m.from("position"),N.toBuffer(),p.FW.toBuffer(),h.publicKey.toBuffer(),l.publicKey.toBuffer(),"long"===r?[1]:[2]],P.programId)[0],T=new a.BN(Math.floor(1e9*Math.random())),Z=u.PublicKey.findProgramAddressSync([m.from("position_request"),C.toBuffer(),T.toArrayLike(m,"le",8),[1]],P.programId)[0],D=u.PublicKey.findProgramAddressSync([Z.toBuffer(),d.H_.toBuffer(),v.toBuffer()],d._u)[0],M=[],F=[],e.prev=17,v.equals(x.W4)&&(_&&M.push(_),M.push(u.SystemProgram.transfer({fromPubkey:N,toPubkey:O,lamports:BigInt(j.toString())})),M.push(d.WU.createSyncNativeInstruction(d.H_,O)),F.push(d.WU.createCloseAccountInstruction(d.H_,O,N,N,[]))),"market"!==g){e.next=27;break}if(w){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,P.methods.createIncreasePositionMarketRequest({sizeUsdDelta:b,collateralTokenDelta:j,side:"long"===r?{long:{}}:{short:{}},priceSlippage:w,jupiterMinimumOut:y,counter:T}).accounts({owner:N,fundingAccount:O,perpetuals:p.TJ,pool:p.FW,position:C,positionRequest:Z,positionRequestAta:D,custody:h.publicKey,collateralCustody:l.publicKey,inputMint:v,referral:null}).instruction();case 24:A=e.sent,e.next=28;break;case 27:throw"Limit Order not supported";case 28:return e.abrupt("return",{instructions:[].concat(M,[A],F),positionRequestKey:Z});case 31:throw e.prev=31,e.t0=e.catch(17),console.log(e.t0),e.t0;case 35:case"end":return e.stop()}}),e,null,[[17,31]])})))).apply(this,arguments)}},8770:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var i=n(24309),s=n(55540),r=n(13486),l=function(e,t){var n=new i.Y7(t,e,{commitment:"processed",skipPreflight:!0});return new i.$r(s.x,r.KX,n)}},51232:function(e,t,n){"use strict";n.d(t,{w_:function(){return l}});var i=n(63956);n(65558),n(13838),n(11421);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e){return Object.keys(e).reduce((function(t,n){var s=e[n];return s?r(r({},t),{},(0,i.Z)({},n,"string"===typeof s?s:"function"===typeof s.toString?s.toString():"")):t}),{})}},99384:function(e,t,n){"use strict";var i=n(29541);t.Z=function(e){var t=e.width,n=void 0===t?12:t,s=e.height,r=void 0===s?12:s;return(0,i.jsxs)("svg",{width:n,height:r,viewBox:"0 0 12 12",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("g",{clipPath:"url(#clip0_841_4053)",children:(0,i.jsx)("path",{d:"M11.6466 4.23513V0.706082L10.4111 1.94156C9.3173 0.741165 7.72912 0 6 0C2.6827 0 0 2.6827 0 6C0 9.3173 2.68203 12 6 12C7.69405 12 9.21142 11.2939 10.3059 10.165L9.31797 9.14128C8.50601 10.0234 7.30561 10.5879 6 10.5879C3.45892 10.5879 1.41216 8.5411 1.41216 6.00002C1.41216 3.45894 3.45892 1.41218 6 1.41218C7.34135 1.41218 8.57615 2.01238 9.42317 2.92954L8.11757 4.23515L11.6466 4.23513Z",fill:"inherit"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_841_4053",children:(0,i.jsx)("rect",{width:"12",height:"12",fill:"white"})})})]})}},94223:function(e,t,n){"use strict";n(93981);var i=n(29541);t.Z=function(e){var t=e.width,n=void 0===t?32:t,s=e.height,r=void 0===s?32:s;return(0,i.jsx)("svg",{width:n,height:r,viewBox:"0 0 32 32",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.1425 8.45597H5.22047L5.22025 8.45592C4.66944 8.40838 4.15821 8.1496 3.79392 7.73368C3.52351 7.52371 3.34106 7.22064 3.28188 6.88329C3.24718 5.65089 4.6625 4.79883 5.9425 4.79883H22.3996C23.1264 4.80107 23.8229 5.09067 24.3368 5.60455C24.8507 6.11843 25.1403 6.81496 25.1425 7.54168V8.45597ZM26.0564 10.2846H5.02779C4.54289 10.2846 4.07777 10.092 3.73473 9.74912C3.39187 9.40605 3.19922 8.94094 3.19922 8.45605V25.8275C3.19922 26.555 3.4882 27.2526 4.00248 27.7671C4.51698 28.2814 5.21451 28.5703 5.94208 28.5703H26.0564C26.7839 28.5703 27.4814 28.2814 27.996 27.7671C28.5102 27.2526 28.7992 26.555 28.7992 25.8275V23.0846H24.2278C22.9213 23.0846 21.7139 22.3875 21.0607 21.2561C20.4074 20.1246 20.4074 18.7303 21.0607 17.5989C21.7139 16.4675 22.9213 15.7703 24.2278 15.7703H28.7992V13.0275C28.7992 12.2999 28.5102 11.6024 27.996 11.0879C27.4815 10.5736 26.7839 10.2846 26.0564 10.2846ZM22.4014 19.4277C22.4014 19.9126 22.594 20.3777 22.9369 20.7208C23.2799 21.0636 23.7451 21.2563 24.2299 21.2563H28.8014V17.5991H24.2299C23.745 17.5991 23.2799 17.7918 22.9369 18.1346C22.594 18.4777 22.4014 18.9428 22.4014 19.4277Z",fill:"currentColor"})})}},340:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return _n},default:function(){return Cn}});var i=n(93981),s=n(19424),r=n(97620),l=n(27195),o=n(8857),a=n.n(o),c=n(4707),d=n(35682),u=n(72215),x=n(27177),p=n(25224),f=n(45009),m=n(13838),h=n(3011),v=n(68586),g=n(39268),b=n.n(g),j=n(72997),w=n(56100),y=n(24201),N=n(25546),P=n(11352),S=n(29541),k=function(e){var t=e.price,n=e.precision,s=e.children,r=(0,i.useState)(""),l=r[0],o=r[1],a=(0,N.D9)(null===t||void 0===t?void 0:t.toDP(n)),c=(0,i.useRef)(Date.now());return(0,i.useEffect)((function(){var e=null===t||void 0===t?void 0:t.toDP(n);if(a)return null!==e&&void 0!==e&&e.gt(a)?(o("text-perps-green"),void(c.current=Date.now())):null!==e&&void 0!==e&&e.lt(a)?(o("text-red-500"),void(c.current=Date.now())):void(null!==e&&void 0!==e&&e.eq(a)&&Date.now()-c.current>1e3&&o(""));Date.now()-c.current>1e3&&o("")}),[t]),(0,S.jsx)("span",{className:(0,y.cn)("text-white transition-all duration-100",l),children:s})},O=n(6397),_=n(13486),C=n(31900),T=n(63956),Z=n(7763),D=n(53024),M=n(79989),F=n(44495);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){var t=e.enabled,n=(0,M.Z)(),s=(0,i.useState)(!1),r=s[0],o=s[1],c=(0,i.useState)(0),d=c[0],u=c[1],x=(0,i.useRef)(!1),p=(0,i.useRef)(!1),f=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.online||!t||x.current){e.next=18;break}return p.current&&(u((function(e){return e+1})),x.current=!0),e.prev=2,e.next=5,Z.chaosWebsocket.createSocket();case 5:i=e.sent,o(!1),x.current=!1,null===i||void 0===i||i.send(JSON.stringify(Z.CHAOS_SUBSCRIPTION_MESSAGE)),null===i||void 0===i||i.addEventListener("message",(function(e){var t=JSON.parse(e.data),n=t.p,i=t.e,s=parseFloat(n)*Math.pow(10,i);D.e_.set(D.iw,E(E({},t),{},{p:s.toString()}))})),null===i||void 0===i||i.addEventListener("error",(function(){Z.chaosWebsocket.closeSocket(),f()})),null===i||void 0===i||i.addEventListener("close",(function(){Z.chaosWebsocket.closeSocket(),o(!0)})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),Z.chaosWebsocket.closeSocket(),f();case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),[n.online,t,u]);return(0,i.useEffect)((function(){!x.current&&r&&f()}),[f,r]),(0,F.Z)((function(){return f(),p.current=!0,function(){Z.chaosWebsocket.closeSocket()}}),[n.online,t]),{socketRestartCount:d}},R=n(21039);var q=n(8473),L=n(33118),U=n(99384),K=function(e){var t=e.loading,n=e.emptyText,i=e.className,s=(0,u.Os)().wallet;return(0,S.jsx)("div",{className:(0,y.cn)("bg-white-5 mx-5 mt-4 flex flex-col items-center justify-start space-y-2 rounded-lg border-white-10 py-[60px] lg:mx-0",i),children:null!==s&&void 0!==s&&s.adapter.publicKey?(0,S.jsx)(S.Fragment,{children:t?(0,S.jsxs)("div",{className:"flex items-center",children:[(0,S.jsx)("div",{className:"mr-2 animate-spin fill-current",children:(0,S.jsx)(U.Z,{width:8,height:8})}),(0,S.jsx)("div",{className:"text-sm text-white/50",children:(0,S.jsx)(q.cC,{id:"gawJ06"})})]}):(0,S.jsx)("div",{className:"text-sm text-white/50",children:n})}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"text-sm text-white/50",children:(0,S.jsx)(q.cC,{id:"Y/eik8"})}),(0,S.jsx)("div",{className:"h-10 w-40",children:(0,S.jsx)(L.Z,{size:"sm"})})]})})},V=n(12627),B=n(40558),z=n(67768),H=n(88381),W=n(36872),$=n(44710),G=n(59978),Y=function(e){var t=e.width,n=void 0===t?15:t,i=e.height,s=void 0===i?15:i;return(0,S.jsx)("svg",{width:n,height:s,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{id:"Icon",d:"M11.9999 6.66665L9.33319 3.99998M1.6665 14.3333L3.92275 14.0826C4.19841 14.052 4.33624 14.0367 4.46507 13.995C4.57936 13.958 4.68814 13.9057 4.78843 13.8396C4.90147 13.765 4.99953 13.6669 5.19565 13.4708L13.9999 4.66665C14.7362 3.93027 14.7362 2.73636 13.9999 1.99998C13.2635 1.2636 12.0696 1.2636 11.3332 1.99998L2.52899 10.8042C2.33287 11.0003 2.23481 11.0983 2.16026 11.2114C2.09413 11.3117 2.04185 11.4205 2.00485 11.5347C1.96314 11.6636 1.94783 11.8014 1.9172 12.0771L1.6665 14.3333Z",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},X=n(86150),J=function(e){var t=e.width,n=void 0===t?12:t,i=e.height,s=void 0===i?12:i;return(0,S.jsx)("svg",{width:n,height:s,viewBox:"0 0 12 12",fill:"inherit",fillOpacity:0,xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M5 1.5H8M2 3H11M10 3L9.64936 8.25964C9.59675 9.04877 9.57044 9.44333 9.40001 9.7425C9.24996 10.0059 9.02362 10.2176 8.75083 10.3498C8.44098 10.5 8.04555 10.5 7.25467 10.5H5.74533C4.95445 10.5 4.55902 10.5 4.24917 10.3498C3.97638 10.2176 3.75004 10.0059 3.59999 9.7425C3.42956 9.44333 3.40325 9.04877 3.35064 8.25965L3 3M5.5 5.25V7.75M7.5 5.25V7.75",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},Q={isClosingAllPositions:(0,n(9364).cn)(!1)},ee=n(54423),te=n(13215),ne=n(85394),ie=n(69825),se=n(24802),re=n(38272),le=n(80751),oe=n(12866),ae=n(70107),ce=n(24309),de=n(8770),ue=n(75206),xe=n(32532);function pe(e){return fe.apply(this,arguments)}function fe(){return(fe=(0,l.Z)(a().mark((function e(t){var n,i,s,l,o,c,d,u,x,p,f,m,h,v,g,b,j,w,y,N;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.cancelTP,l=t.cancelSL,e.prev=1,o=n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(c=(0,de.h)(n,i),d=[],u=[],!s){e.next=21;break}return e.next=11,(0,xe.c1)(s.positionRequestMint,o,i);case 11:return x=e.sent,p=(0,r.Z)(x,2),f=p[0],m=p[1],h=re.PublicKey.findProgramAddressSync([s.positionRequestPubkey.toBuffer(),ue.H_.toBuffer(),s.positionRequestMint.toBuffer()],ue._u)[0],m&&d.push(m),e.next=19,c.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:f,pool:_.FW,positionRequest:s.positionRequestPubkey,positionRequestAta:h,position:s.positionPubkey}).instruction();case 19:v=e.sent,u.push(v);case 21:if(!l){e.next=34;break}return e.next=24,(0,xe.c1)(l.positionRequestMint,o,i);case 24:return g=e.sent,b=(0,r.Z)(g,2),j=b[0],w=b[1],y=re.PublicKey.findProgramAddressSync([l.positionRequestPubkey.toBuffer(),ue.H_.toBuffer(),l.positionRequestMint.toBuffer()],ue._u)[0],w&&d.push(w),e.next=32,c.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:j,pool:_.FW,positionRequest:l.positionRequestPubkey,positionRequestAta:y,position:l.positionPubkey}).instruction();case 32:N=e.sent,u.push(N);case 34:return e.abrupt("return",{preInstructions:d,instructions:u});case 37:throw e.prev=37,e.t0=e.catch(1),console.log(e.t0),e.t0;case 41:case"end":return e.stop()}}),e,null,[[1,37]])})))).apply(this,arguments)}var me=n(13170),he=n(8862),ve=n(795).Buffer;function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function je(e){return we.apply(this,arguments)}function we(){return we=(0,l.Z)(a().mark((function e(t){var n,i,s,o,c,d,u,x,p,f,m,h,v,g,b,j,w,y,N,P;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,o=t.desiredMint,c=t.tpPrice,d=t.tpCounter,u=t.slPrice,x=t.slCounter,p=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return f=[],m=[],h=(0,de.h)(n,i),e.next=9,(0,xe.c1)(o,p,i);case 9:return v=e.sent,g=(0,r.Z)(v,2),b=g[0],(j=g[1])&&f.push(j),e.next=16,Promise.all([{price:c,counter:d},{price:u,counter:x}].map(function(){var e=(0,l.Z)(a().mark((function e(t){var n,i,r,l,d,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.price,i=t.counter,n){e.next=3;break}return e.abrupt("return",null);case 3:return r=re.PublicKey.findProgramAddressSync([ve.from("position_request"),s.publicKey.toBuffer(),i.toArrayLike(ve,"le",8),[2]],h.programId)[0],l=re.PublicKey.findProgramAddressSync([r.toBuffer(),ue.H_.toBuffer(),o.toBuffer()],ue._u)[0],d=he.zC[s.custody.publicKey.toString()],e.next=8,h.methods.createDecreasePositionRequest2({entirePosition:!0,triggerPrice:n,counter:i,sizeUsdDelta:new ce.BN(0),collateralUsdDelta:new ce.BN(0),requestType:{trigger:{}},triggerAboveThreshold:"long"===s.side?n===c:n!==c,priceSlippage:null,jupiterMinimumOut:null}).accounts({owner:p,receivingAccount:b,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:r,positionRequestAta:l,custody:s.custody.publicKey,custodyDovesPriceAccount:d.dovesOracle,custodyPythnetPriceAccount:d.pythnetOracle,collateralCustody:s.collateralCustody.publicKey,desiredMint:o,tokenProgram:ue.H_,associatedTokenProgram:ue._u,systemProgram:re.SystemProgram.programId,referral:null}).instruction();case 8:return u=e.sent,e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:return w=e.sent,y=(0,r.Z)(w,2),N=y[0],P=y[1],N&&m.push(N),P&&m.push(P),e.abrupt("return",{preInstructions:f,instructions:m});case 23:case"end":return e.stop()}}),e)}))),we.apply(this,arguments)}function ye(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,l.Z)(a().mark((function e(t,n,i){var s,r,l,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return s="long"===i.side?new ce.BN(0):new ce.BN("18446744073709551615"),e.prev=3,e.next=6,Pe({wallet:t,connection:n,position:i,priceSlippage:s,collateralUsdDelta:new ce.BN(0),sizeUsdDelta:new ce.BN(i.sizeUsd.toFixed(0)),desiredMint:i.collateralCustody.account.mint,jupiterMinimumOut:null});case 6:return r=e.sent,l=r.instructions,o=r.positionRequestKey,e.abrupt("return",{instructions:l,positionRequestKey:o});case 12:return e.prev=12,e.t0=e.catch(3),console.log("Failed to close position!",e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[3,12]])})))).apply(this,arguments)}function Pe(e){return Se.apply(this,arguments)}function Se(){return(Se=(0,l.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(be(be({},t),{},{requestType:"market",triggerPrice:null,entirePosition:null,triggerAboveThreshold:null}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,l.Z)(a().mark((function e(t){var n,i,s,l,o,c,d,u,x,p,f,m,h,v,g,b,j,w,y,N,P,S;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.position,l=t.collateralUsdDelta,o=t.sizeUsdDelta,c=t.desiredMint,d=t.requestType,u=t.priceSlippage,x=t.jupiterMinimumOut,p=t.entirePosition,f=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return m=(0,de.h)(n,i),e.next=7,(0,xe.c1)(c,f,i);case 7:if(h=e.sent,v=(0,r.Z)(h,2),g=v[0],b=v[1],j=new ce.BN(Math.floor(1e9*Math.random())),w=re.PublicKey.findProgramAddressSync([ve.from("position_request"),s.publicKey.toBuffer(),j.toArrayLike(ve,"le",8),[2]],m.programId)[0],y=re.PublicKey.findProgramAddressSync([w.toBuffer(),ue.H_.toBuffer(),c.toBuffer()],ue._u)[0],N=[],b&&N.push(b),P=[],c.equals(me.W4)&&P.push(ue.WU.createCloseAccountInstruction(ue.H_,g,f,f,[])),e.prev=18,"market"!==d){e.next=27;break}if(u){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,m.methods.createDecreasePositionMarketRequest({collateralUsdDelta:l,sizeUsdDelta:o,priceSlippage:u,jupiterMinimumOut:x,counter:j,entirePosition:p}).accounts({owner:f,receivingAccount:g,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:w,positionRequestAta:y,custody:s.custody.publicKey,collateralCustody:s.collateralCustody.publicKey,desiredMint:c,tokenProgram:ue.H_,associatedTokenProgram:ue._u,systemProgram:re.SystemProgram.programId,referral:null}).instruction();case 24:S=e.sent,e.next=28;break;case 27:throw"Wrong Ix";case 28:return e.abrupt("return",{instructions:[].concat(N,[S],P),positionRequestKey:w});case 31:throw e.prev=31,e.t0=e.catch(18),console.log(e.t0),e.t0;case 35:case"end":return e.stop()}}),e,null,[[18,31]])})))).apply(this,arguments)}function _e(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,l.Z)(a().mark((function e(t){var n,i,s,r,l,o,c,d,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,r=t.positionRequestAccount,l=t.sizeUsdDelta,o=t.triggerPrice,c=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return d=(0,de.h)(n,i),u=he.zC[s.custody.publicKey.toString()],e.prev=6,e.next=9,d.methods.updateDecreasePositionRequest2({sizeUsdDelta:l,triggerPrice:o}).accounts({owner:c,perpetuals:_.TJ,pool:_.FW,position:s.publicKey,positionRequest:r,custody:s.custody.publicKey,custodyDovesPriceAccount:u.dovesOracle,custodyPythnetPriceAccount:u.pythnetOracle}).instruction();case 9:return e.abrupt("return",e.sent);case 12:throw e.prev=12,e.t0=e.catch(6),console.log(e.t0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}function Te(e){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,l.Z)(a().mark((function e(t){var n,i,s,r,l,o,c,d,u,x,p,f,m,h,v,g,b,j,w,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,r=t.desiredMint,l=t.tpPrice,o=t.slPrice,c=t.updateTPPrice,d=t.updateSLPrice,u=t.cancelTP,x=t.cancelSL,e.prev=1,n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(!([l,o,c,d,u,x].filter(Boolean).length>2)){e.next=7;break}throw new Error("Only two actions can be performed at a time");case 7:if(p=[],f=[],!l&&!o){e.next=17;break}return e.next=12,je({wallet:n,connection:i,positionAccount:s,desiredMint:r,tpPrice:l,tpCounter:new ce.BN(Math.floor(1e9*Math.random())),slPrice:o,slCounter:new ce.BN(Math.floor(1e9*Math.random()))});case 12:m=e.sent,h=m.preInstructions,v=m.instructions,h&&p.push.apply(p,(0,ae.Z)(h)),v&&f.push.apply(f,(0,ae.Z)(v));case 17:if(!c){e.next=22;break}return e.next=20,_e({wallet:n,connection:i,positionAccount:s,positionRequestAccount:c.positionRequestAccount,sizeUsdDelta:new ce.BN(0),triggerPrice:c.triggerPrice});case 20:g=e.sent,f.push(g);case 22:if(!d){e.next=27;break}return e.next=25,_e({wallet:n,connection:i,positionAccount:s,positionRequestAccount:d.positionRequestAccount,sizeUsdDelta:new ce.BN(0),triggerPrice:d.triggerPrice});case 25:b=e.sent,f.push(b);case 27:if(!u&&!x){e.next=35;break}return e.next=30,pe({wallet:n,connection:i,cancelTP:u,cancelSL:x});case 30:j=e.sent,w=j.preInstructions,y=j.instructions,w&&p.push.apply(p,(0,ae.Z)(w)),y&&f.push.apply(f,(0,ae.Z)(y));case 35:return e.abrupt("return",[].concat(p,f));case 38:throw e.prev=38,e.t0=e.catch(1),console.log(e.t0),e.t0;case 42:case"end":return e.stop()}}),e,null,[[1,38]])})))).apply(this,arguments)}var De=n(51232),Me=function(e){var t=e.changePct,n=e.pnl;if(!t||!n)return(0,S.jsx)(w.O,{className:"!h-4 !w-12"});var i=n.abs().div(1e6).toFixed(2),s=t.toDP(2).abs().toFixed(2);return(0,S.jsx)("p",{className:(0,y.cn)("text-xs",n.gt(0)?"text-perps-green":"text-perps-red"),children:n.gt(0)?"+$".concat(i," (+").concat(s,"%)"):"-$".concat(i," (-").concat(s,"%)")})},Fe=n(39694),Ae=n.n(Fe)()((function(e){var t,n,i,s;return{hasTp:null!==(t=e.takeProfitPositionRequest)&&void 0!==t&&t.account.triggerPrice?new m.Z(null===(n=e.takeProfitPositionRequest)||void 0===n?void 0:n.account.triggerPrice.toString()).div(1e6):null,hasSl:null!==(i=e.stopLossPositionRequest)&&void 0!==i&&i.account.triggerPrice?new m.Z(null===(s=e.stopLossPositionRequest)||void 0===s?void 0:s.account.triggerPrice.toString()).div(1e6):null}})),Ee=function(e){var t,n,s=e.positionAccount,r=e.tpPrice,l=e.slPrice,o=(0,_.tc)().oraclePrices,a=(0,i.useMemo)((function(){return"long"===s.side}),[s.side]),c=(0,i.useMemo)((function(){var e=s.custody.account.mint.toString();return o&&o[e]}),[s.custody.account.mint,o]),d=(0,i.useMemo)((function(){return c?c.toNearest(.01,m.Z.ROUND_DOWN):null}),[c]),u=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?new m.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)):c).toNearest(.01,m.Z.ROUND_DOWN):null}),[c,null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice,a]),x=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?c:new m.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2))).toNearest(.01,m.Z.ROUND_DOWN):null}),[c,null===(n=s.accounting)||void 0===n?void 0:n.liquidationPrice,a]),p=(0,i.useMemo)((function(){return!(!r.floatValue||!d)&&(a?new m.Z(r.floatValue).gte(d):new m.Z(r.floatValue).lte(d))}),[d,a,r.floatValue]),f=(0,i.useMemo)((function(){return!!(l.floatValue&&u&&x)&&(a?new m.Z(l.floatValue).gte(u)&&new m.Z(l.floatValue).lte(x):new m.Z(l.floatValue).lte(x)&&new m.Z(l.floatValue).gte(u))}),[x,u,a,l]),h=(0,i.useCallback)((function(e){if(!s.accounting)return null;var t=e.sub(s.price).mul(a?1:-1),n=new m.Z(s.sizeUsd.toString()).div(new m.Z(s.price.toString())).mul(t),i=new m.Z(n).minus(s.accounting.totalFeeUsd);return{positionValue:new m.Z(s.sizeUsd.toString()).add(i),pnlRate:i.div(new m.Z(s.accounting.initialCollateral.toString())).mul(100),pnl:i}}),[a,s.accounting,s.price,s.sizeUsd]),v=(0,i.useMemo)((function(){return r.floatValue&&p?h(new m.Z(r.floatValue).mul(1e6)):null}),[r.floatValue,p,h]),g=(0,i.useMemo)((function(){return l.floatValue&&f?h(new m.Z(l.floatValue).mul(1e6)):null}),[l.floatValue,f,h]),b=Ae(s),j=b.hasTp,w=b.hasSl;return{showTPChanged:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||!r.floatValue||new m.Z(r.floatValue).eq(j)||!p)}),[j,p,r.floatValue]),showTPRemoved:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||r.floatValue)}),[j,r.floatValue]),showSLChanged:(0,i.useMemo)((function(){return!(null===w||void 0===w||!w.gt(0)||!l.floatValue||new m.Z(l.floatValue).eq(w)||!f)}),[w,f,l.floatValue]),showSLRemoved:(0,i.useMemo)((function(){return!(null===w||void 0===w||!w.gt(0)||l.floatValue)}),[w,l.floatValue]),minimumTPPrice:d,minimumSLPrice:u,maximumSLPrice:x,isWithinTPRange:p,isWithinSLRange:f,expectedPositionValueAtSL:g,expectedPositionValueAtTP:v}},Ie=["positionAccount","custody"];function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Le(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var Ue=function(e){var t=e.open,n=e.onClose,s=e.positionAccount,r=e.type,o=(0,_.tc)(),d=o.viewClient,x=o.oraclePrices,f=o.isAnyFormSubmitting,m=(0,u.Bn)(),h=m.connection,v=m.getTokenInfo,g=m.tokenMap,b=(0,u.Os)().wallet,j=(0,se.Z)().promptKeeperCreateTPSLNotification,w=(0,i.useMemo)((function(){return v(s.custody.account.mint.toString())}),[v,s.custody.account.mint]),N=i.useRef(null);(0,p.O3)(N,(function(){var e;return null===(e=N.current)||void 0===e?void 0:e.close()}));var P=(0,i.useCallback)((function(){var e;null===(e=N.current)||void 0===e||e.close(),n()}),[n,N]);(0,i.useEffect)((function(){if(N.current&&(t?N.current.open||N.current.show():N.current.close()),t){var e=N.current;return null===e||void 0===e||e.addEventListener("close",P),function(){null===e||void 0===e||e.removeEventListener("close",P)}}}),[P,t]);var k=(0,i.useMemo)((function(){return v(s.collateralCustody.account.mint.toString())}),[v,s.collateralCustody.account.mint]),O=Ae(s),C=O.hasTp,T=O.hasSl,Z=(0,te.cI)({defaultValues:{tpPrice:Le(C),slPrice:Le(T)}}),D=Z.control,M=Z.handleSubmit,F=Z.watch,A=Z.formState,E=F("tpPrice"),I=F("slPrice"),R=Ee({positionAccount:s,tpPrice:E,slPrice:I}),L=R.expectedPositionValueAtSL,U=R.expectedPositionValueAtTP,K=(0,i.useState)(null),V=K[0],B=K[1],z=(0,i.useMemo)((function(){var e=s.takeProfitPositionRequest||s.stopLossPositionRequest;if(e)return e}),[s.stopLossPositionRequest,s.takeProfitPositionRequest]);(0,i.useEffect)((function(){z&&B(g.get(z.account.mint.toString())||null),!V&&k&&B(k)}),[k,z,V,g]);var H=(0,i.useMemo)((function(){var e=s.custody.account.mint.toString();return x&&x[e]?x[e]:null}),[x,s.custody.account.mint]),W=(0,i.useMemo)((function(){return A.isSubmitting}),[A.isSubmitting]),$=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var t,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&b.adapter.publicKey&&w&&d&&H&&V){e.next=2;break}return e.abrupt("return");case 2:if(t={positionAccount:s,custody:s.custody.account,desiredMint:new re.PublicKey(V.address),tpPrice:null,slPrice:null,updateTPPrice:null,updateSLPrice:null},e.prev=3,n="tp"===r&&s.takeProfitPositionRequest?{cancelTP:{positionPubkey:s.publicKey,positionRequestPubkey:s.takeProfitPositionRequest.publicKey,positionRequestMint:s.takeProfitPositionRequest.account.mint},cancelSL:null}:"sl"===r&&s.stopLossPositionRequest?{cancelTP:null,cancelSL:{positionPubkey:s.publicKey,positionRequestPubkey:s.stopLossPositionRequest.publicKey,positionRequestMint:s.stopLossPositionRequest.account.mint}}:void 0){e.next=7;break}throw new Error("No cancel action found!");case 7:return e.next=9,Te(qe(qe({wallet:b,connection:h},t),n));case 9:return i=e.sent,e.next=12,new Promise(function(){var e=(0,l.Z)(a().mark((function e(n,l){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({doveInstructions:i},(function(e){P(),n(e)}),(function(e){l(e)}),"tp"===r?c.ag._({id:"DQ06Jg"}):c.ag._({id:"yUfC/9"}),function(){t.positionAccount,t.custody;var e=(0,ee.Z)(t,Ie);return qe({wallet:b.adapter.name,positionAccount:s.publicKey.toString()},(0,De.w_)(e))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t0=e.catch(3),console.log("Failed to submit position request!",e.t0);case 18:case"end":return e.stop()}}),e,null,[[3,15]])}))),[b,w,d,H,V,h,s,r,j,P]);return(0,S.jsx)(le.Z,{open:t,onClose:n,children:(0,S.jsxs)("form",{className:"relative w-full rounded-lg bg-v2-perps-modal lg:max-w-[400px]",children:[(0,S.jsx)("div",{className:"p-6 text-lg font-semibold text-v2-lily",children:"tp"===r?c.ag._({id:"55D3eF"}):c.ag._({id:"h5XX4T"})}),(0,S.jsx)("button",{type:"button",disabled:f,className:"absolute right-8 top-5 z-10 flex cursor-pointer fill-current text-v2-lily/[.25] disabled:cursor-not-allowed disabled:opacity-50 lg:top-8",onClick:P,children:(0,S.jsx)(oe.Z,{width:12,height:12})}),(0,S.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,S.jsxs)("div",{className:"px-6",children:[(0,S.jsx)("div",{className:"flex flex-wrap whitespace-nowrap text-sm text-v2-lily/50",children:(0,S.jsx)(q.cC,{id:"SJ3GYL",values:{0:c.ag._({id:"linxAm"}),1:"tp"===r?c.ag._({id:"qKmy6E"}):c.ag._({id:"+xx9+E"})},components:{0:(0,S.jsx)("p",{}),1:(0,S.jsx)("p",{className:"mx-1"})}})}),"tp"===r?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"x4Tc7V"})}),U?(0,S.jsx)("div",{className:"text-xs text-v2-lily/[.25] hover:text-v2-lily",children:(0,S.jsx)(Me,{changePct:U.pnlRate,pnl:U.pnl})}):null]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"tpPrice",control:D,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsx)(ie.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"w-full !text-right !text-sm !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00",suffix:" USD"})}})}),(0,S.jsx)("div",{className:"mt-1 space-y-1",children:U?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"2Ycl/Z",values:{0:U.positionValue.div(1e6).toFixed(2)}})}):null})]}):null,"sl"===r?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"qTADju"})}),L?(0,S.jsx)("div",{className:"text-xs text-v2-lily/[.25] hover:text-v2-lily",children:(0,S.jsx)(Me,{changePct:L.pnlRate,pnl:L.pnl})}):null]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"slPrice",control:D,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsx)(ie.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"w-full !text-right !text-sm !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00",suffix:" USD"})}})}),(0,S.jsx)("div",{className:"mt-1 space-y-1",children:L?(0,S.jsx)("span",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"2Ycl/Z",values:{0:L.positionValue.div(1e6).toFixed(2)}})}):null})]}):null]}),(0,S.jsxs)("div",{className:"flex w-full space-x-3 p-6 text-xs",children:[A.isSubmitting?null:(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-v2-lily/10 bg-v2-lily/5 px-6 py-2.5 text-sm font-semibold text-v2-lily hover:bg-v2-lily/10 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":A.isSubmitting}),disabled:A.isSubmitting,onClick:P,children:(0,S.jsx)("span",{children:c.ag._({id:"dEgA5A"})})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-labs/20 px-6 py-2.5 text-sm font-semibold text-labs hover:bg-labs/5 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":A.isSubmitting||W}),disabled:W,onClick:M($),children:A.isSubmitting?(0,S.jsxs)("span",{className:"flex items-center justify-center",children:[(0,S.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,S.jsx)("div",{className:"mr-2"}),"tp"===r?c.ag._({id:"aPtqFX"}):c.ag._({id:"JoxDrC"})]}):(0,S.jsx)("span",{className:"text-center",children:c.ag._({id:"7VpPHA"})})})]})]})]})})},Ke=function(e,t){var n=N.uf.format(e.abs().div(1e6),t);return e.gt(0)?"+$".concat(n):"-$".concat(n)},Ve=function(e){var t=e.positionAccount,n=(0,_.tc)().showPnlWithFees;if(!t.accounting)return(0,S.jsx)(w.O,{className:"!h-9 !w-24"});var i=t.accounting,s=i.unrealizedPNL,r=i.unrealizedPNLPct,l=i.positionValue,o=i.initialCollateral,a=i.fundingFeeUsd,d=i.baseFeeUsd,u=i.pnlAfterFeesUsd,x=i.pnlAfterFeesPct,p=(0,z.y_)(l);return(0,S.jsxs)("div",{className:(0,y.cn)("text-sm text-v2-lily"),children:[(0,S.jsx)("div",{className:"flex",children:(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsxs)("div",{className:"flex cursor-help flex-col text-white",children:[(0,S.jsx)("p",{children:c.ag._({id:"aZaNcp"})}),(0,S.jsx)("p",{className:"mb-4",children:c.ag._({id:"FUvlhO"})}),(0,S.jsxs)("div",{className:"mb-1 flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"5AGxHJ"})}),(0,S.jsxs)("span",{children:["$",o.add(d).div(1e6).toFixed(p)]})]}),(0,S.jsxs)("div",{className:"mb-1 flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"dmiqeU"})}),(0,S.jsx)("span",{children:Ke(s,p)})]}),(0,S.jsxs)("div",{className:"mb-1 flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"tHI4kn"})}),(0,S.jsxs)("span",{children:["-$",a.div(1e6).toFixed(p)]})]}),(0,S.jsxs)("div",{className:"mb-1 flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"0YCxnV",values:{0:new m.Z(t.custody.account.increasePositionBps.toString()).div(100).toDP(2).toString()}})}),(0,S.jsxs)("span",{children:["-$",d.div(1e6).toFixed(p)]})]}),(0,S.jsxs)("div",{className:"mb-1 flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"PRFlOG",values:{0:new m.Z(t.custody.account.decreasePositionBps.toString()).div(100).toDP(2).toString()}})}),(0,S.jsxs)("span",{children:["-$",d.div(1e6).toFixed(p)]})]}),(0,S.jsxs)("div",{className:"flex justify-between",children:[(0,S.jsx)("span",{className:"text-white/50",children:c.ag._({id:"+L6YwU"})}),(0,S.jsx)("span",{children:Ke(u,p)})]}),(0,S.jsx)("p",{className:"mt-2 !w-[180px] text-white/50",children:c.ag._({id:"RBqbHR"})})]}),children:(0,S.jsxs)("span",{className:"cursor-help underline decoration-white/50 decoration-dashed decoration-1 underline-offset-[3px]",children:["$",N.uf.format(l.div(1e6),p)]})})}),(0,S.jsx)(Me,{changePct:n?x:r,pnl:n?u:s})]})},Be=function(e){var t,n,s,l,o,a,d,x,p,f,v,g,b,j,P,k,O,T,Z,D=e.positionAccount,M=e.onSelectMarket,F=(0,_.tc)(),A=F.oraclePrices,E=F.userPositionsLoading,I=F.isAnyFormSubmitting,R=F.showPnlWithFees,L=F.setShowPnlWithFees,U=(0,C.y)(),K=U.showEditCollateralDialog,ee=U.showEditTPSLDialog,te=U.showClosePositionDialog,ne=U.showSharePositionDialog,ie=(0,u.Bn)().getTokenInfo,se=(0,i.useMemo)((function(){return ie(D.custody.account.mint.toString())}),[ie,D.custody.account.mint]),re=(0,h.KO)(Q.isClosingAllPositions),le=(0,r.Z)(re,1)[0],oe=(0,i.useCallback)((function(){D&&!le&&te({positionAccountPubkey:D.publicKey})}),[le,D,te]),ae=null!==(t=D.accounting)&&void 0!==t&&t.unrealizedPNL.abs().gt(100)?2:4,ce=(0,i.useState)(!1),de=ce[0],ue=ce[1],xe=(0,i.useMemo)((function(){return A&&A[D.custody.account.mint.toString()]}),[A,D.custody.account.mint]),pe=(0,z.y_)(xe),fe=(0,i.useCallback)((function(){se&&xe&&D.accounting&&ne({symbol:null===se||void 0===se?void 0:se.symbol,leverage:D.leverage.toFixed(2),side:D.side,entryPrice:N.uf.format(D.price.div(1e6),pe),markPrice:N.uf.format(xe,pe),openedDate:(0,V.Z)(new Date(1e3*D.position.openTime.toNumber()),"MMM dd, kk:mm O"),pnlPercentage:D.accounting.unrealizedPNL.gt(0)?D.accounting.unrealizedPNLPct.toDP(2):D.accounting.unrealizedPNLPct.toDP(2).mul(-1)})}),[xe,D.accounting,D.leverage,D.position.openTime,D.price,D.side,pe,ne,se]),me=(0,i.useMemo)((function(){return D?D.sizeUsd.div(D.price):null}),[D]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:(0,y.cn)("hidden 2xl:flex","h-[72px] min-w-[1092px] items-center justify-between overflow-hidden rounded-lg border-b border-b-v2-lily/[0.02]"),children:[(0,S.jsxs)("div",{onClick:function(){return M(D)},className:"flex w-[130px] cursor-pointer items-center py-3 pl-2 text-xs text-white/[.75]",children:[(0,S.jsx)(G.Z,{info:se}),(0,S.jsxs)("div",{className:"ml-2",children:[(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsxs)("div",{className:"space-y-2 leading-none",children:[(0,S.jsx)("p",{className:"text-xs",children:(0,S.jsx)(q.cC,{id:"JIQw2n"})}),(0,S.jsx)("p",{className:"text-xs",children:(0,S.jsx)(q.cC,{id:"C/Tfq6"})})]}),children:(0,S.jsx)("p",{className:"text-sm font-semibold text-v2-lily underline decoration-white/50 decoration-dashed decoration-1 underline-offset-[3px]",children:null===se||void 0===se?void 0:se.symbol})}),(0,S.jsxs)("p",{className:"text-xs text-white/75",children:[D.leverage.toFixed(2),"x ",D.side]})]})]}),(0,S.jsx)("div",{className:"flex w-[172px] items-center py-3 pl-2 text-xs text-white/[.75]",children:(0,S.jsx)(Ve,{positionAccount:D})}),(0,S.jsxs)("div",{className:"flex w-[70px] flex-col py-3 pl-2 text-xs",children:[(0,S.jsx)("span",{className:"text-white/[.75]",children:D.sizeUsd?"$"+D.sizeUsd.div(1e6).toFixed(2):(0,S.jsx)(w.O,{className:"!h-4 !w-10"})}),(0,S.jsx)("span",{className:"flex whitespace-nowrap text-v2-lily/40",children:me?(0,S.jsxs)(S.Fragment,{children:[(0,H.M)({value:me.toDP(null===se||void 0===se?void 0:se.decimals).toNumber()}),(0,S.jsx)("span",{className:"ml-0.5",children:null===se||void 0===se?void 0:se.symbol})]}):(0,S.jsx)(w.O,{className:"!h-4 !w-10"})})]}),(0,S.jsx)("div",{className:"flex w-[120px] items-center space-x-2 py-3 pl-2 text-xs text-white/[.75]",children:(0,S.jsx)("div",{className:"flex cursor-help items-center space-x-2 text-xs",children:null!==(n=D.accounting)&&void 0!==n&&n.initialCollateral.gt(0)?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsxs)("div",{className:"leading-none",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"5AGxHJ"})}),(0,S.jsxs)("div",{children:["$",null===(s=D.accounting)||void 0===s?void 0:s.initialCollateral.div(1e6).toFixed(ae)]})]}),(0,S.jsxs)("div",{className:"mt-2 flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"tHI4kn"})}),(0,S.jsxs)("div",{children:["-$",null===(l=D.accounting)||void 0===l?void 0:l.fundingFeeUsd.div(1e6).toFixed(ae)]})]}),(0,S.jsxs)("div",{className:"mt-2 flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"wxma7e"})}),(0,S.jsxs)("div",{children:["-$",null===(o=D.accounting)||void 0===o?void 0:o.borrowFeePerHourForPosition.div(1e6).toFixed(ae)]})]}),(0,S.jsx)("div",{className:"mt-4",children:(0,S.jsx)("p",{className:"text-xs",children:(0,S.jsx)(q.cC,{id:"nrY+Z3"})})})]}),children:(0,S.jsx)("span",{children:"$"+(null===(a=D.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6).toFixed(2))})}),(0,S.jsx)("button",{type:"button",onClick:function(){return K({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 px-2 py-1.5 text-xs text-white/50 hover:bg-white/10",{"cursor-not-allowed opacity-50":I}),children:c.ag._({id:"ePK91l"})})]}):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})})}),(0,S.jsx)("div",{className:"flex w-[144px] items-center justify-center py-3 pl-2 text-xs text-white/[.75]",children:D.price?(0,S.jsxs)("div",{className:"flex space-x-1",children:[(0,S.jsx)("span",{children:"$"+N.uf.format(D.price.div(1e6),pe)}),(0,S.jsx)("span",{className:"text-v2-lily/40",children:"/"}),(0,S.jsx)("span",{className:"text-v2-lily/40",children:xe?N.uf.format(xe,pe):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})})]}):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})}),(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsx)("div",{className:"leading-none",children:(0,S.jsxs)("div",{className:"text-xs",children:[(0,S.jsx)("div",{children:c.ag._({id:"RFZKdz"})}),(0,S.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,S.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,S.jsx)("div",{className:"flex w-[70px] cursor-help items-center justify-center py-3 pl-2 text-xs text-perps-warning",children:null!==(d=D.accounting)&&void 0!==d&&d.liquidationPrice?"$".concat(N.uf.format(null===(x=D.accounting)||void 0===x?void 0:x.liquidationPrice.div(1e6),pe)):null})}),de?(0,S.jsx)(Ue,{open:"tp"===de||"sl"===de,onClose:function(){return ue(!1)},positionAccount:D,type:de}):null,(0,S.jsx)("div",{className:"relative flex w-[95px] items-center justify-center space-x-2 py-3 pl-2 text-xs text-white/[.75] decoration-white/30",children:null!==(p=D.takeProfitPositionRequest)&&void 0!==p&&p.account.triggerPrice?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(new m.Z(D.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,S.jsx)("div",{onClick:function(){return ee({positionAccountPubkey:D.publicKey,focusOn:"tp"})},className:"flex h-4 w-4 cursor-pointer items-center justify-center fill-current text-white/30 hover:text-white/70",children:(0,S.jsx)(Y,{width:16,height:16})}),(0,S.jsx)("div",{onClick:function(){return ue("tp")},className:"flex h-4 w-4 cursor-pointer items-center justify-center fill-current text-white/30 hover:text-white/70",children:(0,S.jsx)(J,{width:16,height:16})})]}):(0,S.jsx)("div",{className:"flex w-full justify-center",children:(0,S.jsx)("button",{type:"button",onClick:function(){return ee({positionAccountPubkey:D.publicKey,focusOn:"tp"})},disabled:I,className:(0,y.cn)("rounded-lg border border-v2-lily/5 bg-perps-green/5 px-2 py-1.5 text-xs text-perps-green hover:bg-perps-green/20",{"cursor-not-allowed opacity-50":I}),children:c.ag._({id:"dwolAu"})})})}),(0,S.jsx)("div",{className:"flex w-[95px] items-center justify-center space-x-2 py-3 pl-2 text-xs text-white/[.75] decoration-white/30",children:null!==(f=D.stopLossPositionRequest)&&void 0!==f&&f.account.triggerPrice?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(new m.Z(D.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,S.jsx)("div",{onClick:function(){return ee({positionAccountPubkey:D.publicKey,focusOn:"sl"})},className:"flex h-4 w-4 cursor-pointer items-center justify-center fill-current text-white/30 hover:text-white/70",children:(0,S.jsx)(Y,{width:16,height:16})}),(0,S.jsx)("div",{onClick:function(){return ue("sl")},className:"flex h-4 w-4 cursor-pointer items-center justify-center fill-current text-white/30 hover:text-white/70",children:(0,S.jsx)(J,{width:16,height:16})})]}):(0,S.jsx)("div",{className:"flex w-full justify-center",children:(0,S.jsx)("button",{type:"button",onClick:function(){return ee({positionAccountPubkey:D.publicKey,focusOn:"sl"})},disabled:I,className:(0,y.cn)("rounded-lg border border-v2-lily/5 bg-perps-red/5 px-2 py-1.5 text-xs text-perps-red hover:bg-perps-red/20",{"cursor-not-allowed opacity-50":I}),children:c.ag._({id:"AGvMDH"})})})}),(0,S.jsxs)("div",{className:"flex w-[100px] justify-center px-4 text-xs xl:pl-0",children:[(0,S.jsx)("button",{type:"button",onClick:fe,className:"rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 fill-current px-2 py-1.5 text-xs text-white/50 hover:bg-white/10",children:(0,S.jsx)(X.Z,{width:12,height:12})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("ml-1 rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 px-2 py-1.5 text-xs text-white/50 hover:bg-white/10 disabled:opacity-50",{"cursor-not-allowed opacity-50":le||I}),onClick:oe,disabled:le||I,children:c.ag._({id:"yz7wBu"})})]})]}),(0,S.jsxs)("div",{className:(0,y.cn)("block 2xl:hidden","mt-5 overflow-x-hidden border-b border-b-v2-lily/5 px-1 pb-5 lg:px-3"),children:[(0,S.jsxs)("div",{onClick:function(){return M(D)},className:"flex cursor-pointer items-center text-xs text-white/[.75]",children:[(0,S.jsx)("div",{className:"flex lg:hidden",children:(0,S.jsx)(G.Z,{info:se,width:16,height:16})}),(0,S.jsx)("div",{className:"hidden lg:flex",children:(0,S.jsx)(G.Z,{info:se,width:32,height:32})}),(0,S.jsxs)("span",{className:"ml-2 text-sm font-semibold text-v2-lily",children:[null===se||void 0===se?void 0:se.symbol,"-PERP"]}),(0,S.jsxs)("span",{className:"ml-2 text-xs text-v2-lily/40",children:[D.leverage.toFixed(2),"x ",D.side]}),E?(0,S.jsx)(W.Z,{}):null,(0,S.jsxs)("button",{type:"button",onClick:fe,className:"ml-auto flex items-center space-x-1 rounded-full border border-labs/10 bg-labs/10 fill-current p-1 px-2 py-1.5 text-labs hover:bg-labs/20",children:[(0,S.jsx)(X.Z,{width:12,height:12}),(0,S.jsx)("span",{children:c.ag._({id:"Z8lGw6"})})]})]}),(0,S.jsxs)("div",{className:"mt-3 flex justify-between",children:[(0,S.jsxs)("div",{className:"flex basis-6/12 flex-col space-y-1",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("div",{className:"flex items-center space-x-1",children:(0,S.jsx)("span",{children:c.ag._({id:"wMHvYH"})})}),(0,S.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,S.jsxs)("span",{className:"text-xxs text-v2-lily/30",children:["(",R?c.ag._({id:"BABjdJ"}):c.ag._({id:"Gni0up"}),")"]}),(0,S.jsx)($.ToggleV2Mini,{active:R,onClick:function(){L((function(e){return!e}))}})]})]}),(0,S.jsx)("span",{className:"text-sm font-semibold",children:(0,S.jsx)(Ve,{positionAccount:D})})]}),(0,S.jsxs)("div",{className:"mt-1 flex basis-3/12 flex-col",children:[(0,S.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._({id:"Cj2Gtd"})}),(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("span",{className:"text-white/[.75]",children:D.sizeUsd?"$"+D.sizeUsd.div(1e6).toFixed(2):(0,S.jsx)(w.O,{className:"!h-4 !w-10"})}),(0,S.jsx)("span",{className:"text-v2-lily/40",children:me?(0,S.jsxs)(S.Fragment,{children:[(0,H.M)({value:me.toDP(null===se||void 0===se?void 0:se.decimals).toNumber()}),(0,S.jsx)("span",{className:"ml-0.5",children:null===se||void 0===se?void 0:se.symbol})]}):(0,S.jsx)(w.O,{className:"!h-4 !w-10"})})]})]}),(0,S.jsxs)("div",{className:"flex basis-3/12 flex-col items-end",children:[(0,S.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._({id:"62Xcjh"})}),(0,S.jsx)("span",{className:"mt-1 text-xs font-semibold text-v2-lily/75",children:null!==(v=D.accounting)&&void 0!==v&&v.initialCollateral.gt(0)?(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsxs)("div",{className:"leading-none",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"5AGxHJ"})}),(0,S.jsxs)("div",{children:["$",null===(g=D.accounting)||void 0===g?void 0:g.initialCollateral.div(1e6).toFixed(ae)]})]}),(0,S.jsxs)("div",{className:"mt-2 flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"tHI4kn"})}),(0,S.jsxs)("div",{children:["-$",null===(b=D.accounting)||void 0===b?void 0:b.fundingFeeUsd.div(1e6).toFixed(ae)]})]}),(0,S.jsxs)("div",{className:"mt-2 flex justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-white/75",children:c.ag._({id:"wxma7e"})}),(0,S.jsxs)("div",{children:["-$",null===(j=D.accounting)||void 0===j?void 0:j.borrowFeePerHourForPosition.div(1e6).toFixed(ae)]})]}),(0,S.jsx)("div",{className:"mt-4",children:(0,S.jsx)("p",{className:"text-xs",children:(0,S.jsx)(q.cC,{id:"nrY+Z3"})})})]}),children:(0,S.jsx)("span",{children:"$"+(null===(P=D.accounting)||void 0===P?void 0:P.initialCollateral.div(1e6).toFixed(2))})})}):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})})]})]}),(0,S.jsxs)("div",{className:"mt-3 flex w-full justify-between",children:[(0,S.jsxs)("div",{className:"flex basis-6/12 flex-col",children:[(0,S.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._({id:"shmNel"})}),(0,S.jsx)("span",{className:"mt-1 text-xs font-semibold text-v2-lily/75",children:D.price?(0,S.jsx)("div",{className:"flex space-x-1",children:(0,S.jsx)("span",{children:"$"+N.uf.format(D.price.div(1e6),pe)})}):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})})]}),(0,S.jsxs)("div",{className:"flex basis-3/12 flex-col",children:[(0,S.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._({id:"wezJ3v"})}),(0,S.jsx)("span",{className:"mt-1 text-xs font-semibold text-v2-lily/75",children:xe?N.uf.format(xe,pe):(0,S.jsx)(w.O,{className:"!h-4 !w-12"})})]}),(0,S.jsxs)("div",{className:"flex basis-3/12 flex-col items-end",children:[(0,S.jsx)("span",{className:"text-xs text-v2-lily/40",children:c.ag._({id:"Rb1yph"})}),(0,S.jsx)("span",{className:"text-xs font-semibold",children:(0,S.jsx)(B.Z,{variant:"dark",placement:"top",content:(0,S.jsx)("div",{className:"leading-none",children:(0,S.jsxs)("div",{className:"text-xs",children:[(0,S.jsx)("div",{children:c.ag._({id:"RFZKdz"})}),(0,S.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,S.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,S.jsx)("div",{className:"flex cursor-help items-center text-xs text-perps-warning/75",children:null!==(k=D.accounting)&&void 0!==k&&k.liquidationPrice?"$".concat(N.uf.format(null===(O=D.accounting)||void 0===O?void 0:O.liquidationPrice.div(1e6),pe)):null})})})]})]}),(0,S.jsxs)("div",{className:"mt-3 flex w-full items-center justify-between rounded-lg bg-black/50 py-2 lg:justify-start",children:[(0,S.jsxs)("div",{className:"basis-6/12 md:basis-5/12",children:[(0,S.jsx)("span",{className:"pl-4 text-v2-lily/40",children:c.ag._({id:"U3As+R"})}),null!==(T=D.takeProfitPositionRequest)&&void 0!==T&&T.account.triggerPrice?(0,S.jsxs)("span",{className:"ml-3 text-perps-green",children:["$",N.uf.format(new m.Z(D.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,S.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,S.jsxs)("div",{className:"basis-6/12 md:basis-3/12",children:[(0,S.jsx)("span",{className:"text-v2-lily/40",children:c.ag._({id:"lZZl3m"})}),null!==(Z=D.stopLossPositionRequest)&&void 0!==Z&&Z.account.triggerPrice?(0,S.jsxs)("span",{className:"ml-3 text-perps-red",children:["$",N.uf.format(new m.Z(D.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,S.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,S.jsx)("div",{className:"min-w-[400px]:basis-4/12 hidden"})]}),(0,S.jsxs)("div",{className:"mt-3 flex w-full justify-between space-x-2",children:[(0,S.jsx)("button",{type:"button",onClick:function(){return ee({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("flex flex-1 justify-center rounded-lg border border-v2-lily/5 bg-v2-lily/[.02] p-3 hover:bg-v2-lily/5",{"cursor-not-allowed opacity-50":I}),children:c.ag._({id:"bSCsJh"})}),(0,S.jsx)("button",{type:"button",onClick:function(){return K({positionAccountPubkey:D.publicKey})},disabled:I,className:(0,y.cn)("flex flex-1 justify-center rounded-lg border border-v2-lily/5 bg-v2-lily/[.02] p-3 hover:bg-v2-lily/5",{"cursor-not-allowed opacity-50":I}),children:c.ag._({id:"3AUpAD"})}),(0,S.jsx)("button",{type:"button",onClick:oe,disabled:le||I,className:(0,y.cn)("flex flex-1 justify-center rounded-lg border border-v2-lily/5 bg-v2-lily/[.02] p-3 hover:bg-v2-lily/5 disabled:cursor-not-allowed disabled:opacity-50",{"cursor-not-allowed opacity-50":le||I}),children:c.ag._({id:"D6X5UU"})})]})]})]})},ze=function(){var e=(0,u.Os)().wallet,t=(0,_.tc)(),n=t.userPositions,s=t.refreshPositionInfo,o=t.isAnyFormSubmitting,d=(0,u.Bn)().connection,x=(0,se.Z)().promptKeeperCloseAllPositionNotification,p=(0,h.KO)(Q.isClosingAllPositions),f=(0,r.Z)(p,2),m=f[0],v=f[1],g=(0,i.useCallback)((0,l.Z)(a().mark((function t(){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!==(null===n||void 0===n?void 0:n.length)){t.next=2;break}return t.abrupt("return");case 2:if(e){t.next=4;break}throw new Error("Wallet not connected");case 4:return v(!0),t.prev=5,t.next=8,Promise.all(n.map((function(t){return ye(e,d,t)})));case 8:return i=t.sent,t.next=11,x(i.filter(Boolean));case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),console.log("Failed to close all positions!",t.t0);case 16:return t.prev=16,s(),v(!1),t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[5,13,16,20]])}))),[d,x,s,v,n,e]);return(0,S.jsx)("button",{type:"button",className:"whitespace-nowrap rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 px-2 py-1.5 text-xs text-white/50 hover:bg-white/10 disabled:opacity-50",disabled:m||0===(null===n||void 0===n?void 0:n.length)||o,onClick:g,children:m?(0,S.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,S.jsx)(ne.Z,{width:8,height:8}),(0,S.jsx)("span",{children:c.ag._({id:"4Vzb+4"})})]}):c.ag._({id:"DGASiM"})})},He=function(e){var t=e.setPositionDirection,n=(0,u.Os)().wallet,s=(0,_.tc)(),r=s.userPositions,l=s.userPositionsFetched,o=s.oraclePrices,a=s.showPnlWithFees,d=s.setShowPnlWithFees,x=(0,u.Bn)().getTokenInfo,p=(0,i.useMemo)((function(){return r?r.sort((function(e,t){return e.sizeUsd.gt(t.sizeUsd)?-1:1})):null}),[r]),f=p&&Object.keys(p).length>0,m=(0,R.Ne)(),h=(0,i.useCallback)((function(e){var n=x(e.custody.account.mint.toString()),i=x(e.custody.account.mint.toString());n&&i&&(m(n,i,e.side),t(e.side))}),[m,x,t]),v=(0,i.useMemo)((function(){return!l||0===Object.keys(o||{}).length}),[o,l]);return(0,S.jsx)("div",{className:"w-full min-w-[300px] flex-1 overflow-hidden bg-[#16202B] pb-20",children:(0,S.jsxs)("div",{className:"webkit-scrollbar w-full overflow-x-auto text-xs xl:px-0",children:[null!==n&&void 0!==n&&n.adapter.publicKey?(0,S.jsxs)("div",{className:(0,y.cn)("justify-between border-y border-[rgba(255,255,255,0.02)] text-xs font-normal text-white-50","hidden w-full 2xl:flex"),children:[(0,S.jsx)("div",{className:"flex w-[130px] items-center py-3 pl-4 text-xs",children:"Position"}),(0,S.jsx)("div",{className:"flex w-[172px] items-center space-x-1 py-3 pl-2 text-xs",children:(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("span",{children:c.ag._({id:"wMHvYH"})}),(0,S.jsxs)("div",{className:"flex items-center gap-x-0.5",children:[(0,S.jsxs)("span",{className:"text-xxs text-v2-lily/30",children:["(",a?c.ag._({id:"BABjdJ"}):c.ag._({id:"Gni0up"}),")"]}),(0,S.jsx)($.ToggleV2Mini,{active:a,onClick:function(){d((function(e){return!e}))}})]})]})}),(0,S.jsx)("div",{className:"flex w-[70px] items-center py-3 pl-2 text-xs",children:"Size"}),(0,S.jsx)("div",{className:"flex w-[120px] items-center py-3 pl-2 text-xs",children:"Collateral"}),(0,S.jsx)("div",{className:"flex w-[144px] items-center justify-center py-3 pl-2 text-xs",children:"Entry / Mark Price"}),(0,S.jsx)("div",{className:"flex w-[70px] items-center justify-center py-3 pl-2 text-xs",children:"Liq. Price"}),(0,S.jsx)("div",{className:"flex w-[95px] items-center justify-center py-3 pl-2 text-xs",children:"Take Profit"}),(0,S.jsx)("div",{className:"flex w-[95px] items-center justify-center py-3 pl-2 text-xs",children:"Stop Loss"}),(0,S.jsx)("div",{className:"flex w-[100px] items-center justify-end py-3 pr-4 text-xs",children:(0,S.jsx)(ze,{})})]}):null,f?null:(0,S.jsx)(K,{loading:v,emptyText:(0,S.jsx)(q.cC,{id:"xAl2DN"})}),f?(0,S.jsx)("div",{className:"webkit-scrollbar overflow-auto bg-[#16202B]",children:p.map((function(e,t){return(0,S.jsx)(Be,{id:e.publicKey.toString(),positionAccount:e,onSelectMarket:h},t)}))}):null]})})},We=b()((function(){return Promise.resolve().then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),$e=function(e){var t=e.title,n=e.active,i=e.onClick;return(0,S.jsx)("button",{type:"button",onClick:i,className:(0,y.cn)("flex items-center whitespace-nowrap text-xs font-semibold leading-none text-white/20","hover:!text-v2-lily",{"!text-v2-lily":n}),children:t})},Ge=function(e){var t=e.activeTab,n=e.setActiveTab,s=e.className,l=e.showPositions,o=e.setShowPositions,a=e.children,d=(0,_.tc)().userPositions,u=(0,i.useMemo)((function(){return(null===d||void 0===d?void 0:d.length)||0}),[null===d||void 0===d?void 0:d.length]),p=(0,x.XA)(),f=i.useState(!1),m=(0,r.Z)(f,2),h=m[0],v=m[1],g=(0,i.useRef)(null),b=(0,i.useRef)(null);return(0,i.useEffect)((function(){function e(){var e,t=(null===(e=b.current)||void 0===e?void 0:e.offsetTop)||0;g.current&&p&&window.scrollY>t?v(!0):v(!1)}return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[p]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{ref:b,className:"w-full"}),(0,S.jsx)("div",{className:(0,y.cn)(h?"pt-[44px]":"")}),(0,S.jsx)("div",{ref:g,className:(0,y.cn)("relative flex w-full bg-[#16202B] lg:mx-auto",s,h?"fixed top-0 z-50 w-full":""),children:(0,S.jsx)("div",{className:"w-full max-w-full overflow-hidden",children:(0,S.jsxs)("div",{className:"w-full flex-row justify-between border-b border-v2-lily/5 lg:flex",children:[(0,S.jsxs)("div",{className:"flex justify-between",children:[(0,S.jsxs)("div",{className:"flex w-full items-center justify-start space-x-6 overflow-y-auto p-3",children:[(0,S.jsx)($e,{title:u>0?c.ag._({id:"H2q2n6",values:{0:null===d||void 0===d?void 0:d.length}}):c.ag._({id:"12Jgfh"}),active:"Positions"===t,onClick:function(){return n("Positions")}}),(0,S.jsx)($e,{title:c.ag._({id:"2Ea5Vz"}),active:"Trade History"===t,onClick:function(){return n("Trade History")}}),(0,S.jsx)($e,{title:c.ag._({id:"rwXSP8"}),active:"Expired Orders"===t,onClick:function(){return n("Expired Orders")}})]}),(0,S.jsx)("div",{className:"flex items-center pr-2 2xl:hidden",children:(0,S.jsx)(ze,{})})]}),(0,S.jsxs)("div",{className:"hidden items-center space-x-2 whitespace-nowrap px-4 text-xs text-v2-lily/50 lg:flex",children:[(0,S.jsx)(We,{active:l,onClick:function(){return o((function(e){return!e}))}}),(0,S.jsx)("span",{children:c.ag._({id:"E8sxZm"})})]})]})})}),a]})},Ye=n(47338),Xe=n(76442),Je=n(40993),Qe=n(11711),et=n(55540),tt=function(){var e=(0,l.Z)(a().mark((function e(t,n,i){var s,l,o,c,d,u,x,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],l=n.account.mint.equals(ue.Gd),o=re.PublicKey.findProgramAddressSync([n.publicKey.toBuffer(),ue.H_.toBuffer(),n.account.mint.toBuffer()],ue._u)[0],e.next=5,(0,xe.c1)(n.account.mint,n.account.owner,i);case 5:return c=e.sent,d=(0,r.Z)(c,2),u=d[0],x=d[1],!l&&x&&s.push(x),e.next=12,t.methods.closePositionRequest({}).accounts({keeper:null,owner:n.account.owner,ownerAta:l?null:u,pool:_.FW,positionRequest:n.publicKey,positionRequestAta:o,position:n.account.position}).instruction();case 12:return p=e.sent,s.push(p),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),nt=n(90342),it=n(33130),st=n(24628),rt=function(e){var t,n,s=e.id,o=e.data,d=(0,_.tc)().program,x=(0,Qe.NL)(),p=(0,u.Bn)(),f=p.connection,v=p.getTokenInfo,g=(0,u.oP)().getExplorer,b=(0,u.Os)().publicKey,j=(0,it.R3)(),w=(0,h.KO)(Je.yz),N=(0,r.Z)(w,1)[0],P=(0,nt.gs)().priorityLevel,k=(0,i.useMemo)((function(){return v(o.account.mint.toString())}),[o.account.mint,v]),O=(0,i.useMemo)((function(){return o.account.executed}),[o.account.executed]),C=(0,i.useState)(!1),T=C[0],Z=C[1],D=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var t,n,i,s,r,l,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.publicKey){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,Z(!0),e.next=6,f.getLatestBlockhash("confirmed");case 6:return n=e.sent,i=n.blockhash,s=n.lastValidBlockHeight,e.next=11,tt(d,o,f);case 11:return r=e.sent,l=(t=new re.Transaction({blockhash:i,lastValidBlockHeight:s,feePayer:b})).add.apply(t,(0,ae.Z)(r)),e.next=15,j(l,{blockhash:i,idl:et.x,idlProgramId:_.KX,lastValidBlockHeight:s},{successMessage:c.ag._({id:"MWJoln"}),submittingMessage:c.ag._({id:"AG3ZEn"}),errorMessage:c.ag._({id:"wdjREK"}),referenceFee:"MEDIUM"===P?N.perps.m:"HIGH"===P?N.perps.h:"VERY_HIGH"===P?N.perps.vh:void 0,minimumFee:Je.uo,requestComputeBudgetLimit:3e5});case 15:if(!("error"in(u=e.sent))){e.next=18;break}throw u.error;case 18:x.setQueryData(["perps-pending-refunds",null===b||void 0===b?void 0:b.toString()],(function(e){return e?e.filter((function(e){return!e.publicKey.equals(o.publicKey)})):e})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),console.log("Failed to close pending order",e.t0);case 24:return e.prev=24,Z(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[2,21,24,27]])}))),[f,o,j,P,d,b,x,N.perps.h,N.perps.m,N.perps.vh]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(s),className:"flex w-full flex-col items-start justify-center gap-3 border-t border-cyan-50 border-opacity-5 bg-[#16202B] px-3 py-4 lg:hidden",children:[(0,S.jsxs)("div",{className:"flex w-full items-center justify-between gap-2",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)("div",{className:"relative",children:k&&(0,S.jsx)(G.Z,{info:k,width:16,height:16})}),(0,S.jsx)("div",{className:"flex items-center gap-1",children:(0,S.jsxs)("div",{translate:"no",className:"text-sm font-semibold text-v2-lily",children:[null===k||void 0===k?void 0:k.symbol,"-PERP"]})}),(0,S.jsx)("div",{className:"flex items-center rounded-2xl border border-perps-red border-opacity-20 bg-perps-red bg-opacity-20 px-2 py-0.5",children:(0,S.jsxs)("div",{className:"text-center text-[11px] font-medium text-perps-red",children:[o.account.requestChange.increase?c.ag._({id:"pxFAp/"}):c.ag._({id:"WGD1Al"})," ",o.account.side.long?c.ag._({id:"otaTjg"}):c.ag._({id:"RRXpo1"})]})})]}),(0,S.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,S.jsx)("a",{href:g(o.publicKey.toString()),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,S.jsx)(st.Z,{})})})]}),(0,S.jsxs)("div",{className:"flex w-full items-start justify-between gap-x-2",children:[(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"62Xcjh"})}),(0,S.jsxs)("div",{className:"text-xs font-semibold text-v2-lily/75",children:[new m.Z((null===(t=o.account.collateralDelta)||void 0===t?void 0:t.toString())||0).div(Math.pow(10,(null===k||void 0===k?void 0:k.decimals)||0)).toString()," ",null===k||void 0===k?void 0:k.symbol]})]}),O?(0,S.jsxs)("a",{href:me.Hj,target:"_blank",className:"flex items-center space-x-2",children:[(0,S.jsx)("span",{className:"text-v2-lily/50",children:(0,S.jsx)(Xe.D7,{width:12,height:12})}),(0,S.jsx)("span",{className:"text-xs font-normal text-v2-lily/50",children:"Contact us"})]}):(0,S.jsx)("div",{className:(0,y.cn)("flex items-center text-xs text-white/[.75]"),children:(0,S.jsx)("button",{type:"button",className:"whitespace-nowrap rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 px-2 py-1.5 text-xs text-white/50 hover:bg-white/10 disabled:opacity-50",disabled:T,onClick:D,children:T?(0,S.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,S.jsx)(ne.Z,{width:8,height:8}),(0,S.jsx)("span",{children:c.ag._({id:"4Vzb+4"})})]}):c.ag._({id:"yz7wBu"})})})]}),(0,S.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(o.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,S.jsxs)("div",{id:"jupiter-perps-order-".concat(s),className:(0,y.cn)("hidden h-[62px] w-full min-w-[762px] items-center justify-between lg:flex"),children:[(0,S.jsxs)("div",{className:"flex w-[30%] justify-between",children:[(0,S.jsxs)("div",{className:"flex min-w-[150px] flex-col items-start py-3 pl-2 text-xs",children:[(0,S.jsxs)("span",{className:"font-semibold",children:[null===k||void 0===k?void 0:k.symbol,"-PERP"]}),(0,S.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(o.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,S.jsxs)("div",{className:"flex min-w-[120px] flex-col justify-center py-3 pl-2 text-xs text-white/[.75]",children:[o.account.requestChange.increase?c.ag._({id:"pxFAp/"}):c.ag._({id:"WGD1Al"})," ",o.account.side.long?c.ag._({id:"otaTjg"}):c.ag._({id:"RRXpo1"})]})]}),(0,S.jsxs)("div",{className:"flex w-3/5 justify-evenly",children:[(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[90px] items-center justify-center py-3 pl-2 text-xs text-white/[.75]"),children:o.account.requestChange.decrease?"-":"\n              ".concat(new m.Z((null===(n=o.account.collateralDelta)||void 0===n?void 0:n.toString())||0).div(Math.pow(10,(null===k||void 0===k?void 0:k.decimals)||0)).toString()," ").concat(null===k||void 0===k?void 0:k.symbol,"\n             ")}),O?(0,S.jsxs)("a",{href:me.Hj,target:"_blank",className:"flex items-center space-x-2",children:[(0,S.jsx)("span",{className:"text-v2-lily/50",children:(0,S.jsx)(Xe.D7,{width:16,height:16})}),(0,S.jsx)("span",{className:"text-xs font-normal text-v2-lily/50",children:"Contact us"})]}):(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[84px] items-center py-3 pl-2 text-xs text-white/[.75]"),children:(0,S.jsx)("button",{type:"button",className:"whitespace-nowrap rounded-lg border border-[rgba(255,255,255,0.02)] bg-white/5 px-2 py-1.5 text-xs text-white/50 hover:bg-white/10 disabled:opacity-50",disabled:T,onClick:D,children:T?(0,S.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,S.jsx)(ne.Z,{width:8,height:8}),(0,S.jsx)("span",{children:c.ag._({id:"4Vzb+4"})})]}):c.ag._({id:"yz7wBu"})})})]}),(0,S.jsx)("div",{className:"flex w-[10%] justify-between",children:(0,S.jsx)("div",{className:"flex min-w-[42px] items-center fill-current py-3 pl-2 text-white/50",children:(0,S.jsx)("a",{href:g(o.publicKey.toString(),"account"),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,S.jsx)(st.Z,{})})})})]})]})},lt=function(e){(0,Ye.Z)(e);var t=(0,u.Os)().wallet,n=(0,_.tc)(),i=n.pendingRefund,s=n.pendingRefundLoading,r=i.filter((function(e){return e.account.requestType.market&&!e.account.executed})),l=i.filter((function(e){return e.account.executed}));return(0,S.jsx)("div",{className:"w-full min-w-[300px] flex-1 bg-[#16202B]",children:(0,S.jsxs)("div",{className:"webkit-scrollbar relative w-full overflow-x-auto rounded-lg text-xs xl:px-0",children:[null!==t&&void 0!==t&&t.adapter.publicKey?(0,S.jsxs)("div",{className:(0,y.cn)("hidden border-b border-v2-lily/5 text-xs font-normal text-white-50 lg:flex","w-full min-w-[762px]"),children:[(0,S.jsxs)("div",{className:"flex w-[30%] justify-between",children:[(0,S.jsx)("div",{className:"flex min-w-[150px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"p/78dY"})}),(0,S.jsx)("div",{className:"flex min-w-[120px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"bwRvnp"})})]}),(0,S.jsxs)("div",{className:"flex w-3/5 justify-evenly",children:[(0,S.jsx)("div",{className:"flex min-w-[90px] items-center justify-center py-3 pl-2 text-xs",children:c.ag._({id:"62Xcjh"})}),(0,S.jsx)("div",{className:"flex min-w-[84px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"yz7wBu"})})]}),(0,S.jsx)("div",{className:"flex w-[10%] justify-between",children:(0,S.jsx)("div",{className:"flex min-w-[84px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"AeXO77"})})})]}):null,(0,S.jsxs)("div",{children:[0===r.length&&0===l.length?(0,S.jsx)(K,{loading:Boolean(s),emptyText:(0,S.jsx)(q.cC,{id:"zUhGpQ"})}):null,l.length>0?l.map((function(e,t){return(0,S.jsx)(rt,{id:e.publicKey.toString(),data:e},t)})):null,r.length>0?r.map((function(e,t){return(0,S.jsx)(rt,{id:e.publicKey.toString(),data:e},t)})):null]})]})})},ot=n(32529),at=n(30825),ct=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,s=void 0===i?16:i,r=e.className;return(0,S.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:s,viewBox:"0 0 24 24",className:r,children:(0,S.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2",d:"M20 4H4v2l6 6v8.5l4-2.5v-6l6-6z"})})},dt=function(e){var t=e.width,n=void 0===t?10:t,i=e.height,s=void 0===i?10:i,r=e.stroke,l=void 0===r?"#768222":r;return(0,S.jsx)("svg",{width:n,height:s,viewBox:"0 0 10 10",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M8.33329 2.5L3.74996 7.08333L1.66663 5",stroke:l,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},ut=function(){return(0,S.jsx)("div",{className:"h-4"})},xt=function(e){var t=e.item,n=t.label,i=t.onClick,s=t.selected,r=void 0!==s&&s,l=t.separator,o=void 0!==l&&l,a=t.className,c=Boolean(i);return(0,S.jsxs)("li",{className:"flex cursor-default flex-col",children:[(0,S.jsxs)("div",{className:(0,p.cn)("flex w-full items-center justify-between space-x-2 bg-transparent fill-current pl-2 pr-4 text-left text-sm text-white/50",c?"cursor-pointer hover:bg-white/10":"cursor-default",a),onClick:function(e){e.stopPropagation(),null===i||void 0===i||i()},children:[(0,S.jsx)("div",{className:"w-full",children:n}),r&&(0,S.jsx)(dt,{stroke:"rgba(199, 242, 132, 1)"})]}),o&&(0,S.jsx)(ut,{})]})},pt=function(e){var t=e.items,n=e.filterOn,s=(0,i.useRef)(null),r=(0,i.useState)(!1),l=r[0],o=r[1];return(0,i.useEffect)((function(){var e=function(e){s.current&&!s.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[]),(0,S.jsxs)("button",{className:(0,p.cn)("relative fill-current",n?"text-v2-lily":"text-v2-lily/50 hover:text-v2-lily"),onClick:function(){o((function(e){return!e}))},ref:s,children:[(0,S.jsx)(ct,{width:12,height:12}),(0,S.jsx)("div",{className:(0,p.cn)("absolute left-full top-2 min-w-[15rem] overflow-hidden transition-all","rounded-xl border border-v2-lily/10 bg-v3 shadow-header-settings",l?"z-50 opacity-100":"pointer-events-none opacity-0"),children:(0,S.jsx)("ul",{children:t.map((function(e,t){return(0,S.jsx)(xt,{item:e},t)}))})})]})},ft=function(e){var t=e.id,n=e.data,s=e.setPositionDirection,r=(0,C.y)().showShareHistoryDialog,l=(0,u.Bn)().getTokenInfo,o=(0,u.oP)().getExplorer,a=(0,i.useMemo)((function(){return l(n.mint.toString())}),[l,n.mint]),d=n.pnlUsd?new m.Z(n.pnlUsd.toString()).div(1e6).toDP(2):null,x=(0,R.Ne)(),p=(0,i.useCallback)((function(){if(n.inOutTokenMint&&a){var e=l(n.inOutTokenMint.toString());e&&a&&(x(e,a,"Long"===n.side?"long":"short"),s("Long"===n.side?"long":"short"))}}),[n.inOutTokenMint,n.side,a,l,x,s]),f=function(){r(n)};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(t),className:"flex w-full flex-col items-start justify-center gap-3 border-t border-cyan-50 border-opacity-5 bg-[#16202B] px-3 py-4 lg:hidden",children:[(0,S.jsxs)("div",{className:"flex w-full items-center justify-between gap-2",onClick:function(){return p()},children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)("div",{className:"relative",children:(0,S.jsx)(G.Z,{info:a,width:16,height:16})}),(0,S.jsx)("div",{className:"flex items-center gap-1",children:(0,S.jsxs)("div",{translate:"no",className:"text-sm font-semibold text-v2-lily",children:[null===a||void 0===a?void 0:a.symbol,"-PERP"]})}),(0,S.jsx)("div",{className:"flex items-center rounded-2xl border border-perps-red border-opacity-20 bg-perps-red bg-opacity-20 px-2 py-0.5",children:(0,S.jsxs)("div",{className:"text-center text-[11px] font-medium text-perps-red",children:[n.requestChange," ",n.side]})})]}),(0,S.jsxs)("div",{className:"flex space-x-2",children:[(0,S.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,S.jsx)("a",{href:o(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,S.jsx)(st.Z,{})})}),(0,S.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,S.jsx)("button",{className:"fill-current text-white/50",onClick:f,children:(0,S.jsx)(X.Z,{width:12,height:12})})})]})]}),(0,S.jsxs)("div",{className:"flex w-full items-start gap-3",children:[(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"YiGFj9"})}),(0,S.jsx)("div",{className:"text-xs font-semibold text-v2-lily/75",children:n.requestType})]}),(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"UMYt66"})}),(0,S.jsxs)("div",{className:"text-xs font-semibold text-v2-lily/75",children:["Increase"===n.requestChange?"-$":"+$",new m.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]})]}),(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"a7u1N9"})}),(0,S.jsx)("div",{className:"text-xs font-semibold text-v2-lily/75",children:"$"+new m.Z(n.price.toString()).div(1e6).toFixed(2).toString()})]})]}),(0,S.jsxs)("div",{className:"flex w-full items-start gap-3",children:[(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"Cj2Gtd"})}),(0,S.jsx)("div",{className:"text-xs font-semibold text-v2-lily/75",children:"$"+new m.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,S.jsxs)("div",{className:"flex shrink grow basis-0 flex-col items-start",children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"PLUB/s"})}),(0,S.jsx)("div",{className:"text-xs font-semibold text-v2-lily/75",children:"$"+new m.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,S.jsxs)("div",{className:(0,y.cn)("flex shrink grow basis-0 flex-col items-start",d?"":"invisible"),children:[(0,S.jsx)("div",{className:"text-xs font-medium text-v2-lily/40",children:c.ag._({id:"OaBqjF"})}),(0,S.jsx)("div",{className:(0,y.cn)("text-xs font-semibold text-v2-lily/75",{"text-[rgba(39,174,96,1)]":null===d||void 0===d?void 0:d.gt(0),"text-[#EB5757]":null===d||void 0===d?void 0:d.lt(0),"text-v2-lily/50":null===d||void 0===d?void 0:d.eq(0)}),children:d?"$"+d.toFixed(2).toString():""})]})]}),(0,S.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,S.jsxs)("div",{id:"jupiter-perps-order-".concat(t),className:(0,y.cn)("hidden h-[62px] w-full min-w-[1092px] items-center justify-between lg:flex"),children:[(0,S.jsxs)("div",{className:"flex w-[30%] justify-between",children:[(0,S.jsxs)("div",{onClick:function(){return p()},className:"flex min-w-[150px] flex-col items-start py-3 pl-2 text-xs",children:[(0,S.jsxs)("span",{className:"font-semibold",children:[null===a||void 0===a?void 0:a.symbol,"-PERP"]}),(0,S.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,V.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,S.jsxs)("div",{className:"flex min-w-[120px] flex-col justify-center py-3 pl-2 text-xs text-white/[.75]",children:[n.requestChange," ",n.side]}),(0,S.jsx)("div",{className:"flex min-w-[120px] flex-col justify-center py-3 pl-2 text-xs text-white/[.75]",children:n.requestType})]}),(0,S.jsxs)("div",{className:"flex w-[65%] justify-evenly",children:[(0,S.jsxs)("div",{className:(0,y.cn)("flex min-w-[150px] items-center py-3 pl-2 text-xs text-white/[.75]"),children:["Increase"===n.requestChange?"-$":"+$",new m.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]}),(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[90px] items-center py-3 pl-2 text-xs text-white/[.75]"),children:"$"+new m.Z(n.price.toString()).div(1e6).toFixed(2).toString()}),(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[90px] items-center py-3 pl-2 text-xs text-white/[.75]"),children:"$"+new m.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()}),(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[120px] items-center py-3 pl-2 text-xs",{"text-[rgba(39,174,96,1)]":null===d||void 0===d?void 0:d.gt(0),"text-[#EB5757]":null===d||void 0===d?void 0:d.lt(0),"text-v2-lily/50":null===d||void 0===d?void 0:d.eq(0)}),children:d?"$"+d.toFixed(2).toString():""}),(0,S.jsx)("div",{className:(0,y.cn)("flex min-w-[84px] items-center py-3 pl-2 text-xs text-white/[.75]"),children:"$"+new m.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,S.jsxs)("div",{className:"flex w-[5%] justify-between",children:[(0,S.jsx)("div",{className:"flex min-w-[42px] items-center fill-current py-3 pl-2 text-white/50",children:(0,S.jsx)("a",{href:o(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,S.jsx)(st.Z,{})})}),(0,S.jsx)("div",{className:"flex min-w-[42px] items-center fill-current px-2 py-3 text-white/50",children:(0,S.jsx)("button",{onClick:f,className:"space-x-2",children:(0,S.jsx)(X.Z,{})})})]})]})]})},mt=function(e){var t=e.header;return(0,S.jsx)("span",{className:"block w-full border-b border-b-v2-lily/20 pb-2 pt-3 text-xs font-semibold text-v2-lily",children:t})},ht=function(e){var t=e.tokenInfo;return(0,S.jsxs)("div",{className:"flex items-center space-x-2 py-2 text-xs font-semibold text-v2-lily/80",children:[(0,S.jsx)(G.Z,{info:t,width:18,height:18}),(0,S.jsxs)("span",{children:[t.symbol,"-PERP"]})]})};function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bt=b()((function(){return Promise.all([n.e(61732),n.e(88275)]).then(n.bind(n,88275))}),{ssr:!1,loadableGenerated:{webpack:function(){return[88275]}}}),jt=function(e){var t=e.children;return(0,S.jsx)("div",{className:"py-2 text-xs font-semibold text-v2-lily/80",children:t})},wt=function(e){var t,n,s,r,l,o,a,d,x=e.setPositionDirection,p=(0,u.Os)(),f=p.wallet,m=p.connected,h=(0,_.tc)().tradeHistory,v=function(){var e=(0,_.tc)(),t=e.perpsTokens.nonStableTokens,n=e.tradeHistory,i=n.filter,s=n.setFilter,r=function(){s(gt(gt({},i),{},{requestChange:void 0}))},l=function(){s(gt(gt({},i),{},{side:void 0}))},o=t.map((function(e){var t=(null===i||void 0===i?void 0:i.mint)===e.address;return{label:(0,S.jsx)(ht,{tokenInfo:e}),selected:t,onClick:function(){s(gt(gt({},i),{},t?{mint:void 0}:{mint:e.address}))}}})),a=[{label:(0,S.jsx)(mt,{header:c.ag._({id:"TP9/K5"})})}].concat((0,ae.Z)(o),[{label:(0,S.jsx)(mt,{header:c.ag._({id:"mYGY3B"})})},{label:(0,S.jsx)(bt,{}),className:"px-0"}]);return{actionFilterMenuItems:[{label:(0,S.jsx)(mt,{header:c.ag._({id:"bwRvnp"})})},{label:(0,S.jsx)(jt,{children:c.ag._({id:"pxFAp/"})}),selected:"Increase"===(null===i||void 0===i?void 0:i.requestChange),onClick:function(){"Increase"!==(null===i||void 0===i?void 0:i.requestChange)?s(gt(gt({},i),{},{requestChange:"Increase"})):r()}},{label:(0,S.jsx)(jt,{children:c.ag._({id:"WGD1Al"})}),selected:"Decrease"===(null===i||void 0===i?void 0:i.requestChange),onClick:function(){"Decrease"!==(null===i||void 0===i?void 0:i.requestChange)?s(gt(gt({},i),{},{requestChange:"Decrease"})):r()}},{label:(0,S.jsx)(mt,{header:c.ag._({id:"lg7+vk"})})},{label:(0,S.jsx)(jt,{children:c.ag._({id:"otaTjg"})}),selected:"Long"===(null===i||void 0===i?void 0:i.side),onClick:function(){"Long"!==(null===i||void 0===i?void 0:i.side)?s(gt(gt({},i),{},{side:"Long"})):l()}},{label:(0,S.jsx)(jt,{children:c.ag._({id:"RRXpo1"})}),selected:"Short"===(null===i||void 0===i?void 0:i.side),onClick:function(){"Short"!==(null===i||void 0===i?void 0:i.side)?s(gt(gt({},i),{},{side:"Short"})):l()}}],positionFilterMenuItems:a}}(),g=v.positionFilterMenuItems,b=v.actionFilterMenuItems,j=(0,ot.Y)({pageIndex:h.pageIndex,pageCount:h.pageCount,setPageIndex:h.setPageIndex}),w=j.pager,N=j.canPreviousPage,P=j.canNextPage,k=j.gotoPage,O=(0,i.useMemo)((function(){var e,t,n,i;return null!==(e=h.data)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.trades&&m?null===(n=h.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.trades:[]}),[m,null===(t=h.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.trades]),C=Boolean((null===(s=h.filter)||void 0===s?void 0:s.mint)||(null===(r=h.filter)||void 0===r?void 0:r.createdAtAfter)),T=Boolean((null===(l=h.filter)||void 0===l?void 0:l.requestChange)||(null===(o=h.filter)||void 0===o?void 0:o.side));return(0,S.jsxs)("div",{className:"w-full min-w-[300px] flex-1 bg-[#16202B]",children:[(0,S.jsxs)("div",{className:"webkit-scrollbar relative flex min-h-[350px] w-full flex-col overflow-x-auto rounded-lg text-xs xl:px-0",children:[null!==f&&void 0!==f&&f.adapter.publicKey?(0,S.jsxs)("div",{className:(0,y.cn)("hidden border-b border-v2-lily/5 text-xs font-normal text-white-50 lg:flex","w-full min-w-[1092px]"),children:[(0,S.jsxs)("div",{className:"flex w-[30%] justify-between",children:[(0,S.jsxs)("div",{className:"flex min-w-[150px] items-center space-x-2 py-3 pl-2 text-xs",children:[(0,S.jsx)("p",{children:c.ag._({id:"p/78dY"})}),(0,S.jsx)(pt,{items:g,filterOn:C})]}),(0,S.jsxs)("div",{className:"flex min-w-[120px] items-center space-x-2 py-3 pl-2 text-xs",children:[(0,S.jsx)("p",{children:c.ag._({id:"bwRvnp"})}),(0,S.jsx)(pt,{items:b,filterOn:T})]}),(0,S.jsx)("div",{className:"flex min-w-[120px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"YiGFj9"})})]}),(0,S.jsxs)("div",{className:"flex w-[65%] justify-evenly",children:[(0,S.jsx)("div",{className:"flex min-w-[150px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"BSYpsJ"})}),(0,S.jsx)("div",{className:"flex min-w-[90px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"a7u1N9"})}),(0,S.jsx)("div",{className:"flex min-w-[90px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"Cj2Gtd"})}),(0,S.jsx)("div",{className:"flex min-w-[120px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"llUlxR"})}),(0,S.jsx)("div",{className:"flex min-w-[84px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"PLUB/s"})})]}),(0,S.jsx)("div",{className:"flex w-[5%] justify-between",children:(0,S.jsx)("div",{className:"flex min-w-[42px] items-center py-3 pl-2 text-xs",children:c.ag._({id:"S3piC2"})})})]}):null,(0,S.jsx)("div",{children:O.length>0?O.map((function(e,t){return(0,S.jsx)(ft,{id:e.id,data:e,setPositionDirection:x},t)})):null}),(0,S.jsx)("div",{className:"flex flex-1",children:0===O.length?(0,S.jsx)(K,{loading:Boolean(null===(a=h.data)||void 0===a?void 0:a.isLoading),emptyText:(0,S.jsx)(q.cC,{id:"iYKjts"}),className:"flex-1"}):null}),O.length>0&&null!==(d=h.data)&&void 0!==d&&d.isFetching?(0,S.jsx)("div",{className:"absolute left-0 top-0 h-full w-full bg-black/10 backdrop-blur-sm"}):null]}),h.pageCount>0?(0,S.jsx)(at.Z,{canPreviousPage:N,gotoPage:k,pageIndex:h.pageIndex,pager:w,canNextPage:P}):null]})},yt=n(65558),Nt=n.n(yt),Pt=n(9319),St=n.n(Pt),kt=n(54566),Ot=n(71130),_t=n(65670),Ct=n(80989),Tt=n(50944),Zt=["position"];function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ft=new m.Z(100),At=function(e){var t,n,s,r,o,d=e.positionAccount,x=(0,_.tc)(),h=x.viewClient,v=x.slippage,g=x.oraclePrices,b=x.refreshPositionInfo,j=x.poolInfo,P=x.isAnyFormSubmitting,k=x.setIsAnyFormSubmitting,T=(0,C.y)(),Z=T.isClosePositionDialogOpen,D=T.dismissClosePositionDialog,M=(0,u.Bn)(),F=M.connection,A=M.getTokenInfo,E=M.tokenMap,I=(0,u.Os)().wallet,R=(0,se.Z)().promptKeeperClosePositionNotification,L=(0,i.useMemo)((function(){var e;return null!==(e=A(d.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[A,d.custody.account.mint]),U=(0,i.useMemo)((function(){return A(d.collateralCustody.account.mint.toString())}),[A,d.collateralCustody.account.mint]),K=(0,i.useState)(!0),V=K[0],B=(K[1],(0,i.useMemo)((function(){return d.sizeUsd.div(1e6).toNearest(1e-4,m.Z.ROUND_DOWN).toString()}),[d.sizeUsd])),z=(0,te.cI)({defaultValues:{amount:B}}),W=z.control,$=z.handleSubmit,Y=z.watch,X=z.setValue,J=z.formState,Q=Y("amount"),ae=(0,i.useCallback)((function(e){var t=new m.Z(B).mul(e).div(100).toString();X("amount",t)}),[B,X]),ce=(0,i.useMemo)((function(){if((0,p.Hd)(Q)&&B)return new m.Z(Q).gt(B)}),[Q,B]),de=(0,i.useMemo)((function(){return Boolean(d.accounting)}),[d.accounting]),ue=(0,i.useMemo)((function(){if(!(0,p.Hd)(Q)||!d.accounting)return[!1,null,null];var e=new m.Z(0),t=d.sizeUsd.sub(new m.Z(Q).mul(1e6)).lt(Ft),n=t?d.sizeUsd:new m.Z(Q).mul(1e6),i=d.accounting.unrealizedPNL;if(t)e=new m.Z(0);else if(V&&n&&!t){var s=n.div(d.sizeUsd);if(e=d.accounting.initialCollateral.mul(s).toDP(0),d.accounting.pnlAfterFeesUsd.lt(0)){var r=i.mul(-1).add(d.accounting.closePositionFeeUsd).mul(s).add(d.accounting.fundingFeeUsd);e=e.gt(r)?e.sub(r).toDP(0):new m.Z(0)}}return[t,e,n]}),[Q,d.accounting,d.sizeUsd,V]),xe=ue[0],pe=ue[1],fe=ue[2],me=(0,f.a)([Q,V,B,null===U||void 0===U?void 0:U.address,d.publicKey.toString()],(0,l.Z)(a().mark((function e(){var t,n,i,s,r,l,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe&&fe&&(0,p.Hd)(Q)&&!fe.lte(0)&&U&&h&&Ke&&Ve&&null!==j&&void 0!==j&&j.pool){e.next=2;break}return e.abrupt("return",null);case 2:if(!new m.Z(Q).gt(B)){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,h.getDecreasePosition({position:d,collateralUsdDelta:new(Nt())(pe.round().toFixed()),sizeUsdDelta:new(Nt())(fe.round().toFixed()),tokenPrice:null===Ke||void 0===Ke?void 0:Ke.toNumber(),collateralTokenPrice:null===Ve||void 0===Ve?void 0:Ve.toNumber(),pool:j.pool});case 6:if(t=e.sent){e.next=9;break}throw new Error("Failed to get decrease position");case 9:return n=new m.Z(t.liquidationPrice.toString()),i=d.sizeUsd.sub(fe),s=new m.Z(t.collateralUsd.toString()),r=m.Z.max(0,new m.Z(t.impactFeeUsd.toString()).div(1e6)),l=(0,p.y_)(r),o=r?"".concat(N.uf.format(r,l)," USD"):"-",e.abrupt("return",{liquidationPrice:xe?null:n,size:i,collateralUsd:s.div(1e6),fees:new m.Z(t.feeUsd.toString()).div(1e6),leverage:i.div(s).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(t.transferToken.toString()).div(Math.pow(10,U.decimals)),transferAmountUsd:new m.Z(t.transferAmountUsd.toString()).div(1e6).toDP(2),closeFee:new m.Z(t.closeBaseFeeUsd.toString()).div(1e6),impactFee:m.Z.max(0,new m.Z(t.impactFeeUsd.toString()).div(1e6)),impactPct:new m.Z(t.impactFeeBps.toString()).div(100),impactFeeUsdText:o,borrowFee:new m.Z(t.fundingFeeUsd.toString()).div(1e6)});case 16:case"end":return e.stop()}}),e)}))),{enabled:Boolean(h&&U),retry:3,retryDelay:500,refetchInterval:5e3}),he=me.data,ve=me.isLoading,ge=me.isLoadingError,be=(0,i.useMemo)((function(){return!!he&&(!xe&&!V&&new m.Z(he.leverage).lt(1))}),[he,xe,V]),je=(0,i.useMemo)((function(){var e=[];return ce&&e.push(c.ag._({id:"JpJ3JI"})),be&&e.push(c.ag._({id:"GMppy+"})),e}),[ce,be]),we=(0,i.useState)(U||null),ye=we[0],Ne=we[1],Se=(0,i.useState)(null),ke=Se[0],Oe=Se[1];(0,i.useEffect)((function(){!ye&&U&&he&&Oe(he.transferToken)}),[U,he,null===he||void 0===he?void 0:he.transferAmountUsd,null===he||void 0===he?void 0:he.transferToken,ye]);var _e=(0,i.useState)(!1),Ce=_e[0],Te=_e[1],Ze=i.useCallback((function(e){Te(!1),Ne(e)}),[]),Fe=(0,i.useMemo)((function(){return Array.from(E.keys())}),[E]),Ae=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===U||void 0===U?void 0:U.address)!==(null===ye||void 0===ye?void 0:ye.address),amount:ke&&ye&&U&&he?St().BigInt(he.transferToken.mul(Math.pow(10,U.decimals)).toFixed()):St().BigInt(0),fromTokenInfo:U}}),[U,he,ke,ye]),Ee=(0,Ct.Z)({disabled:!Ae.isTokenSwapRequired,amount:Ae.amount,fromTokenInfo:Ae.fromTokenInfo,toTokenInfo:ye,slippage:v}),Ie=Ee.outAmount,Re=Ee.otherAmountThreshold,qe=Ee.isLoading,Le=(0,i.useMemo)((function(){return ce||J.isSubmitting||be||Ae.isTokenSwapRequired&&qe||!(0,p.Hd)(Q)||Number(Q)<=0}),[ce,J.isSubmitting,be,Ae.isTokenSwapRequired,qe,Q]),Ue=(0,i.useMemo)((function(){return g&&U?[g[L.address],g[U.address]]:[null,null]}),[g,U,L.address]),Ke=Ue[0],Ve=Ue[1],Be=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var t,n,i,s,r,o,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Le&&I){e.next=2;break}return e.abrupt("return");case 2:return k(!0),t=de&&pe?new(Nt())(pe.round().toFixed()):new(Nt())(0),n=de&&fe?new(Nt())(fe.round().toFixed()):new(Nt())(d.sizeUsd.round().toFixed()),i="long"===d.side?new(Nt())(0):new(Nt())("18446744073709551615"),e.prev=6,s={position:d,priceSlippage:i,collateralUsdDelta:t,sizeUsdDelta:n,desiredMint:Ae.isTokenSwapRequired&&ye?new re.PublicKey(ye.address):d.collateralCustody.account.mint,jupiterMinimumOut:Ae.isTokenSwapRequired&&Re?new(Nt())(Re.toString()):null},e.next=10,Pe(Mt({wallet:I,connection:F},s));case 10:return r=e.sent,o=r.instructions,c=r.positionRequestKey,e.next=15,new Promise(function(){var e=(0,l.Z)(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(o,c,(function(e){D(),b(),t(e)}),(function(e){n(e)}),function(){var e=s.position,t=(0,ee.Z)(s,Zt);return Mt({wallet:I.adapter.name,position:e.publicKey.toString()},(0,De.w_)(t))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 15:return e.abrupt("return",e.sent);case 18:e.prev=18,e.t0=e.catch(6),console.log("Failed to close position!",e.t0);case 21:return e.prev=21,k(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[6,18,21,24]])}))),[pe,F,D,Le,de,Re,d,R,ye,b,k,fe,Ae.isTokenSwapRequired,I]),ze=(0,i.useMemo)((function(){if(ye&&he)return Ae.isTokenSwapRequired?Ie?new m.Z(Ie.toString()||0).div(Math.pow(10,ye.decimals)).toString():void 0:he.transferToken.toString()}),[he,Ie,ye,Ae.isTokenSwapRequired]);return(0,S.jsx)(le.Z,{open:Z,onClose:D,children:(0,S.jsxs)("form",{className:"relative w-full rounded-lg bg-v2-perps-modal lg:max-w-[400px]",children:[(0,S.jsx)("div",{className:"mb-2 p-4 font-semibold leading-none text-v2-lily lg:mb-0 lg:p-6 lg:text-lg",children:c.ag._({id:"8qRSMi"})}),(0,S.jsx)("button",{type:"button",disabled:P,className:"absolute right-8 top-5 z-10 flex cursor-pointer fill-current text-v2-lily/[.25] disabled:cursor-not-allowed disabled:opacity-50 lg:top-8",onClick:D,children:(0,S.jsx)(oe.Z,{width:12,height:12})}),Ce?(0,S.jsx)("div",{className:"absolute left-0 top-0 z-50 h-full w-full",children:(0,S.jsx)(_t.ZP,{onSubmit:Ze,onClose:function(){return Te(!1)},mintsList:Fe,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,S.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,S.jsxs)("div",{className:"px-4 lg:px-6",children:[(0,S.jsxs)("div",{className:"rounded-lg border border-v2-lily/[.15] bg-v2-lily/5 p-4 lg:p-5",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(G.Z,{info:L,width:24,height:24}),(0,S.jsx)(q.cC,{id:"14o+cp",values:{0:L.symbol},components:{0:(0,S.jsx)("span",{})}})]}),(0,S.jsxs)("span",{className:"text-sm font-semibold",children:[null===Ke||void 0===Ke?void 0:Ke.toFixed(2).toString()," USD"]})]}),(0,S.jsx)("div",{className:"my-3 border-b border-v2-lily/5 lg:my-4"}),(0,S.jsxs)("div",{className:"space-y-2",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"oeP0s2"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",d.sizeUsd.div(1e6).toFixed(2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"shmNel"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",d.price.div(1e6).toFixed(2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"pYW6HQ"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",null===(t=d.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"7gqdcv"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:[d.leverage.toFixed(2),"x"]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"6nrP+I"})}),(0,S.jsx)(Me,{changePct:null===(n=d.accounting)||void 0===n?void 0:n.unrealizedPNLPct,pnl:null===(s=d.accounting)||void 0===s?void 0:s.unrealizedPNL})]})]})]}),(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"OJTWKn"})}),de?(0,S.jsxs)("div",{className:"flex space-x-1",children:[(0,S.jsx)("button",{type:"button",onClick:function(){return ae(25)},className:"rounded-md border border-v2-lily/10 px-1.5 py-0.5 text-xxs font-semibold text-v2-lily/[0.35] hover:border-v2-lily/20 hover:text-v2-lily/50",children:"25%"}),(0,S.jsx)("button",{type:"button",onClick:function(){return ae(50)},className:"rounded-md border border-v2-lily/10 px-1.5 py-0.5 text-xxs font-semibold text-v2-lily/[0.35] hover:border-v2-lily/20 hover:text-v2-lily/50",children:"50%"}),(0,S.jsx)("button",{type:"button",onClick:function(){return ae(75)},className:"rounded-md border border-v2-lily/10 px-1.5 py-0.5 text-xxs font-semibold text-v2-lily/[0.35] hover:border-v2-lily/20 hover:text-v2-lily/50",children:"75%"}),(0,S.jsx)("button",{type:"button",onClick:function(){return ae(100)},className:"rounded-md border border-v2-lily/10 px-1.5 py-0.5 text-xxs font-semibold text-v2-lily/[0.35] hover:border-v2-lily/20 hover:text-v2-lily/50",children:"100%"})]}):(0,S.jsx)("div",{className:"text-xs font-semibold text-v2-lily",children:c.ag._({id:"OUm2CC"})})]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"amount",control:W,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsx)(ie.Z,{disabled:new m.Z(B).lte(0)&&!de,decimals:6,onChange:function(e){var t=e.value;e.floatValue&&new m.Z(t).greaterThan(B)?n(B):n(t)},value:de?i:B,className:(0,y.cn)("w-full !text-right !text-sm !outline-none disabled:!text-white",de?"":"cursor-not-allowed"),placeholder:"0.00",suffix:" USD"})}})}),je.length>0?je.map((function(e,t){return(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:e},t)})):null,(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"ouUb5L"})})}),(0,S.jsxs)("div",{className:"text-md h-18 mt-2 flex rounded-lg bg-v2-perps-input p-4 text-right",children:[(0,S.jsxs)("div",{className:(0,y.cn)("flex items-center rounded-lg px-2 py-1.5"),children:[ye?(0,S.jsx)(G.Z,{info:ye,width:28,height:28}):null,(0,S.jsx)("span",{className:"ml-3 text-sm font-semibold",children:null===ye||void 0===ye?void 0:ye.symbol})]}),(0,p.Hd)(Q)&&0!==Number(Q)?(0,S.jsxs)("div",{className:"relative flex w-full flex-col",children:[ye?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ie.Z,{className:"!text-right !text-base !outline-none disabled:!cursor-not-allowed disabled:!text-white",disabled:!0,decimals:ye.decimals,value:ze||void 0,suffix:" "+ye.symbol}),(0,S.jsx)("div",{className:(0,y.cn)("relative !text-xs text-white-35"),children:(0,S.jsx)(kt.default,{tokenInfo:ye,amount:Number(ze)})})]}):null,ve||ge?(0,S.jsx)(w.O,{className:"absolute right-0 top-0 !h-full"}):null]}):(0,S.jsx)("div",{className:"flex w-full cursor-not-allowed items-center justify-end text-xs text-white/50",children:c.ag._({id:"UCLqPP"})})]}),ge?(0,S.jsx)(Ot.Z,{iconSize:14,className:"mt-2 rounded-lg bg-warning/10 !p-2 !text-warning",message:(0,S.jsx)(q.cC,{id:"963Jae",components:{0:(0,S.jsx)("p",{})}})}):null,(0,S.jsxs)("div",{className:"mt-5 space-y-2",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"Cj2Gtd"})}),(0,S.jsx)("div",{children:null!==he&&void 0!==he&&he.size?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("span",{children:["$",d.sizeUsd.div(1e6).toFixed(2)]}),(0,S.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",he.size.div(1e6).toFixed(2)]})]}):(0,S.jsxs)("span",{children:["$",d.sizeUsd.div(1e6).toFixed(2)]})})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"62Xcjh"})}),(0,S.jsx)("div",{children:null!==he&&void 0!==he&&he.collateralUsd?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("span",{children:["$",null===(r=d.accounting)||void 0===r?void 0:r.initialCollateral.div(1e6).toFixed(2)]}),(0,S.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",he.collateralUsd.toFixed(2)]})]}):(0,S.jsxs)("span",{children:["$",null===(o=d.accounting)||void 0===o?void 0:o.initialCollateral.div(1e6).toFixed(2)]})})]}),V?null:(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"Ke6k18"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:[d.leverage.toFixed(2),"x"]}),(0,S.jsx)("span",{className:"px-1 text-white",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white",children:[null===he||void 0===he?void 0:he.leverage.toFixed(2),"x"]})]})]}),(0,S.jsxs)("div",{className:"flex max-h-[16px] items-center justify-between overflow-hidden text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"BnO2Ox"})}),(0,S.jsxs)("span",{className:"flex items-center",children:["$",(0,S.jsx)(H.ZP,{value:(null===he||void 0===he?void 0:he.closeFee.toNumber())||0})]})]}),(0,S.jsx)("div",{className:"flex max-h-[16px] items-center justify-between overflow-hidden text-xs text-white/50",children:(0,S.jsx)(Tt.hb,{impactPct:(null===he||void 0===he?void 0:he.impactPct)||null,impactFeeUsdText:(null===he||void 0===he?void 0:he.impactFeeUsdText)||"",orderInfoLoading:ve})}),(0,S.jsxs)("div",{className:"flex max-h-[16px] items-center justify-between overflow-hidden text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"G63uM9"})}),(0,S.jsxs)("span",{className:"flex items-center",children:["$",(0,S.jsx)(H.ZP,{value:(null===he||void 0===he?void 0:he.borrowFee.toNumber())||0})]})]})]})]}),(0,S.jsxs)("div",{className:"flex w-full space-x-3 p-6 text-xs",children:[J.isSubmitting?null:(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-v2-lily/10 bg-v2-lily/5 px-6 py-2.5 text-sm font-semibold text-v2-lily hover:bg-v2-lily/10 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":J.isSubmitting}),disabled:J.isSubmitting,onClick:D,children:(0,S.jsx)("span",{children:c.ag._({id:"dEgA5A"})})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-labs/20 px-6 py-2.5 text-sm font-semibold text-labs hover:bg-labs/5 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":J.isSubmitting||Le}),disabled:Le,onClick:$(Be),children:J.isSubmitting?(0,S.jsxs)("span",{className:"flex items-center justify-center",children:[(0,S.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,S.jsx)("div",{className:"mr-2"}),c.ag._({id:"lFdKwD"})]}):(0,S.jsx)("span",{className:"text-center",children:c.ag._({id:"7VpPHA"})})})]})]})]})})},Et=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().closePositionDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,S.jsx)(At,{positionAccount:n}):null},It=n(94223),Rt=n(38756),qt=n(13020),Lt=n(56720),Ut=n(69667),Kt=n(50269),Vt=["collateralCustody","positionCustody"];function Bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ht=function(e){var t,n,s=e.positionAccount,r=e.onClose,o=(0,u.y6)().tokenPriceMap,d=(0,_.tc)(),x=d.viewClient,f=d.oraclePrices,h=d.setIsAnyFormSubmitting,v=(0,se.Z)().promptKeeperIncreaseCollateralNotification,g=s.collateralCustody,b=s.custody,j=s.side,w=s.sizeUsd,P=s.accounting,k=s.leverage,O=(0,u.Bn)(),C=O.connection,T=O.getTokenInfo,Z=(0,u.Os)().wallet,D=(0,te.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),M=D.control,F=D.handleSubmit,A=D.watch,E=D.setValue,I=D.formState,R=A("amount"),q=(0,i.useMemo)((function(){return T(g.account.mint.toString())}),[T,g.account.mint]),L=(0,i.useMemo)((function(){if(!f||!q)return[null,null];var e=f[b.account.mint.toString()],t=f[q.address];return e&&t?[e,t]:[null,null]}),[f,q,b.account.mint]),U=L[0],K=L[1],V=(0,i.useState)(q||null),z=V[0],H=V[1],W=(0,i.useState)(!1),$=W[0],Y=W[1],X=i.useCallback((function(e){Y(!1),H(e),E("amount",{formattedValue:"",value:"",floatValue:0})}),[E]),J=(0,u.FB)((null===z||void 0===z?void 0:z.address)||"").balance,Q=(0,qt.Z)({fromPairTokenInfo:z,toPairTokenInfo:q,fromPairValue:R.value}),le=Q.isLoading,oe=Q.isTokenSwapRequired,ce=Q.outAmount,de=Q.otherAmountThreshold,ue=(0,i.useMemo)((function(){var e,t,n=null===(e=o[(null===z||void 0===z?void 0:z.address)||""])||void 0===e?void 0:e.usd,i=null===(t=o[(null===q||void 0===q?void 0:q.address)||""])||void 0===t?void 0:t.usd;return n&&i?{inTokenPrice:n,outTokenPrice:i,selectedTokenRate:i/n}:{inTokenPrice:null,outTokenPrice:null,selectedTokenRate:null}}),[z,q,o]),xe=ue.inTokenPrice,pe=ue.selectedTokenRate,fe=(0,i.useMemo)((function(){if(!P||!U||!K||!z)return new m.Z(0);if(oe){if(!pe)return new m.Z(0);var e=P.fundingFeeUsd.div(1e6).gte(50)?1.01:1.005;return P.fundingFeeUsd.div(1e6).mul(e).div(xe).toDP(z.decimals)}return P.fundingFeeUsd.div(1e6).div(K).toDP(z.decimals)}),[P,K,xe,oe,z,pe,U]),he=(0,i.useMemo)((function(){return U&&K&&P&&q?w.div(_.aY).sub(P.initialCollateral).add(P.fundingFeeUsd).div(K).toDP(q.decimals):new m.Z(0)}),[P,q,K,w,U]),ve=(0,i.useMemo)((function(){if(!U||!K||!P||!q||!z)return new m.Z(0);var e=oe&&pe,t=e?he.div(1e6).mul(pe):he.div(1e6);return e?t.mul(.999).toDP(z.decimals):t.toDP(q.decimals)}),[U,K,P,q,z,oe,pe,he]),ge=(0,i.useCallback)((function(){E("amount",{formattedValue:fe.toFixed(),value:fe.toFixed(),floatValue:fe.toNumber()})}),[fe,E]),be=(0,i.useCallback)((function(){E("amount",{formattedValue:ve.toFixed(),value:ve.toFixed(),floatValue:ve.toNumber()})}),[ve,E]),je=(0,i.useMemo)((function(){if(null===Z||void 0===Z||!Z.adapter.connected)return!1;if((null===z||void 0===z?void 0:z.address)!==me.W4.toBase58())return!1;var e=new m.Z(J).minus(Lt.WO);return new m.Z(R.floatValue||0).gt(e)}),[J,R.floatValue,null===z||void 0===z?void 0:z.address,null===Z||void 0===Z?void 0:Z.adapter.connected]),we=(0,i.useMemo)((function(){return new m.Z(fe).gt(J)}),[J,fe]),ye=(0,i.useMemo)((function(){return!!R.floatValue&&new m.Z(R.floatValue).gt(J)}),[R,J]),Ne=(0,i.useMemo)((function(){if(R.floatValue){if(oe&&pe){var e=he.div(1e6).mul(pe);return new m.Z(R.floatValue).gt(e)}return R.floatValue&&he?new m.Z(R.floatValue).gt(he.div(1e6)):void 0}}),[R.floatValue,oe,he,pe]),Pe=(0,i.useMemo)((function(){if(R.floatValue&&ve)return new m.Z(R.floatValue).gt(ve)}),[R,ve]),Se=(0,i.useMemo)((function(){return k.lte(_.aY)}),[k]),ke=(0,i.useMemo)((function(){if(R.floatValue&&fe)return new m.Z(R.floatValue).lt(fe.mul(.999))}),[fe,R.floatValue]),Oe=(0,i.useMemo)((function(){var e=[];return we?(e.push(c.ag._({id:"po7HnK"})),e):(ye&&e.push(c.ag._({id:"AHhOCL"})),Ne&&e.push(c.ag._({id:"BW3PMG",values:{MINIMUM_LEVERAGE:_.aY}})),Pe&&e.push(c.ag._({id:"3Lp8oa",values:{0:null===z||void 0===z?void 0:z.symbol,allowedMaxAmount:ve}})),ke&&e.push(c.ag._({id:"WH0tTw",values:{0:N.uf.format(fe),1:null===z||void 0===z?void 0:z.symbol}})),je&&e.push(c.ag._({id:"p6yX1j",values:{MINIMUM_SOL_BALANCE:Lt.WO}})),e)}),[ve,ye,ke,Ne,fe,we,Pe,je,null===z||void 0===z?void 0:z.symbol]),_e=(0,i.useMemo)((function(){return we||ye||I.isSubmitting||Pe||ve.lte(0)||Oe.length>0||Se||ke}),[we,ye,I.isSubmitting,Pe,ve,Oe.length,Se,ke]),Ce=(0,i.useState)(null),Te=Ce[0],Ze=Ce[1];(0,i.useEffect)((function(){!z&&q&&H(q)}),[q,z]),(0,i.useEffect)((function(){(0,l.Z)(a().mark((function e(){var t,n,i,r,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&R.floatValue&&q&&x&&!(Oe.length>0)&&U){e.next=3;break}return Ze(null),e.abrupt("return");case 3:if(!oe||!le){e.next=5;break}return e.abrupt("return");case 5:if(!new m.Z(R.floatValue).gt(ve)){e.next=7;break}return e.abrupt("return");case 7:return n=z&&de?new(Nt())(de.toString()):new(Nt())((0,p.ks)(R.floatValue,q.decimals)),e.next=10,x.getIncreasePosition({collateral:n,sizeUsdDelta:new(Nt())(0),side:j,custody:b,positionAccount:s,collateralCustody:g,collateralTokenPrice:K.toNumber(),pool:s.pool,tokenPrice:U.toNumber()});case 10:if(t=e.sent){e.next=13;break}return e.abrupt("return");case 13:i=new m.Z(t.liquidationPrice.toString()),r=new m.Z(t.collateralUsd.toString()),l=function(){var e=new m.Z(t.collateralUsd.toString()).minus(P.initialCollateral.toString()).div(1e6);return new m.Z(P.positionValue.toString()).add(e)}(),Ze({liquidationPrice:new m.Z(i.toString()).div(1e6),collateralUsd:r.div(1e6),leverage:new m.Z(w).div(r).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(0),transferAmountUsd:new m.Z(0),fundingFeeUsd:m.Z.max(0,new m.Z(P.fundingFeeUsd).minus(new m.Z(n.toString()).div(Math.pow(10,q.decimals)).mul(1e6).mul(U))),positionValue:l});case 17:case"end":return e.stop()}}),e)})))()}),[R,x,q,ve,Oe,z,de,oe,ce,le,s,g.account,b.account,P,j,w,b,g,U,K]);var Fe=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var t,n,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z&&q&&z&&R.floatValue){e.next=2;break}return e.abrupt("return");case 2:return h(!0),t={side:j,collateralCustody:g,positionCustody:b,inputMint:new re.PublicKey(z.address),priceSlippage:new(Nt())(0),collateralTokenDelta:new(Nt())((0,p.ks)(Number(R.floatValue),z.decimals)),sizeUsdDelta:new(Nt())(0),jupiterMinimumOut:oe&&de?new(Nt())(de.toString()):null},e.prev=4,e.next=7,(0,Rt.w)(zt({wallet:Z,connection:C},t));case 7:return n=e.sent,i=n.instructions,o=n.positionRequestKey,e.next=12,new Promise(function(){var e=(0,l.Z)(a().mark((function e(n,l){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(i,o,(function(e){r(),n(e)}),(function(e){l(e)}),function(){var e=t.collateralCustody,n=t.positionCustody,i=(0,ee.Z)(t,Vt);return zt({wallet:Z.adapter.name,position:s.publicKey.toString(),collateralCustody:e.publicKey.toString(),positionCustody:n.publicKey.toString()},(0,De.w_)(i))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t0=e.catch(4),console.log("Failed to adjust collateral!",e.t0);case 18:return e.prev=18,h(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[4,15,18,21]])}))),[g,q,C,b,R.floatValue,oe,r,de,s.publicKey,v,z,h,j,Z]),Ae=(0,u.gZ)().userAccounts,Ee=(0,i.useMemo)((function(){return[me.W4.toString()].concat((0,ae.Z)(Array.from(Ae.reduce((function(e,t){return t.info.amount.gtn(0)?e.add(t.info.mint.toString()):e}),new Set))))}),[Ae]);return(0,S.jsxs)(S.Fragment,{children:[$?(0,S.jsx)("div",{className:"absolute left-0 top-0 z-50 h-full w-full",children:(0,S.jsx)(_t.ZP,{onSubmit:X,onClose:function(){return Y(!1)},mintsList:Ee,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,S.jsxs)("div",{className:"mt-5 px-6",children:[(0,S.jsxs)("div",{className:"flex w-full justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"IIqI4f"})}),(0,S.jsx)(Me,{changePct:null===(t=s.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=s.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,S.jsx)("div",{className:"text-md mt-2 cursor-not-allowed rounded-lg bg-v2-perps-input px-4 py-3.5 text-right font-semibold opacity-70",children:(0,S.jsxs)("div",{children:[N.uf.format(null===P||void 0===P?void 0:P.positionValue.div(1e6),2)," USD"]})}),(0,S.jsxs)("div",{className:"mt-5",children:[(0,S.jsx)("div",{className:"flex items-end leading-none",children:(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"dgih6K"})})}),(0,S.jsxs)("div",{className:"mt-2 flex justify-between",children:[(0,S.jsx)("div",{className:"cursor-pointer text-xs text-v2-lily/[.25] hover:text-v2-lily",onClick:ge,children:fe.lte(0)?"":c.ag._({id:"4Ia2Pk",values:{0:N.uf.format(fe),1:null===z||void 0===z?void 0:z.symbol}})}),(0,S.jsx)("div",{className:"cursor-pointer text-xs text-v2-lily/[.25] hover:text-v2-lily",onClick:be,children:c.ag._({id:"E7IO4T",values:{0:N.uf.format(ve),1:null===z||void 0===z?void 0:z.symbol}})})]}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"amount",control:M,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsxs)("div",{className:"text-md flex w-full items-center justify-between",children:[(0,S.jsxs)("div",{className:(0,y.cn)("flex items-center rounded-lg bg-white/10 px-2 py-1.5","cursor-pointer hover:bg-black/10"),onClick:function(){return Y(!0)},children:[z?(0,S.jsx)(G.Z,{info:z,width:28,height:28}):null,(0,S.jsx)("span",{className:"ml-3",children:null===z||void 0===z?void 0:z.symbol}),(0,S.jsx)("div",{className:"ml-4 fill-current text-white/50",children:(0,S.jsx)(Ut.Z,{})})]}),(0,S.jsx)("div",{className:"flex flex-col",children:z?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ie.Z,{decimals:z.decimals,onChange:n,value:i.value,className:"!text-xl !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00"}),(0,S.jsx)("div",{className:(0,y.cn)("text-xs font-normal text-v2-lily/[.25]"),children:(0,S.jsx)(kt.default,{tokenInfo:z,amount:i.floatValue})})]}):null})]})}})})]}),Se?(0,S.jsx)("span",{className:"my-2 text-xs text-v2-lily/50",children:c.ag._({id:"uha+4q"})}):(0,S.jsxs)("div",{className:"mt-2 flex items-end whitespace-nowrap text-xs leading-none text-v2-lily/[.25]",children:[(0,S.jsx)(It.Z,{width:14,height:14}),(0,S.jsxs)("span",{className:"ml-1",children:[N.uf.format(new m.Z(J))," ",null===z||void 0===z?void 0:z.symbol]})]}),Oe.length>0?Oe.map((function(e,t){return(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:e},t)})):null,(0,S.jsx)("div",{className:"my-4 border-b border-v2-lily/5"}),(0,S.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"Ke6k18"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:[k.toFixed(2),"x"]}),(0,S.jsx)("span",{children:Te?(0,S.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),Te.leverage.toFixed(2),"x"]}):""})]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"UBqsmP"})}),Te?(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]}),Te.liquidationPrice?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.liquidationPrice,2)]})]}):null]}):(0,S.jsxs)("div",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"62Xcjh"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.initialCollateral.div(1e6),2)]}),Te?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.collateralUsd,2)]})]}):null]})]}),(0,S.jsxs)("div",{className:"flex justify-between fill-current text-xs text-white/50",children:[(0,S.jsx)(B.Z,{content:c.ag._({id:"bBHGID"}),children:(0,S.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,S.jsx)("span",{children:c.ag._({id:"vvSf/c"})}),(0,S.jsx)(Kt.Z,{width:14,height:14})]})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(null===P||void 0===P?void 0:P.fundingFeeUsd.div(1e6),2)]}),Te?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(Te.fundingFeeUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,S.jsxs)("div",{className:"flex w-full space-x-3 p-6 text-xs",children:[I.isSubmitting?null:(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-v2-lily/10 bg-v2-lily/5 px-6 py-2.5 text-sm font-semibold text-v2-lily hover:bg-v2-lily/10 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":I.isSubmitting}),disabled:I.isSubmitting,onClick:r,children:(0,S.jsx)("span",{children:c.ag._({id:"dEgA5A"})})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-labs/20 px-6 py-2.5 text-sm font-semibold text-labs hover:bg-labs/5 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":I.isSubmitting||_e}),disabled:_e,onClick:F(Fe),children:I.isSubmitting?(0,S.jsxs)("span",{className:"flex items-center justify-center",children:[(0,S.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,S.jsx)("div",{className:"mr-2"}),c.ag._({id:"dEgdV4"})]}):(0,S.jsx)("span",{children:c.ag._({id:"kj3M8S"})})})]})]})},Wt=n(70006),$t=["position"];function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xt=function(e){var t,n,s,r,o,d,x=e.positionAccount,p=e.onClose,f=(0,_.tc)(),h=f.viewClient,v=f.oraclePrices,g=f.slippage,b=f.poolInfo,j=f.refreshPositionInfo,w=f.setIsAnyFormSubmitting,P=(0,se.Z)().promptKeeperPartialClosePositionNotification,k=(0,u.Bn)(),O=k.connection,C=k.getTokenInfo,T=k.tokens,Z=(0,u.Os)().wallet,D=(0,Wt.JT)().closeModal,M=x.custody,F=x.collateralCustody,A=(0,te.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),E=A.control,I=A.handleSubmit,R=A.watch,q=A.setValue,L=A.formState,U=R("amount"),K=(0,i.useMemo)((function(){return C(F.account.mint.toString())}),[C,F.account.mint]),V=(0,i.useMemo)((function(){return K?(0,_.A5)(K.address):null}),[K]),B=(0,i.useMemo)((function(){return v&&K?[v[M.account.mint.toString()],v[K.address]]:[null,null]}),[v,M.account.mint,K]),z=B[0],H=B[1],W=(0,i.useState)(K||null),$=W[0],Y=W[1],X=(0,i.useState)(!1),J=X[0],Q=X[1],le=i.useCallback((function(e){Q(!1),Y(e)}),[]),oe=(0,u.FB)((null===$||void 0===$?void 0:$.address)||"").balance,ae=(0,i.useMemo)((function(){return z&&H&&x.accounting&&V?function(){var e=m.Z.max(new m.Z(x.sizeUsd).div(V),_.IH);if("long"===x.side){var t=new m.Z(x.accounting.initialCollateral).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(x.accounting.pnlAfterFeesUsd)),new m.Z(t)}var n=new m.Z(x.accounting.initialCollateral).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(n=n.add(x.accounting.pnlAfterFeesUsd)),new m.Z(n)}().div(1e6).toDP(4,m.Z.ROUND_DOWN):new m.Z(0)}),[H,V,x.accounting,x.side,x.sizeUsd,z]),ce=(0,i.useCallback)((function(){q("amount",{formattedValue:ae.toString(),value:ae.toString(),floatValue:ae.toNumber()})}),[ae,q]),de=(0,i.useMemo)((function(){if(U.floatValue&&ae)return new m.Z(U.floatValue).gt(ae)}),[U,ae]),ue=(0,i.useMemo)((function(){if(!U.floatValue||!x.accounting)return!1;var e=new m.Z(x.accounting.fundingFeeUsd.toString()).div(1e6),t=new m.Z(x.accounting.initialCollateral).sub(U.floatValue).sub(e);return x.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(x.accounting.pnlAfterFeesUsd)),t.lt(_.IH)}),[U.floatValue,x.accounting]),xe=(0,i.useMemo)((function(){var e=[];return ae.lt(0)&&e.push(c.ag._({id:"x2k4t8"})),ue&&e.push(c.ag._({id:"hd8pGY",values:{MINIMUM_COLLATERAL_SIZE_USD:_.IH}})),de&&e.push(c.ag._({id:"uueVdm"})),e}),[de,ue,ae]),pe=(0,i.useMemo)((function(){return L.isSubmitting||de||ae.lte(0)||xe.length>0}),[L.isSubmitting,de,ae,xe]),fe=(0,i.useState)(null),me=fe[0],he=fe[1];(0,i.useEffect)((function(){!$&&K&&Y(K)}),[K,me,null===me||void 0===me?void 0:me.transferAmountUsd,null===me||void 0===me?void 0:me.transferToken,$]);var ve=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===K||void 0===K?void 0:K.address)!==(null===$||void 0===$?void 0:$.address),amount:$&&K&&me?St().BigInt(me.transferToken.mul(Math.pow(10,K.decimals)).toFixed()):St().BigInt(0),fromTokenInfo:K}}),[K,me,$]),ge=(0,Ct.Z)({disabled:!ve.isTokenSwapRequired,amount:ve.amount,fromTokenInfo:ve.fromTokenInfo,toTokenInfo:$,slippage:g}),be=ge.outAmount,je=ge.otherAmountThreshold,we=(0,i.useMemo)((function(){if($&&me)return ve.isTokenSwapRequired&&be?{floatValue:new m.Z(be.toString()||0).div(Math.pow(10,$.decimals)).toNumber(),formattedValue:new m.Z(be.toString()||0).div(Math.pow(10,$.decimals)).toFixed(),value:new m.Z(be.toString()||0).div(Math.pow(10,$.decimals)).toFixed()}:{floatValue:me.transferToken.toNumber(),formattedValue:me.transferToken.toFixed(),value:me.transferToken.toFixed()}}),[me,be,$,ve.isTokenSwapRequired]);(0,i.useEffect)((function(){(0,l.Z)(a().mark((function e(){var t,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U.floatValue&&K&&h&&x.accounting&&!(xe.length>0)&&z&&H&&null!==b&&void 0!==b&&b.pool){e.next=3;break}return he(null),e.abrupt("return");case 3:if(!new m.Z(U.floatValue).gt(ae)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,h.getDecreasePosition({position:x,collateralUsdDelta:new(Nt())(new m.Z(U.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(Nt())(0),tokenPrice:null===z||void 0===z?void 0:z.toNumber(),collateralTokenPrice:null===H||void 0===H?void 0:H.toNumber(),pool:b.pool});case 7:if(t=e.sent){e.next=10;break}return e.abrupt("return");case 10:n=new m.Z(t.liquidationPrice.toString()),i=new m.Z(t.collateralUsd.toString()),s=function(){var e,n=new m.Z(t.collateralUsd.toString()).minus(null===(e=x.accounting)||void 0===e?void 0:e.initialCollateral).div(1e6);return new m.Z(x.accounting.positionValue.toString()).add(n)}(),he({liquidationPrice:n,collateralUsd:i,fees:new m.Z(t.feeUsd.toString()),leverage:new m.Z(x.sizeUsd.toString()).div(i).toNearest(.01,m.Z.ROUND_DOWN),transferToken:new m.Z(t.transferToken.toString()).div(Math.pow(10,K.decimals)),transferAmountUsd:new m.Z(t.transferAmountUsd.toString()),positionValue:s});case 14:case"end":return e.stop()}}),e)})))()}),[U,x,h,K,ae,xe,z,H,null===b||void 0===b?void 0:b.pool]);var ye=(0,i.useCallback)((0,l.Z)(a().mark((function e(){var t,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h&&Z&&Z.adapter.publicKey&&h&&K&&U.floatValue){e.next=2;break}return e.abrupt("return");case 2:return w(!0),t={position:x,collateralUsdDelta:new(Nt())(new m.Z(U.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(Nt())(0),desiredMint:ve.isTokenSwapRequired&&$?new re.PublicKey($.address):x.collateralCustody.account.mint,priceSlippage:new(Nt())(0),jupiterMinimumOut:ve.isTokenSwapRequired&&je?new(Nt())(je.toString()):null},e.prev=4,e.next=7,Pe(Yt({wallet:Z,connection:O},t));case 7:return n=e.sent,i=n.instructions,s=n.positionRequestKey,D(),e.next=13,new Promise(function(){var e=(0,l.Z)(a().mark((function e(n,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(i,s,(function(e){p(),n(e),j()}),(function(e){r(e)}),function(){t.position;var e=(0,ee.Z)(t,$t);return Yt({wallet:Z.adapter.name,position:x.publicKey.toString()},(0,De.w_)(e))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 13:return e.abrupt("return",e.sent);case 16:e.prev=16,e.t0=e.catch(4),console.log("Failed to adjust collateral!",e.t0);case 19:return e.prev=19,w(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[4,16,19,22]])}))),[D,K,O,U.floatValue,p,je,x,P,$,j,w,ve.isTokenSwapRequired,h,Z]),Ne=(0,i.useMemo)((function(){return Array.from(T.map((function(e){return e.address})))}),[T]);return(0,S.jsxs)(S.Fragment,{children:[J?(0,S.jsx)("div",{className:"absolute left-0 top-0 z-50 h-full w-full",children:(0,S.jsx)(_t.ZP,{onSubmit:le,onClose:function(){return Q(!1)},mintsList:Ne,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,S.jsxs)("div",{className:"mt-5 px-6",children:[(0,S.jsxs)("div",{className:"flex w-full justify-between text-xs",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"IIqI4f"})}),(0,S.jsx)(Me,{changePct:null===(t=x.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=x.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,S.jsx)("div",{className:"text-md mt-2 cursor-not-allowed rounded-lg bg-v2-perps-input px-4 py-3.5 text-right font-semibold opacity-70",children:(0,S.jsxs)("div",{children:[null===(s=x.accounting)||void 0===s?void 0:s.positionValue.div(1e6).toFixed(2)," USD"]})}),(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"Jj+X2y"})}),(0,S.jsx)("div",{className:"cursor-pointer text-xs text-v2-lily/[.25] hover:text-v2-lily",onClick:ce,children:ae.lte(0)?"":c.ag._({id:"z1pdOO",values:{allowedMaxAmount:ae}})})]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"amount",control:E,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsxs)("div",{className:"text-md flex w-full items-center justify-between",children:[(0,S.jsxs)("div",{className:"flex items-center rounded-lg py-1.5 pl-2",children:[$?(0,S.jsx)(G.Z,{info:$,width:28,height:28}):null,(0,S.jsx)("span",{className:"ml-3 text-sm font-semibold",children:null===$||void 0===$?void 0:$.symbol})]}),(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)(ie.Z,{disabled:ae.lte(0),decimals:6,onChange:n,value:i.value,className:"!text-xl !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00",suffix:" USD"}),$&&(0,S.jsx)(ie.Z,{className:"!text-xs !font-normal !text-v2-lily/[.25] disabled:!text-white",disabled:!0,decimals:$.decimals,value:null===we||void 0===we?void 0:we.value,suffix:" "+$.symbol})]})]})}})}),(0,S.jsxs)("div",{className:"mt-2 flex items-end whitespace-nowrap text-xs leading-none text-v2-lily/[.25]",children:[(0,S.jsx)(It.Z,{width:14,height:14}),(0,S.jsxs)("span",{className:"ml-1",children:[oe," ",null===$||void 0===$?void 0:$.symbol]})]}),xe.length>0?xe.map((function(e,t){return(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:e},t)})):null,(0,S.jsx)("div",{className:"my-4 border-b border-v2-lily/5"}),(0,S.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"Ke6k18"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:[x.leverage.toFixed(2),"x"]}),(0,S.jsx)("span",{children:me?(0,S.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),me.leverage.toFixed(2),"x"]}):""})]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"Rb1yph"})}),me?(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(null===(o=x.accounting)||void 0===o?void 0:o.liquidationPrice.div(1e6),2)]}),me.liquidationPrice?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(me.liquidationPrice.div(1e6),2)]})]}):null]}):(0,S.jsxs)("div",{children:["$",N.uf.format(null===(r=x.accounting)||void 0===r?void 0:r.liquidationPrice.div(1e6),2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,S.jsx)("span",{children:c.ag._({id:"62Xcjh"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:["$",N.uf.format(null===(d=x.accounting)||void 0===d?void 0:d.initialCollateral.div(1e6),2)]}),me?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(me.collateralUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,S.jsxs)("div",{className:"flex w-full space-x-3 p-6 text-xs",children:[L.isSubmitting?null:(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-v2-lily/10 bg-v2-lily/5 px-6 py-2.5 text-sm font-semibold text-v2-lily hover:bg-v2-lily/10 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":L.isSubmitting}),disabled:L.isSubmitting,onClick:p,children:(0,S.jsx)("span",{children:c.ag._({id:"dEgA5A"})})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-labs/20 px-6 py-2.5 text-sm font-semibold text-labs hover:bg-labs/5 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":L.isSubmitting||pe}),disabled:pe,onClick:I(ye),children:L.isSubmitting?(0,S.jsxs)("span",{className:"flex items-center justify-center",children:[(0,S.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,S.jsx)("div",{className:"mr-2"}),c.ag._({id:"e8OI2g"})]}):(0,S.jsx)("span",{children:c.ag._({id:"OsyKSt"})})})]})]})},Jt=function(e){var t=e.positionAccount,n=(0,u.Bn)().getTokenInfo,s=(0,C.y)(),r=s.isEditCollateralDialogOpen,l=s.dismissEditCollateralDialog,o=(0,_.tc)(),a=o.oraclePrices,d=o.isAnyFormSubmitting,x=(0,i.useMemo)((function(){var e;return null!==(e=n(t.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[n,t.custody.account.mint]),p=(0,i.useState)("deposit"),f=p[0],m=p[1],h=(0,i.useMemo)((function(){return a&&a[x.address]}),[a,x.address]);return(0,S.jsx)(le.Z,{open:r,onClose:l,children:(0,S.jsxs)("form",{className:"relative w-full rounded-lg bg-v2-perps-modal lg:max-w-[400px]",children:[(0,S.jsx)("div",{className:"mb-2 p-4 font-semibold leading-none text-v2-lily lg:mb-0 lg:p-6 lg:text-lg",children:c.ag._({id:"3AUpAD"})}),(0,S.jsx)("button",{type:"button",disabled:d,className:"absolute right-8 top-5 z-10 flex cursor-pointer fill-current text-v2-lily/[.25] disabled:cursor-not-allowed disabled:opacity-50 lg:top-8",onClick:l,children:(0,S.jsx)(oe.Z,{width:12,height:12})}),(0,S.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,S.jsx)("div",{className:"px-6",children:(0,S.jsxs)("div",{className:"rounded-lg border border-v2-lily/[.15] bg-v2-lily/5 p-5",children:[(0,S.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(G.Z,{info:x,width:24,height:24}),(0,S.jsx)(q.cC,{id:"14o+cp",values:{0:x.symbol},components:{0:(0,S.jsx)("span",{})}})]}),(0,S.jsxs)("span",{className:"text-sm font-semibold",children:[N.uf.format(h||void 0,2)," USD"]})]}),(0,S.jsx)("div",{className:"my-4 border-b border-v2-lily/5"}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"oeP0s2"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(t.sizeUsd.div(1e6),2)]})]})]})}),(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"flex h-[56px] flex-row items-center justify-between space-x-4 border-b border-b-white/5 px-4",children:(0,S.jsxs)("div",{className:"flex w-full flex-row",children:[(0,S.jsx)("button",{type:"button",onClick:function(){return m("deposit")},className:(0,y.cn)("flex flex-row items-center justify-center px-3 pb-4 pt-6 font-semibold !outline-none","deposit"===f?"border-b border-b-labs text-labs":""),children:(0,S.jsx)("span",{className:"text-sm",children:c.ag._({id:"kj3M8S"})})}),(0,S.jsx)("button",{type:"button",onClick:function(){return m("withdraw")},className:(0,y.cn)("flex flex-row items-center justify-center px-3 pb-4 pt-6 font-semibold !outline-none","withdraw"===f?"border-b border-b-labs text-labs":""),children:(0,S.jsx)("span",{className:"text-sm",children:c.ag._({id:"OsyKSt"})})})]})}),"deposit"===f?(0,S.jsx)(Ht,{positionAccount:t,onClose:l}):(0,S.jsx)(Xt,{positionAccount:t,onClose:l})]})]})]})})},Qt=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().editCollateralDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,S.jsx)(Jt,{positionAccount:n}):null},en=["wallet","connection","positionAccount","custody","updateTPPrice","updateSLPrice","cancelTP","cancelSL"];function tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sn(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var rn=function(e){var t,n,s,r,o,d,x=e.positionAccount,p=(0,_.tc)(),f=p.viewClient,h=p.oraclePrices,v=p.setIsAnyFormSubmitting,g=p.isAnyFormSubmitting,b=(0,C.y)(),j=b.isEditTPSLDialogOpen,P=b.editTPSLDialogData,k=b.dismissEditTPSLDialog,T=(0,u.Bn)(),Z=T.connection,D=T.getTokenInfo,M=T.tokenMap,F=(0,u.Os)().wallet,A=(0,se.Z)().promptKeeperCreateTPSLNotification,E=(0,i.useMemo)((function(){var e;return null!==(e=D(x.custody.account.mint.toString()))&&void 0!==e?e:O.mq}),[D,x.custody.account.mint]),I=(0,i.useMemo)((function(){return D(x.collateralCustody.account.mint.toString())}),[D,x.collateralCustody.account.mint]),R=Ae(x),L=R.hasTp,U=R.hasSl,K=(0,te.cI)({defaultValues:{tpPrice:sn(L),slPrice:sn(U)}}),V=K.control,B=K.handleSubmit,z=K.watch,H=K.setValue,W=K.formState,$=z("tpPrice"),Y=z("slPrice"),X=Ee({positionAccount:x,tpPrice:$,slPrice:Y}),J=X.showTPChanged,Q=X.showTPRemoved,ae=X.showSLChanged,ce=X.showSLRemoved,de=X.minimumTPPrice,ue=X.minimumSLPrice,xe=X.maximumSLPrice,pe=X.isWithinTPRange,fe=X.isWithinSLRange,me=X.expectedPositionValueAtSL,he=X.expectedPositionValueAtTP,ve=(0,i.useState)(null),ge=ve[0],be=ve[1],je=(0,i.useMemo)((function(){var e=x.takeProfitPositionRequest||x.stopLossPositionRequest;if(e)return e}),[x.stopLossPositionRequest,x.takeProfitPositionRequest]);(0,i.useEffect)((function(){je&&be(M.get(je.account.mint.toString())||null),!ge&&I&&be(I)}),[I,je,ge,M]);var we=(0,i.useState)(!1),ye=we[0],Ne=we[1],Pe=i.useCallback((function(e){Ne(!1),be(e)}),[]),Se=(0,i.useMemo)((function(){return Array.from(M.keys())}),[M]),ke=(0,i.useMemo)((function(){return h&&h[E.address]?h[E.address]:null}),[h,E.address]),Oe=(0,i.useMemo)((function(){return!W.isDirty||(!(!$.floatValue||pe)||(!(!Y.floatValue||fe)||W.isSubmitting))}),[W.isDirty,W.isSubmitting,fe,pe,Y.floatValue,$.floatValue]),_e=(0,i.useCallback)(function(){var e=(0,l.Z)(a().mark((function e(t){var n,i,s,r,o,d,u,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Oe&&F&&F.adapter.publicKey&&E&&f&&ke&&ge){e.next=2;break}return e.abrupt("return");case 2:return v(!0),n=t.tpPrice.floatValue?new(Nt())(new m.Z(t.tpPrice.floatValue).mul(1e6).round().toFixed()):null,i=t.slPrice.floatValue?new(Nt())(new m.Z(t.slPrice.floatValue).mul(1e6).round().toFixed()):null,s=J&&x.takeProfitPositionRequest&&n?{triggerPrice:n,positionRequestAccount:x.takeProfitPositionRequest.publicKey}:null,r=ae&&x.stopLossPositionRequest&&i?{triggerPrice:i,positionRequestAccount:x.stopLossPositionRequest.publicKey}:null,o=Q&&x.takeProfitPositionRequest?{positionPubkey:x.publicKey,positionRequestPubkey:x.takeProfitPositionRequest.publicKey,positionRequestMint:x.takeProfitPositionRequest.account.mint}:null,d=ce&&x.stopLossPositionRequest?{positionPubkey:x.publicKey,positionRequestPubkey:x.stopLossPositionRequest.publicKey,positionRequestMint:x.stopLossPositionRequest.account.mint}:null,u={wallet:F,connection:Z,positionAccount:x,custody:x.custody.account,desiredMint:new re.PublicKey(ge.address),tpPrice:L?null:n,slPrice:U?null:i,updateTPPrice:s,updateSLPrice:r,cancelTP:o,cancelSL:d},e.prev=10,e.next=13,Te(u);case 13:return p=e.sent,e.next=16,new Promise(function(){var e=(0,l.Z)(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({doveInstructions:p},(function(e){k(),t(e)}),(function(e){n(e)}),c.ag._({id:"rEZulJ"}),function(){var e=u.wallet,t=(u.connection,u.positionAccount),n=(u.custody,u.updateTPPrice),i=u.updateSLPrice,s=(u.cancelTP,u.cancelSL,(0,ee.Z)(u,en));return nn({wallet:e.adapter.name,positionAccount:t.publicKey.toString(),updateTPPrice:(null===n||void 0===n?void 0:n.triggerPrice.toString())||"",updateTPPricePositionRequestAccount:(null===n||void 0===n?void 0:n.positionRequestAccount.toString())||"",updateSLPrice:(null===i||void 0===i?void 0:i.triggerPrice.toString())||"",updateSLPricePositionRequestAccount:(null===i||void 0===i?void 0:i.positionRequestAccount.toString())||""},(0,De.w_)(s))}());case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 16:return e.abrupt("return",e.sent);case 19:e.prev=19,e.t0=e.catch(10),console.log("Failed to submit TPSL!",e.t0);case 22:return e.prev=22,v(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[10,19,22,25]])})));return function(t){return e.apply(this,arguments)}}(),[Z,k,U,L,Oe,ke,x,A,ge,v,ae,ce,J,Q,E,f,F]),Ce=(0,i.useMemo)((function(){return[]}),[]),Ze=(0,i.useCallback)((function(){de&&H("tpPrice",{floatValue:de.toNumber(),formattedValue:de.toFixed(2),value:de.toFixed(2)})}),[de,H]),Fe=(0,i.useCallback)((function(){ue&&H("slPrice",{floatValue:ue.toNumber(),formattedValue:ue.toFixed(2),value:ue.toFixed(2)})}),[ue,H]),Ie=(0,i.useCallback)((function(){xe&&H("slPrice",{floatValue:xe.toNumber(),formattedValue:xe.toFixed(2),value:xe.toFixed(2)})}),[xe,H]),Re=(0,i.useRef)(),qe=(0,i.useRef)();return(0,i.useEffect)((function(){var e,t;"tp"===(null===P||void 0===P?void 0:P.focusOn)&&(null===(e=Re.current)||void 0===e||e.focus()),"sl"===(null===P||void 0===P?void 0:P.focusOn)&&(null===(t=qe.current)||void 0===t||t.focus())}),[null===P||void 0===P?void 0:P.focusOn]),(0,S.jsx)(le.Z,{open:j,onClose:k,children:(0,S.jsxs)("form",{className:"relative w-full rounded-lg bg-v2-perps-modal lg:max-w-[400px]",children:[(0,S.jsx)("div",{className:"mb-2 p-4 font-semibold leading-none text-v2-lily lg:mb-0 lg:p-6 lg:text-lg",children:c.ag._({id:"sFwiST"})}),(0,S.jsx)("button",{type:"button",disabled:g,className:"absolute right-8 top-5 z-10 flex cursor-pointer fill-current text-v2-lily/[.25] disabled:cursor-not-allowed disabled:opacity-50 lg:top-8",onClick:k,children:(0,S.jsx)(oe.Z,{width:12,height:12})}),ye?(0,S.jsx)("div",{className:"absolute left-0 top-0 z-50 h-full w-full",children:(0,S.jsx)(_t.ZP,{onSubmit:Pe,onClose:function(){return Ne(!1)},mintsList:Se,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,S.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,S.jsxs)("div",{className:"px-6",children:[(0,S.jsxs)("div",{className:"rounded-lg border border-v2-lily/[.15] bg-v2-lily/5 p-5",children:[(0,S.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(G.Z,{info:E,width:24,height:24}),(0,S.jsx)("span",{children:(0,S.jsx)(q.cC,{id:"RRqX8x"})})]}),ke?(0,S.jsxs)("span",{className:"text-sm font-semibold",children:[N.uf.format(ke,2)," USD"]}):(0,S.jsx)(w.O,{className:"h-6 w-20"})]}),(0,S.jsx)("div",{className:"my-4 border-b border-v2-lily/5"}),(0,S.jsxs)("div",{className:"space-y-2",children:[(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"oeP0s2"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(x.sizeUsd.div(1e6),2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"shmNel"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(x.price.div(1e6),2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"pYW6HQ"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(null===(t=x.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6),2)]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"Ke6k18"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:[N.uf.format(x.leverage,2),"x"]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"6nrP+I"})}),x.accounting?(0,S.jsx)(Me,{changePct:x.accounting.unrealizedPNLPct,pnl:x.accounting.unrealizedPNL}):null]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"BxsfMK"})}),(0,S.jsxs)("span",{className:"text-white/[.75]",children:["$",N.uf.format(null===(n=x.accounting)||void 0===n?void 0:n.totalFeeUsd.div(1e6))]})]}),(0,S.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,S.jsx)("span",{className:"text-white/40",children:c.ag._({id:"XokASO"})}),(0,S.jsx)("span",{className:"text-white/[.75]",children:(0,S.jsx)(Me,{changePct:null===(s=x.accounting)||void 0===s?void 0:s.pnlAfterFeesPct,pnl:null===(r=x.accounting)||void 0===r?void 0:r.pnlAfterFeesUsd})})]})]})]}),(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"x4Tc7V"})}),he?(0,S.jsx)("div",{className:"text-xs text-v2-lily/[.25] hover:text-v2-lily",children:(0,S.jsx)(Me,{changePct:he.pnlRate,pnl:he.pnl})}):null]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"tpPrice",control:V,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsx)(ie.Z,{ref:Re,decimals:2,max:O.wN,onChange:n,value:i.value,className:"w-full !text-right !text-sm !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00",suffix:" USD"})}})}),(0,S.jsxs)("div",{className:"mt-1 space-y-1",children:[he?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"2Ycl/Z",values:{0:he.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})}})}):null,J?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"xWu5xB",values:{0:null===(o=$.floatValue)||void 0===o?void 0:o.toLocaleString(void 0,{compactDisplay:"short"}),hasTp:L}})}):null,Q?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"x0azeV",values:{hasTp:L}})}):null]}),$.floatValue&&!pe&&de?(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:(0,S.jsx)(q.cC,{id:"e85VRy",values:{0:null===de||void 0===de?void 0:de.toFixed(2)},components:{0:(0,S.jsx)("span",{}),1:(0,S.jsx)("button",{type:"button",onClick:Ze,className:"ml-1 cursor-pointer underline decoration-dashed underline-offset-[3px]"}),2:(0,S.jsx)("span",{})}})}):null,(0,S.jsx)("div",{className:"mt-5",children:(0,S.jsxs)("div",{className:"flex items-end justify-between leading-none",children:[(0,S.jsx)("div",{className:"text-sm font-semibold text-v2-lily",children:c.ag._({id:"qTADju"})}),me?(0,S.jsx)("div",{className:"text-xs text-v2-lily/[.25] hover:text-v2-lily",children:(0,S.jsx)(Me,{changePct:me.pnlRate,pnl:me.pnl})}):null]})}),(0,S.jsx)("div",{className:"text-md mt-2 rounded-lg bg-v2-perps-input py-3.5 pl-2 pr-4 text-right",children:(0,S.jsx)(te.Qr,{name:"slPrice",control:V,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,S.jsx)(ie.Z,{ref:qe,decimals:2,max:O.wN,onChange:n,value:i.value,className:"w-full !text-right !text-sm !outline-none disabled:cursor-not-allowed disabled:!text-white",placeholder:"0.00",suffix:" USD"})}})}),(0,S.jsxs)("div",{className:"mt-1 space-y-1",children:[me?(0,S.jsx)("span",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"2Ycl/Z",values:{0:me.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})}})}):null,ae?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"t+q5hH",values:{0:null===(d=Y.floatValue)||void 0===d?void 0:d.toLocaleString(void 0,{compactDisplay:"short"}),hasSl:U}})}):null,ce?(0,S.jsx)("p",{className:"text-xs text-v2-lily/30",children:c.ag._({id:"Sbg0qf",values:{hasSl:U}})}):null]}),Y.floatValue&&!fe&&ue&&xe?(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:(0,S.jsx)(q.cC,{id:"zEcgkg",values:{0:N.uf.format(ue,2),1:N.uf.format(xe,2)},components:{0:(0,S.jsx)("span",{}),1:(0,S.jsx)("button",{type:"button",onClick:Fe,className:"mx-1 cursor-pointer underline decoration-dashed underline-offset-[3px]"}),2:(0,S.jsx)("span",{}),3:(0,S.jsx)("button",{type:"button",onClick:Ie,className:"ml-1 cursor-pointer underline decoration-dashed underline-offset-[3px]"}),4:(0,S.jsx)("span",{})}})}):null,Ce.length>0?Ce.map((function(e,t){return(0,S.jsx)("div",{className:"mt-2 text-xs text-warning",children:e},t)})):null,(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:"mt-5 flex items-center justify-between pr-2",children:[(0,S.jsx)("div",{className:"h-full flex-1 text-sm font-semibold first-letter:text-v2-lily",children:c.ag._({id:"cL0LQv"})}),(0,S.jsxs)("div",{className:"flex items-center rounded-lg",children:[ge?(0,S.jsx)(G.Z,{info:ge,width:28,height:28}):null,(0,S.jsx)("span",{className:"ml-3 text-sm font-semibold",children:null===ge||void 0===ge?void 0:ge.symbol})]})]})})]}),(0,S.jsx)("div",{className:"px-6",children:(0,S.jsx)("div",{className:"my-3 border-b border-v2-lily/5"})}),(0,S.jsx)("p",{className:"mb-3 mt-2 px-6 text-xs text-v2-lily/30",children:c.ag._({id:"kfhSUX"})}),(0,S.jsx)("p",{className:"mb-4 px-6 text-xs text-v2-lily/30",children:c.ag._({id:"PcsgaR",values:{0:null===I||void 0===I?void 0:I.symbol}})}),(0,S.jsxs)("div",{className:"flex w-full space-x-3 px-6 pb-6 text-xs",children:[W.isSubmitting?null:(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-v2-lily/10 bg-v2-lily/5 px-6 py-2.5 text-sm font-semibold text-v2-lily hover:bg-v2-lily/10 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":W.isSubmitting}),disabled:W.isSubmitting,onClick:k,children:(0,S.jsx)("span",{children:c.ag._({id:"dEgA5A"})})}),(0,S.jsx)("button",{type:"button",className:(0,y.cn)("w-full rounded-lg border border-labs/20 px-6 py-2.5 text-sm font-semibold text-labs hover:bg-labs/5 disabled:cursor-not-allowed disabled:opacity-20",{"curosr-not-allowed opacity-50":W.isSubmitting||Oe}),disabled:Oe,onClick:B(_e),children:W.isSubmitting?(0,S.jsxs)("span",{className:"flex items-center justify-center",children:[(0,S.jsx)(ne.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,S.jsx)("div",{className:"mr-2"}),c.ag._({id:"W7KBhK"})]}):(0,S.jsx)("span",{className:"text-center",children:c.ag._({id:"7VpPHA"})})})]})]})]})})},ln=function(){var e=(0,_.tc)().userPositions,t=(0,C.y)().editTPSLDialogData,n=(0,i.useMemo)((function(){return t&&(null===e||void 0===e?void 0:e.find((function(e){return e.publicKey.equals(t.positionAccountPubkey)})))}),[t,e]);return n?(0,S.jsx)(rn,{positionAccount:n}):null},on=n(3082),an=function(){var e=(0,u.Bn)(),t=e.getTokenInfo,n=e.getTokenInfoFromSymbol,s=(0,on.useRouter)(),r=(0,i.useMemo)((function(){return s.query.inOut?s.query.inOut:O.yM}),[s.query.inOut]),l=(0,i.useMemo)((function(){return r.split("-")}),[r]),o=l[0],a=l[1],c=(0,i.useMemo)((function(){return n(o)||t(o)||O.mq}),[o,t,n]),d=(0,i.useMemo)((function(){return n(a)||O.mq}),[a,n]),x=(0,i.useMemo)((function(){return c.name&&d.name&&s.isReady}),[s.isReady,c,d]);return{inOut:r,fromPairTokenInfo:c,toPairTokenInfo:d,isReady:x}},cn=function(){var e=(0,on.useRouter)();return(0,i.useMemo)((function(){if(e.isReady){var t=e.query.direction;if("long"!==t&&"short"!==t)return e.replace("/perps/long/SOL-SOL"),"long"}return e.query.direction}),[e])},dn=n(64508),un=n.n(dn),xn=function(){var e=(0,_.tc)().poolInfo,t=(0,i.useMemo)((function(){if(null===e||void 0===e||!e.poolApr.feeAprBps)return null;var t=new m.Z(e.poolApr.feeAprBps.toString()).div(100);return(0,z.bK)(t)}),[null===e||void 0===e?void 0:e.poolApr.feeAprBps]);return(0,S.jsx)(un(),{shallow:!0,suppressHydrationWarning:!0,href:"/perps-earn",children:(0,S.jsxs)("button",{className:"mr-2 flex space-x-1 rounded-lg border border-v2-primary/10 bg-v2-primary/10 px-4 py-2 text-right text-sm font-semibold text-v2-primary drop-shadow-sm hover:opacity-80",children:[(0,S.jsx)("span",{className:"flex lg:hidden",children:(0,S.jsx)(q.cC,{id:"7peVf8"})}),(0,S.jsx)("span",{className:"hidden lg:flex",children:(0,S.jsx)(q.cC,{id:"QIuujP"})}),t&&(0,S.jsxs)("span",{className:"hidden lg:flex",children:[t.toFixed(2),"%"]})]})})},pn=function(){return(0,S.jsxs)(un(),{shallow:!0,suppressHydrationWarning:!0,href:"/perps-leaderboard",className:"mr-2 flex items-center gap-x-2 rounded-lg border border-v2-primary/10 bg-v2-primary/10 px-4 py-2 text-right text-sm",children:[(0,S.jsx)(Xe.AO,{width:16,height:16}),(0,S.jsx)("div",{className:"hidden font-semibold text-v2-primary 2xl:block",children:(0,S.jsx)(q.cC,{id:"tHPbHS"})})]})},fn=n(92956),mn=["position"];function hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hn(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gn=function(e){var t=e.selectToPair,n=e.selected,s=(0,_.tc)(),r=s.perpsTokens,l=s.isAnyFormSubmitting,o=(0,i.useState)([]),a=o[0],c=o[1];return(0,i.useEffect)((function(){0===a.length&&c(r.nonStableTokens)}),[r.nonStableTokens,a.length]),(0,S.jsx)("div",{className:"hideScrollbar flex h-full items-center space-x-2 overflow-x-scroll border-r border-r-v2-lily/10 px-2",children:a.map((function(e,i){var s=n.address===e.address,r=l;return(0,S.jsxs)("button",{type:"button",onClick:function(){return t(e)},disabled:r,className:(0,y.cn)("h-9 lg:h-10","flex cursor-pointer items-center space-x-3 whitespace-nowrap rounded-full border border-transparent fill-current pl-1.5 pr-2 text-sm font-semibold text-white lg:border-2",{"hover:border-labs/50":!s&&!r,"cursor-not-allowed opacity-50":!s&&r,"border-labs bg-labs/10 text-labs":s}),children:[(0,S.jsx)(G.Z,{info:e,width:24,height:24}),(0,S.jsx)("span",{children:e.symbol})]},i)}))})},bn=b()((function(){return Promise.all([n.e(59411),n.e(23439)]).then(n.bind(n,23439))}),{ssr:!1,loadableGenerated:{webpack:function(){return[23439]}}}),jn=b()((function(){return Promise.resolve().then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),wn=b()((function(){return Promise.resolve().then(n.bind(n,7763)).then((function(e){return e.AdvancedTradingView}))}),{ssr:!1,loadableGenerated:{webpack:function(){return[7763]}}}),yn=b()((function(){return n.e(76959).then(n.bind(n,76959))}),{ssr:!1,loadableGenerated:{webpack:function(){return[76959]}}}),Nn=b()((function(){return Promise.all([n.e(62628),n.e(53337)]).then(n.bind(n,53337))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[53337]}}}),Pn=b()((function(){return Promise.all([n.e(62628),n.e(16647)]).then(n.bind(n,16647))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[16647]}}}),Sn=function(e){var t=e.lastPrice,n=an(),s=n.fromPairTokenInfo,r=n.toPairTokenInfo,o=(0,_.tc)().oraclePrices,d=cn(),u=(0,R.Ne)(O.yM),x=(0,i.useMemo)((function(){return o?o[r.address]:null}),[o,r.address]),h=(0,p.y_)(x),v=(0,f.a)(["ohclvData-24h",r.address,h],(0,l.Z)(a().mark((function e(){var t,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.address){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,fetch("https://worker.jup.ag/perps-tokens-stats");case 5:return t=e.sent,e.next=8,t.json();case 8:if(n=e.sent,i=n[r.address]){e.next=12;break}return e.abrupt("return",null);case 12:return e.abrupt("return",{lruPrice:i.lruPrice.toFixed(h),high24H:new m.Z(i.high24H),low24H:new m.Z(i.low24H)});case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[2,15]])}))),{refetchInterval:6e4,initialData:null}).data,g=(0,i.useMemo)((function(){if(!v||!v.lruPrice||!x)return null;var e=function(){var e=v.lruPrice;return new m.Z(x).minus(e).div(e).mul(100)}();return{color:e.gt(0)?"rgba(39, 174, 96, 1)":"rgba(255, 87, 87, 1)",text:e.toFixed(2)+"%"}}),[v,x]),b=P.SX.tradeVolume.useQuery({mint:r.address}).data,j=(0,i.useMemo)((function(){return null!==t&&void 0!==t?t:x}),[t,x]),C=(0,i.useMemo)((function(){return j?"$"+N.uf.format(String(j),h):""}),[h,j]),T=i.useCallback((function(e){u(s,e,d)}),[u,s,d]);return(0,S.jsxs)("div",{className:(0,y.cn)("flex w-full flex-col justify-between bg-uiv2 lg:h-[64px] lg:flex-row lg:items-center","border-b border-b-v2-lily/10"),children:[(0,S.jsxs)("div",{className:(0,y.cn)("hideScrollbar flex h-full flex-col justify-between overflow-x-scroll pt-2 lg:pt-0"),children:[(0,S.jsxs)("div",{className:"flex h-full items-center justify-between space-x-4 lg:justify-normal",children:[(0,S.jsx)(gn,{selectToPair:T,selected:r}),(0,S.jsxs)("div",{className:"flex items-center",children:[(0,S.jsx)(pn,{}),(0,S.jsx)(xn,{})]})]}),(0,S.jsxs)("div",{className:"mt-2 flex h-10 w-full items-center justify-between space-x-3 border-t border-t-v2-lily/5 px-3 py-2 lg:hidden",children:[(0,S.jsx)("div",{className:"flex text-xl font-semibold text-white lg:hidden",children:C&&j?(0,S.jsx)(k,{price:new m.Z(j),precision:h,children:C}):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})}),(0,S.jsxs)("div",{className:"flex gap-3",children:[(0,S.jsxs)("div",{className:"flex flex-col text-center",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xxs text-white/30 md:text-xs",children:c.ag._({id:"t+B4rK"})}),(0,S.jsx)("div",{className:"text-xs text-white",style:{color:null===g||void 0===g?void 0:g.color},children:null!==g&&void 0!==g&&g.text?g.text:(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]}),(0,S.jsxs)("div",{className:"flex flex-col text-center",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xxs text-white/30 md:text-xs",children:c.ag._({id:"qtJRPh"})}),(0,S.jsx)("div",{className:"text-xs text-white",children:b?(0,N.dN)(b.volume,2):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]})]})]})]}),(0,S.jsxs)("div",{className:(0,y.cn)("hidden h-full min-w-[260px] gap-3 pr-3 lg:flex lg:px-3 xl:gap-7","hideScrollbar mt-3 justify-between 2xl:justify-end","border-t border-t-v2-lily/5 pt-3 lg:ml-auto lg:mt-0 lg:border-none lg:pt-0"),children:[(0,S.jsx)("div",{className:"hidden items-center text-center font-semibold leading-none lg:flex",children:(0,S.jsx)("div",{className:"text-lg text-white",children:C&&j?(0,S.jsx)(k,{price:new m.Z(j),precision:h,children:C}):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})}),(0,S.jsxs)("div",{className:"flex items-center gap-3 xl:gap-7",children:[(0,S.jsxs)("div",{className:"flex flex-col text-center",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xs text-white/30",children:c.ag._({id:"t+B4rK"})}),(0,S.jsx)("div",{className:"text-xs text-white",style:{color:null===g||void 0===g?void 0:g.color},children:null!==g&&void 0!==g&&g.text?g.text:(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]}),(0,S.jsxs)("div",{className:"flex flex-col text-center",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xs text-white/30",children:c.ag._({id:"qtJRPh"})}),(0,S.jsx)("div",{className:"text-xs text-white",children:b?"$".concat((0,N.dN)(b.volume,2)):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]}),(0,S.jsxs)("div",{className:"hidden flex-col text-center xl:flex",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xs text-white/30",children:c.ag._({id:"vNjH1s"})}),(0,S.jsx)("div",{className:"text-xs text-white",children:null!==v&&void 0!==v&&v.high24H?"$"+N.uf.format(v.high24H,h):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]}),(0,S.jsxs)("div",{className:"hidden flex-col text-center xl:flex",children:[(0,S.jsx)("p",{className:"whitespace-nowrap text-xs text-white/30",children:c.ag._({id:"WYPE+O"})}),(0,S.jsx)("div",{className:"text-xs text-white",children:null!==v&&void 0!==v&&v.low24H?"$"+N.uf.format(v.low24H,h):(0,S.jsx)(w.O,{className:"h-4 w-10 rounded-md"})})]})]})]})]})};function kn(){return(0,S.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:(0,S.jsx)("path",{stroke:"rgb(86, 84, 82)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M 12 20.696 V 14.12 m 0 -10.817 V 9.88 m 3.478 -4.4 L 12 2 L 8.522 5.478 m 0 13.044 L 12 22 l 3.478 -3.478"})})}var On=function(){var e=(0,_.tc)(),t=e.perpsTokens,n=e.bottomTab,s=e.setBottomTab,o=e.oraclePrices,f=e.userPositions,g=(0,C.y)(),b=g.isEditCollateralDialogOpen,w=g.isEditTPSLDialogOpen,y=g.isClosePositionDialogOpen,N=g.isSharePositionDialogOpen,P=g.isShareHistoryDialogOpen,k=(0,u.Bn)().getTokenInfo,T=an(),M=T.fromPairTokenInfo,F=T.toPairTokenInfo,A=T.isReady,E=cn(),q=(0,R.Ne)(O.yM),L=(0,u.C9)(),U=(0,u.gZ)().fetchTokenAccounts;(0,i.useEffect)((function(){M&&F&&U([M.address,F.address])}),[M,F,U,L]);var K=(0,i.useCallback)((function(e){q(M,F,e)}),[M,q,F]),V=(0,R.QY)(),B=(0,x.Fm)(),z=I({enabled:B}).socketRestartCount;(0,i.useEffect)((function(){if(0!==t.stableTokens.length&&0!==t.nonStableTokens.length&&M.address)if(V.find((function(e){return e===M.address}))){var e=t.nonStableTokens.find((function(e){return e.address===F.address}));M.address&&e||q(M.address?M:t.nonStableTokens[0],t.nonStableTokens[0],E)}else q(t.nonStableTokens[0],t.nonStableTokens[0],E)}),[t,F,M,q,E,V]);var H=(0,p.Gc)(),W=(0,i.useMemo)((function(){return"lg"===H||"xl"===H}),[H]),$=(0,i.useMemo)((function(){return"xs"===H||"sm"===H||"md"===H}),[H]),G=(0,i.useMemo)((function(){return o?o[F.address]:null}),[o,F.address]),Y=(0,p.y_)(G),X=(0,h.Dv)((0,i.useMemo)((function(){return(0,D.o_)(Z.CHAOS_IDS[F.address])}),[F])),J=(0,i.useMemo)((function(){return Z.CHAOS_IDS[F.address]&&W&&A&&Y>0}),[W,A,Y,F.address]),te=(0,i.useMemo)((function(){return Z.CHAOS_IDS[F.address]&&$&&A&&Y>0}),[$,A,Y,F.address]),ne=(0,i.useRef)(null),ie=(0,i.useRef)(null),re=(0,i.useMemo)((function(){return J?ne:te?ie:void 0}),[J,te]),le=(0,d._)("jupiter-labs-perps-render-position-on-tv",!0),oe=(0,r.Z)(le,2),ae=oe[0],ce=oe[1],de=function(){var e=(0,fn.O)().wallet,t=(0,u.Bn)().connection,n=(0,_.tc)(),s=n.userPositions,o=n.refreshPositionInfo,c=(0,se.Z)().promptKeeperClosePositionNotification,d=(0,h.KO)(Q.isClosingAllPositions),x=(0,r.Z)(d,2),p=x[0],f=x[1];return(0,i.useCallback)(function(){var n=(0,l.Z)(a().mark((function n(i){var r,d,u,x,m;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s&&0!==(null===s||void 0===s?void 0:s.length)&&!p){n.next=2;break}return n.abrupt("return");case 2:if(e){n.next=4;break}throw new Error("Wallet not connected");case 4:if(f(!0),n.prev=5,r=null===s||void 0===s?void 0:s.find((function(e){return e.publicKey.toString()===i.publicKey}))){n.next=9;break}throw new Error("Cannot find position ".concat(i.id));case 9:return n.next=11,ye(e,t,r);case 11:if(d=n.sent){n.next=14;break}throw new Error("Cannot find market close instruction");case 14:return u=d.instructions,x=d.positionRequestKey,m={wallet:e.adapter.name,position:r,priceSlippage:"long"===r.side?new(Nt())(0):new(Nt())("18446744073709551615"),collateralUsdDelta:new(Nt())(0).toNumber(),sizeUsdDelta:new(Nt())(r.sizeUsd.toFixed(0)).toNumber(),desiredMint:r.collateralCustody.account.mint},n.next=18,new Promise(function(){var t=(0,l.Z)(a().mark((function t(n,i){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c(u,x,(function(e){o(),n(e)}),(function(e){i(e)}),function(){var t=m.position,n=(0,ee.Z)(m,mn);return vn({wallet:e.adapter.name,position:t.publicKey.toString()},(0,De.w_)(n))}());case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());case 18:return n.abrupt("return",n.sent);case 21:n.prev=21,n.t0=n.catch(5),console.log("Failed to close all positions!",n.t0);case 24:return n.prev=24,o(),f(!1),n.finish(24);case 28:case"end":return n.stop()}}),n,null,[[5,21,24,28]])})));return function(e){return n.apply(this,arguments)}}(),[t,p,c,o,f,s,e])}(),ue=(0,i.useMemo)((function(){return f&&ae?f.map((function(e){var t,n=k(e.custody.account.mint.toString());if((null===n||void 0===n?void 0:n.address)!==F.address)return null;var i=new m.Z(e.price).div(1e6).toFixed(Y),s="long"===e.side?c.ag._({id:"otaTjg"}):c.ag._({id:"RRXpo1"}),r=[],l=Ae(e),o=l.hasTp,a=l.hasSl;return o&&r.push({id:"tp-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-TP"),price:Number(o.toFixed(Y)),action:"tp",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),a&&r.push({id:"sl-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-SL"),price:Number(a.toFixed(Y)),action:"sl",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),r.push({id:"lq-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s,"-Liq."),price:Number(null===(t=e.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(Y)),action:"lq",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),r.push({id:"".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s),price:Number(i),action:e.side,sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString(),onCloseAction:de}),r})).flat().filter(Boolean):[]}),[f]),xe=(0,i.useMemo)((function(){var e=B?null===X||void 0===X?void 0:X.price:G;return null!==X&&void 0!==X&&X.price&&F&&e?c.ag._({id:"tK6yIE",values:{0:new m.Z(e).toFixed(Y),1:F.symbol}}):c.ag._({id:"J4k+9h"})}),[B,null===X||void 0===X?void 0:X.price,G,F,Y]),pe=function(e){var t=e.resizeComponentRef,n=e.minHeight,s=void 0===n?0:n,r=e.maxHeight,l=void 0===r?1/0:r,o=(0,i.useCallback)((function(e,n,i){if(t&&t.current&&window){var r=window.getComputedStyle(t.current).height,o=parseInt(r,10);document.body.style.userSelect="none",document.body.style.pointerEvents="none";var a=function(n){n.preventDefault();var i="clientY"in n?n.clientY:n.touches[0].clientY,r=o+(i-e);t.current&&r>=s&&r<=l&&(t.current.style.height="".concat(r,"px"))};document.addEventListener(n,a,"touchmove"===n?{passive:!1}:void 0),document.addEventListener(i,(function e(){document.removeEventListener(n,a),document.removeEventListener(i,e),document.body.style.userSelect="",document.body.style.pointerEvents=""}))}}),[l,s,t]);return{onMouseDown:(0,i.useCallback)((function(e){o(e.clientY,"mousemove","mouseup")}),[o]),onTouchStart:(0,i.useCallback)((function(e){o(e.touches[0].clientY,"touchmove","touchend")}),[o])}}({resizeComponentRef:re,minHeight:200,maxHeight:.7*window.innerHeight}),fe=pe.onTouchStart,me=pe.onMouseDown;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(v.PB,{title:xe}),b&&(0,S.jsx)(Qt,{}),w&&(0,S.jsx)(ln,{}),y&&(0,S.jsx)(Et,{}),N&&(0,S.jsx)(Nn,{}),P&&(0,S.jsx)(Pn,{}),(0,S.jsx)(yn,{}),(0,S.jsxs)("div",{className:"hidden min-h-full min-w-full flex-1 lg:flex",children:[(0,S.jsxs)("div",{className:"flex w-[calc(100vw-360px)] flex-col",children:[(0,S.jsx)(Sn,{lastPrice:null===X||void 0===X?void 0:X.price}),re&&re.current?(0,j.createPortal)((0,S.jsx)(wn,{renderingId:"perps",shadesClassName:"!bg-[#131B24]",datafeedObject:{feedId:Z.CHAOS_IDS[F.address]},opt:{enableVolumeStudy:!1,showVolume:!1,showPriceSource:!1,showBarChange:!1},style:{background:"#131B24"},positions:ue,hasFocus:B,favoriteIntervals:["5","15","1H"],restartCount:z}),re.current):null,(0,S.jsx)("div",{ref:ne,className:"relative z-10 h-[50vh] bg-uiv2",children:(0,S.jsx)("div",{onMouseDown:me,className:"absolute bottom-[-8px] left-1/2 z-50 flex h-4 w-4 -translate-x-1/2 transform cursor-row-resize items-center justify-center",children:(0,S.jsx)(kn,{})})}),(0,S.jsxs)(Ge,{activeTab:n,setActiveTab:s,showPositions:ae,setShowPositions:ce,children:["Positions"===n?(0,S.jsx)(He,{setPositionDirection:K}):null,"Trade History"===n?(0,S.jsx)(wt,{setPositionDirection:K}):null,"Expired Orders"===n?(0,S.jsx)(lt,{}):null]})]}),(0,S.jsx)("div",{className:"w-[360px] min-w-[360px] flex-1 lg:max-w-[360px]",children:W&&(0,S.jsx)(bn,{positionDirection:E,setPositionDirection:K,fromPairTokenInfo:M,toPairTokenInfo:F})})]}),(0,S.jsxs)("div",{className:"flex w-full flex-col lg:hidden",children:[(0,S.jsx)(Sn,{lastPrice:null===X||void 0===X?void 0:X.price}),(0,S.jsx)("div",{ref:ie,className:"h-[30vh] bg-uiv2"}),(0,S.jsxs)("div",{className:"relative flex w-full items-center justify-between bg-[#16202B] p-2 lg:hidden",children:[(0,S.jsx)("div",{onTouchStart:fe,className:"absolute left-1/2 top-[-8px] z-10 flex h-4 w-4 -translate-x-1/2 transform touch-none items-center justify-center",children:(0,S.jsx)(kn,{})}),(0,S.jsxs)("div",{className:"flex items-center space-x-2 whitespace-nowrap text-xs text-v2-lily/50",children:[(0,S.jsx)(jn,{active:ae,onClick:function(){return ce((function(e){return!e}))}}),(0,S.jsx)("span",{children:c.ag._({id:"E8sxZm"})})]})]}),(0,S.jsx)("div",{className:"w-full",children:$&&(0,S.jsx)(bn,{positionDirection:E,setPositionDirection:K,fromPairTokenInfo:M,toPairTokenInfo:F})}),(0,S.jsx)("div",{children:(0,S.jsxs)(Ge,{activeTab:n,setActiveTab:s,showPositions:ae,setShowPositions:ce,children:["Positions"===n?(0,S.jsx)(He,{setPositionDirection:K}):null,"Trade History"===n?(0,S.jsx)(wt,{setPositionDirection:K}):null,"Expired Orders"===n?(0,S.jsx)(lt,{}):null]})})]})]})},_n=!0,Cn=function(){return(0,S.jsx)(s.Z,{children:(0,S.jsx)(On,{})})}},31157:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/perps/[direction]/[inOut]",function(){return n(340)}])},63989:function(e,t,n){"use strict";function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i.apply(this,arguments)}n.d(t,{Z:function(){return i}})}},function(e){e.O(0,[13215,57673,7763,49774,92888,40179],(function(){return t=31157,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[inOut]-30721b1167c0fa56.js.map